(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    254743,       5651]
NotebookOptionsPosition[    252960,       5592]
NotebookOutlinePosition[    253334,       5608]
CellTagsIndexPosition[    253291,       5605]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["GibbotQnts Package", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
   3.6289934659285192`*^9, 3.6289934747067785`*^9}, 3.629089629414613*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"BeginPackage", "[", "\"\<GibbotQnts`\>\"", "]"}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"ValueQ", "[", 
       RowBox[{"DynamicQnts", "::", "usage"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"DynamicQnts", "::", "usage"}], " ", "=", " ", 
      "\"\<Based on which magnet is on, state of the robot, and input torque, \
this function outputs the robot's acceleration and tangential forces felt by \
magnets on each link.\>\""}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"ValueQ", "[", 
       RowBox[{"ImpactQnts", "::", "usage"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"ImpactQnts", "::", "usage"}], " ", "=", " ", 
      "\"\<Based on which magnet is on and the state of the robot, this \
function outputs the robot's post-impact velocity and tangential impulsive \
forces felt by magnets on each link.\>\""}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"ValueQ", "[", 
       RowBox[{"MotorInput", "::", "usage"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"MotorInput", "::", "usage"}], " ", "=", " ", 
      "\"\<Returns input torque u such that b.qdd \[Equal] 0.  b can be a \
vector or a matrix.  This function is useful if computing a (partial) \
feedback linearization term.\>\""}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"ValueQ", "[", 
       RowBox[{"FreeFlightVelocity", "::", "usage"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"FreeFlightVelocity", "::", "usage"}], " ", "=", " ", 
      "\"\<Returns velocity of robot at the beginning of free flight required \
to travel a horizontal distance \[CapitalDelta]x at a maximum height of \
\[CapitalDelta]y given configuration q.\>\""}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"ValueQ", "[", 
       RowBox[{"MinimizeFreeFlight", "::", "usage"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"MinimizeFreeFlight", "::", "usage"}], " ", "=", " ", 
      "\"\<Returns state that minimumizes velocity satisfying free flight \
required to travel a horizontal distance \[CapitalDelta]x at a maximum height \
of \[CapitalDelta]y.\>\""}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"ValueQ", "[", 
       RowBox[{"MaximizeFreeFlight", "::", "usage"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"MaximizeFreeFlight", "::", "usage"}], " ", "=", " ", 
      "\"\<Returns state that maximumizes velocity satisfying free flight \
required to travel a horizontal distance \[CapitalDelta]x at a maximum height \
of \[CapitalDelta]y.\>\""}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"PE", "::", "usage"}], "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"PE", "::", "usage"}], " ", "=", " ", 
     "\"\<Potential Energy.\>\""}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"KE", "::", "usage"}], "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"KE", "::", "usage"}], " ", "=", " ", 
     "\"\<Kinetic Energy.\>\""}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"ValueQ", "[", 
       RowBox[{"TE", "::", "usage"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"TE", "::", "usage"}], " ", "=", " ", 
      "\"\<Total Energy.\>\""}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"ValueQ", "[", 
       RowBox[{"DrawGibbot", "::", "usage"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"DrawGibbot", "::", "usage"}], " ", "=", " ", 
      "\"\<Draws the Gibbot.\>\""}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"g", "::", "usage"}], "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"g", "::", "usage"}], " ", "=", " ", "\"\<gravity\>\""}]}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"m1", "::", "usage"}], "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"m1", "::", "usage"}], " ", "=", " ", 
     "\"\<mass of link 1\>\""}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"m2", "::", "usage"}], "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"m2", "::", "usage"}], " ", "=", " ", 
     "\"\<mass of link 2\>\""}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"I1", "::", "usage"}], "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"I1", "::", "usage"}], " ", "=", " ", 
     "\"\<moment of inertia about com of link 1\>\""}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"I2", "::", "usage"}], "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"I2", "::", "usage"}], " ", "=", " ", 
     "\"\<moment of inertia about com of link 2\>\""}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"r1", "::", "usage"}], "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"r1", "::", "usage"}], " ", "=", " ", 
     "\"\<position of com of link 1\>\""}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"r2", "::", "usage"}], "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"r2", "::", "usage"}], " ", "=", " ", 
     "\"\<position of com of link 2\>\""}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"L1", "::", "usage"}], "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"L1", "::", "usage"}], " ", "=", " ", 
     "\"\<length of link 1\>\""}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"L2", "::", "usage"}], "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"L2", "::", "usage"}], " ", "=", " ", 
     "\"\<length of link 2\>\""}]}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"ValueQ", "[", 
       RowBox[{"T", "::", "usage"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"T", "::", "usage"}], " ", "=", " ", 
      "\"\<mapping from motor torque to generalized forces\>\""}]}], "]"}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"default", " ", "parameter", " ", "values"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"g", " ", "=", " ", "9.81"}], ";"}], " ", 
  RowBox[{"(*", " ", "gravity", " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"m1", " ", "=", " ", 
    RowBox[{"m2", " ", "=", " ", 
     RowBox[{"0.453592", " ", "4"}]}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"lbs", " ", "to", " ", "kg"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"I1", " ", "=", " ", 
   RowBox[{"I2", " ", "=", " ", "0.04185679"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"L1", " ", "=", " ", 
    RowBox[{"L2", " ", "=", " ", 
     RowBox[{"0.0254", " ", "11"}]}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"inches", " ", "to", " ", "m"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"r1", " ", "=", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", "0.7"}], ")"}], "L1"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"center", " ", "of", " ", "mass"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"r2", " ", "=", " ", 
    RowBox[{"0.7", "L2"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"center", " ", "of", " ", "mass"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"b1", " ", "=", " ", "0.0"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"bearing", " ", "friction"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"b2", " ", "=", " ", "0.5"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"motor", " ", "friction"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"T", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"0", ",", " ", "0", ",", " ", "0", ",", " ", "1"}], "}"}]}], " ",
    ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "transmission", " ", "matrix", " ", "from", " ", "motor", " ", "to", " ", 
    "robot"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Protect", "[", 
     RowBox[{
     "g", ",", " ", "m1", ",", " ", "I1", ",", " ", "I2", ",", " ", "L1", ",",
       " ", "L2", ",", " ", "r1", ",", " ", "r2", ",", " ", "T"}], "]"}], 
    ";"}], "*)"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"M", "[", "q_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "c3", ",", "s3", ",", "c4", ",", " ", "c34", ",", " ", "s34", ",", " ",
         "A", ",", " ", "B", ",", " ", "C"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"c3", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s3", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c4", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{"q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c34", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{
          RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s34", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{
          RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"A", " ", "=", " ", 
        TagBox[
         RowBox[{"(", "\[NoBreak]", GridBox[{
            {
             RowBox[{"m1", "+", "m2"}], "0"},
            {"0", 
             RowBox[{"m1", "+", "m2"}]}
           },
           
           GridBoxAlignment->{
            "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
             "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
           GridBoxSpacings->{"Columns" -> {
               Offset[0.27999999999999997`], {
                Offset[0.7]}, 
               Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
               Offset[0.2], {
                Offset[0.4]}, 
               Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
         Function[BoxForm`e$, 
          MatrixForm[BoxForm`e$]]]}], ";", "\[IndentingNewLine]", 
       RowBox[{"B", " ", "=", " ", 
        TagBox[
         TagBox[
          RowBox[{"(", "\[NoBreak]", GridBox[{
             {
              RowBox[{
               RowBox[{"c3", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"L1", " ", "m2"}], "+", 
                  RowBox[{"m1", " ", "r1"}]}], ")"}]}], "+", 
               RowBox[{"c34", " ", "m2", " ", "r2"}]}], 
              RowBox[{"c34", " ", "m2", " ", "r2"}]},
             {
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"L1", " ", "m2"}], "+", 
                  RowBox[{"m1", " ", "r1"}]}], ")"}], " ", "s3"}], "+", 
               RowBox[{"m2", " ", "r2", " ", "s34"}]}], 
              RowBox[{"m2", " ", "r2", " ", "s34"}]}
            },
            
            GridBoxAlignment->{
             "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
              "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
            GridBoxSpacings->{"Columns" -> {
                Offset[0.27999999999999997`], {
                 Offset[0.7]}, 
                Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
                Offset[0.2], {
                 Offset[0.4]}, 
                Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
          Function[BoxForm`e$, 
           MatrixForm[BoxForm`e$]]],
         Function[BoxForm`e$, 
          MatrixForm[BoxForm`e$]]]}], ";", "\[IndentingNewLine]", 
       RowBox[{"C", " ", "=", " ", 
        RowBox[{"(", "\[NoBreak]", GridBox[{
           {
            RowBox[{"I1", "+", "I2", "+", 
             RowBox[{
              SuperscriptBox["L1", "2"], " ", "m2"}], "+", 
             RowBox[{"m1", " ", 
              SuperscriptBox["r1", "2"]}], "+", 
             RowBox[{"2", " ", "c4", " ", "L1", " ", "m2", " ", "r2"}], "+", 
             RowBox[{"m2", " ", 
              SuperscriptBox["r2", "2"]}]}], 
            RowBox[{"I2", "+", 
             RowBox[{"c4", " ", "L1", " ", "m2", " ", "r2"}], "+", 
             RowBox[{"m2", " ", 
              SuperscriptBox["r2", "2"]}]}]},
           {
            RowBox[{"I2", "+", 
             RowBox[{"c4", " ", "L1", " ", "m2", " ", "r2"}], "+", 
             RowBox[{"m2", " ", 
              SuperscriptBox["r2", "2"]}]}], 
            RowBox[{"I2", "+", 
             RowBox[{"m2", " ", 
              SuperscriptBox["r2", "2"]}]}]}
          },
          
          GridBoxAlignment->{
           "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
            "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
          GridBoxSpacings->{"Columns" -> {
              Offset[0.27999999999999997`], {
               Offset[0.7]}, 
              Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
              Offset[0.2], {
               Offset[0.4]}, 
              Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"ArrayFlatten", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"A", ",", " ", "B"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"B", "\[Transpose]"}], ",", " ", "C"}], "}"}]}], "}"}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"c", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"c3", ",", "s3", ",", "s4", ",", " ", "c34", ",", " ", "s34"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"c3", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s3", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s4", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c34", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{
          RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s34", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{
          RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       TagBox[
        RowBox[{"(", "\[NoBreak]", 
         TagBox[GridBox[{
            {
             RowBox[{
              FractionBox["1", "2"], " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "2"}], " ", "m1", " ", "r1", " ", "s3", " ", 
                 SuperscriptBox[
                  RowBox[{
                  "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}],
                   "2"]}], "+", 
                RowBox[{"2", " ", "m2", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", "L1"}], " ", "s3", " ", 
                    SuperscriptBox[
                    RowBox[{
                    "x", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}], "2"]}], "-", 
                   RowBox[{"r2", " ", "s34", " ", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "x", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}], "+", 
                    RowBox[{
                    "x", "\[LeftDoubleBracket]", "8", 
                    "\[RightDoubleBracket]"}]}], ")"}], "2"]}]}], ")"}]}]}], 
               ")"}]}]},
            {
             RowBox[{
              RowBox[{"g", " ", 
               RowBox[{"(", 
                RowBox[{"m1", "+", "m2"}], ")"}]}], "+", 
              RowBox[{
               FractionBox["1", "2"], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"2", " ", "m1", " ", "r1", " ", "c3", " ", 
                  SuperscriptBox[
                   RowBox[{
                   "x", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}], "2"]}], "+", 
                 RowBox[{"2", " ", "m2", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"L1", " ", "c3", " ", 
                    SuperscriptBox[
                    RowBox[{
                    "x", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}], "2"]}], "+", 
                    RowBox[{"r2", " ", "c34", " ", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "x", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}], "+", 
                    RowBox[{
                    "x", "\[LeftDoubleBracket]", "8", 
                    "\[RightDoubleBracket]"}]}], ")"}], "2"]}]}], ")"}]}]}], 
                ")"}]}]}]},
            {
             RowBox[{
              RowBox[{"g", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"L1", " ", "m2", " ", "s3"}], "+", 
                 RowBox[{"m1", " ", "r1", " ", "s3"}], "+", 
                 RowBox[{"m2", " ", "r2", " ", "s34"}]}], ")"}]}], "-", 
              RowBox[{"2", " ", "L1", " ", "m2", " ", "r2", " ", "s4", " ", 
               RowBox[{
               "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
               " ", 
               RowBox[{
               "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], 
              "-", 
              RowBox[{"L1", " ", "m2", " ", "r2", " ", "s4", " ", 
               SuperscriptBox[
                RowBox[{
                "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}], 
                "2"]}]}]},
            {
             RowBox[{"m2", " ", "r2", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"g", " ", "s34"}], "+", 
                RowBox[{"L1", " ", "s4", " ", 
                 SuperscriptBox[
                  RowBox[{
                  "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}],
                   "2"]}]}], ")"}]}]}
           },
           
           GridBoxAlignment->{
            "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
             "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
           GridBoxSpacings->{"Columns" -> {
               Offset[0.27999999999999997`], {
                Offset[0.5599999999999999]}, 
               Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
               Offset[0.2], {
                Offset[0.4]}, 
               Offset[0.2]}, "RowsIndexed" -> {}}],
          Column], "\[NoBreak]", ")"}],
        Function[BoxForm`e$, 
         MatrixForm[BoxForm`e$]]]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fext", "[", 
     RowBox[{"x_", ",", " ", "u_"}], "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"T", " ", "u"}], " ", "-", " ", 
     RowBox[{"T", " ", "b2", " ", 
      RowBox[{
      "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"J1", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{
      TagBox[
       TagBox[
        RowBox[{"(", "\[NoBreak]", GridBox[{
           {"1", "0", "0", "0"},
           {"0", "1", "0", "0"}
          },
          
          GridBoxAlignment->{
           "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
            "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
          GridBoxSpacings->{"Columns" -> {
              Offset[0.27999999999999997`], {
               Offset[0.7]}, 
              Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
              Offset[0.2], {
               Offset[0.4]}, 
              Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
        Function[BoxForm`e$, 
         MatrixForm[BoxForm`e$]]],
       Function[BoxForm`e$, 
        MatrixForm[BoxForm`e$]]], ",", " ", 
      TagBox[
       TagBox[
        RowBox[{"(", "\[NoBreak]", GridBox[{
           {"0", "0", "0", "0"},
           {"0", "0", "0", "0"}
          },
          
          GridBoxAlignment->{
           "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
            "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
          GridBoxSpacings->{"Columns" -> {
              Offset[0.27999999999999997`], {
               Offset[0.7]}, 
              Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
              Offset[0.2], {
               Offset[0.4]}, 
              Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
        Function[BoxForm`e$, 
         MatrixForm[BoxForm`e$]]],
       Function[BoxForm`e$, 
        MatrixForm[BoxForm`e$]]]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"J2", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "c3", ",", "s3", ",", " ", "c34", ",", " ", "s34", ",", " ", "J", ",", 
        " ", "Jdot"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"c3", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s3", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c34", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{
          RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s34", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{
          RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"J", " ", "=", " ", 
        RowBox[{"(", "\[NoBreak]", GridBox[{
           {"1", "0", 
            RowBox[{
             RowBox[{"L1", " ", "c3"}], "+", 
             RowBox[{"L2", " ", "c34"}]}], 
            RowBox[{"L2", " ", "c34"}]},
           {"0", "1", 
            RowBox[{
             RowBox[{"L1", " ", "s3"}], "+", 
             RowBox[{"L2", " ", "s34"}]}], 
            RowBox[{"L2", " ", "s34"}]}
          },
          
          GridBoxAlignment->{
           "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
            "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
          GridBoxSpacings->{"Columns" -> {
              Offset[0.27999999999999997`], {
               Offset[0.7]}, 
              Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
              Offset[0.2], {
               Offset[0.4]}, 
              Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"Jdot", " ", "=", " ", 
        RowBox[{"(", "\[NoBreak]", GridBox[{
           {"0", "0", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "L1"}], " ", "s3", " ", 
              RowBox[{
              "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], 
             "-", 
             RowBox[{"L2", " ", "s34", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
                "+", 
                RowBox[{
                "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}],
                ")"}]}]}], 
            RowBox[{
             RowBox[{"-", "L2"}], " ", "s34", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
               "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
               "+", 
               RowBox[{
               "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], 
              ")"}]}]},
           {"0", "0", 
            RowBox[{
             RowBox[{"L1", " ", "c3", " ", 
              RowBox[{
              "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], 
             "+", 
             RowBox[{"L2", " ", "c34", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
                "+", 
                RowBox[{
                "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}],
                ")"}]}]}], 
            RowBox[{"L2", " ", "c34", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
               "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
               "+", 
               RowBox[{
               "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], 
              ")"}]}]}
          },
          
          GridBoxAlignment->{
           "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
            "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
          GridBoxSpacings->{"Columns" -> {
              Offset[0.27999999999999997`], {
               Offset[0.7]}, 
              Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
              Offset[0.2], {
               Offset[0.4]}, 
              Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"J", ",", " ", "Jdot"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"J3", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "c3", ",", "s3", ",", " ", "c34", ",", " ", "s34", ",", " ", "J", ",", 
        " ", "Jdot"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"c3", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s3", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c34", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{
          RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s34", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{
          RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"J", " ", "=", " ", 
        TagBox[
         RowBox[{"(", "\[NoBreak]", GridBox[{
            {"1", "0", "0", "0"},
            {"0", "1", "0", "0"},
            {"1", "0", 
             RowBox[{
              RowBox[{"L1", " ", "c3"}], "+", 
              RowBox[{"L2", " ", "c34"}]}], 
             RowBox[{"L2", " ", "c34"}]},
            {"0", "1", 
             RowBox[{
              RowBox[{"L1", " ", "s3"}], "+", 
              RowBox[{"L2", " ", "s34"}]}], 
             RowBox[{"L2", " ", "s34"}]}
           },
           
           GridBoxAlignment->{
            "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
             "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
           GridBoxSpacings->{"Columns" -> {
               Offset[0.27999999999999997`], {
                Offset[0.7]}, 
               Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
               Offset[0.2], {
                Offset[0.4]}, 
               Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
         Function[BoxForm`e$, 
          MatrixForm[BoxForm`e$]]]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Jdot", " ", "=", " ", 
        RowBox[{"(", "\[NoBreak]", GridBox[{
           {"0", "0", "0", "0"},
           {"0", "0", "0", "0"},
           {"0", "0", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "L1"}], " ", "s3", " ", 
              RowBox[{
              "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], 
             "-", 
             RowBox[{"L2", " ", "s34", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
                "+", 
                RowBox[{
                "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}],
                ")"}]}]}], 
            RowBox[{
             RowBox[{"-", "L2"}], " ", "s34", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
               "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
               "+", 
               RowBox[{
               "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], 
              ")"}]}]},
           {"0", "0", 
            RowBox[{
             RowBox[{"L1", " ", "c3", " ", 
              RowBox[{
              "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], 
             "+", 
             RowBox[{"L2", " ", "c34", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
                "+", 
                RowBox[{
                "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}],
                ")"}]}]}], 
            RowBox[{"L2", " ", "c34", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
               "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
               "+", 
               RowBox[{
               "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], 
              ")"}]}]}
          },
          
          GridBoxAlignment->{
           "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
            "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
          GridBoxSpacings->{"Columns" -> {
              Offset[0.27999999999999997`], {
               Offset[0.7]}, 
              Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
              Offset[0.2], {
               Offset[0.4]}, 
              Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"J", ",", " ", "Jdot"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"dPcom", "[", 
     RowBox[{"mag_", ",", " ", "q_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "m", ",", " ", "c3", ",", "s3", ",", " ", "c34", ",", " ", "s34"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"dPcom", " ", "=", " ", 
         RowBox[{
          RowBox[{"d", "/", "dq"}], " ", "Pcom"}]}], ",", " ", 
        RowBox[{
        "where", " ", "Pcom", " ", "is", " ", "the", " ", "center", " ", "of",
          " ", "mass", " ", "of", " ", "the", " ", 
         RowBox[{"robot", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"This", " ", "function", " ", "satisfies", " ", "vcom"}], 
         " ", "=", " ", 
         RowBox[{"dPcom", ".", 
          RowBox[{"qd", "\[LeftDoubleBracket]", 
           RowBox[{"3", ";;", "4"}], "\[RightDoubleBracket]"}]}]}], ",", " ", 
        
        RowBox[{"where", " ", "vcom", " ", "is", " ", "the"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "velocity", " ", "of", " ", "the", " ", "center", " ", "of", " ", 
        "mass", " ", "when", " ", "the", " ", "robot", " ", "has", " ", 
        "only", " ", "one", " ", "magnet"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"on", " ", "and", " ", "qd"}], " ", "=", " ", 
        RowBox[{
         RowBox[{"d", "/", "dt"}], " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "qx", ",", " ", "qy", " ", ",", "q\[Theta]1", ",", " ", 
            "q\[Theta]2"}], "}"}], "."}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"m1", " ", "+", " ", "m2"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"total", " ", "mass"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"c3", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s3", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c34", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{
          RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s34", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{
          RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "/", "m"}], ")"}], " ", 
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mag", " ", "\[Equal]", " ", "0"}], ",", " ", 
          TagBox[
           RowBox[{"(", "\[NoBreak]", GridBox[{
              {
               RowBox[{"m1", "+", "m2"}], "0", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"L1", " ", "m2"}], "+", 
                   RowBox[{"m1", " ", "r1"}]}], ")"}], " ", "c3"}], "+", 
                RowBox[{"m2", " ", "r2", " ", "c34"}]}], 
               RowBox[{"m2", " ", "r2", " ", "c34"}]},
              {"0", 
               RowBox[{"m1", "+", "m2"}], 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"L1", " ", "m2"}], "+", 
                   RowBox[{"m1", " ", "r1"}]}], ")"}], " ", "s3"}], "+", 
                RowBox[{"m2", " ", "r2", " ", "s34"}]}], 
               RowBox[{"m2", " ", "r2", " ", "s34"}]}
             },
             
             GridBoxAlignment->{
              "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
               "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
             GridBoxSpacings->{"Columns" -> {
                 Offset[0.27999999999999997`], {
                  Offset[0.7]}, 
                 Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, 
               "Rows" -> {
                 Offset[0.2], {
                  Offset[0.4]}, 
                 Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
           Function[BoxForm`e$, 
            MatrixForm[BoxForm`e$]]], ",", "\[IndentingNewLine]", 
          RowBox[{"mag", " ", "\[Equal]", " ", "1"}], ",", " ", 
          TagBox[
           TagBox[
            RowBox[{"(", "\[NoBreak]", GridBox[{
               {
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"L1", " ", "m2"}], "+", 
                    RowBox[{"m1", " ", "r1"}]}], ")"}], " ", "c3"}], "+", 
                 RowBox[{"m2", " ", "r2", " ", "c34"}]}], 
                RowBox[{"m2", " ", "r2", " ", "c34"}]},
               {
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"L1", " ", "m2"}], "+", 
                    RowBox[{"m1", " ", "r1"}]}], ")"}], " ", "s3"}], "+", 
                 RowBox[{"m2", " ", "r2", " ", "s34"}]}], 
                RowBox[{"m2", " ", "r2", " ", "s34"}]}
              },
              
              GridBoxAlignment->{
               "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
                "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
              GridBoxSpacings->{"Columns" -> {
                  Offset[0.27999999999999997`], {
                   Offset[0.7]}, 
                  Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, 
                "Rows" -> {
                  Offset[0.2], {
                   Offset[0.4]}, 
                  Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
            Function[BoxForm`e$, 
             MatrixForm[BoxForm`e$]]],
           Function[BoxForm`e$, 
            MatrixForm[BoxForm`e$]]], ",", "\[IndentingNewLine]", 
          RowBox[{"mag", " ", "\[Equal]", " ", "2"}], ",", 
          TagBox[
           RowBox[{" ", 
            TagBox[
             RowBox[{"(", "\[NoBreak]", GridBox[{
                {
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "m1"}], " ", 
                   RowBox[{"(", 
                    RowBox[{"L1", "-", "r1"}], ")"}], " ", "c3"}], "+", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"L2", " ", 
                    RowBox[{"(", 
                    RowBox[{"m1", "+", "m2"}], ")"}]}], "-", 
                    RowBox[{"m2", " ", "r2"}]}], ")"}], " ", "c34"}]}], 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"L2", " ", 
                    RowBox[{"(", 
                    RowBox[{"m1", "+", "m2"}], ")"}]}], "-", 
                    RowBox[{"m2", " ", "r2"}]}], ")"}]}], " ", "c34"}]},
                {
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "m1"}], " ", 
                   RowBox[{"(", 
                    RowBox[{"L1", "-", "r1"}], ")"}], " ", "s3"}], "+", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"L2", " ", 
                    RowBox[{"(", 
                    RowBox[{"m1", "+", "m2"}], ")"}]}], "-", 
                    RowBox[{"m2", " ", "r2"}]}], ")"}], " ", "s34"}]}], 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"L2", " ", 
                    RowBox[{"(", 
                    RowBox[{"m1", "+", "m2"}], ")"}]}], "-", 
                    RowBox[{"m2", " ", "r2"}]}], ")"}]}], " ", "s34"}]}
               },
               
               GridBoxAlignment->{
                "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
                 "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
               GridBoxSpacings->{"Columns" -> {
                   Offset[0.27999999999999997`], {
                    Offset[0.7]}, 
                   Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, 
                 "Rows" -> {
                   Offset[0.2], {
                    Offset[0.4]}, 
                   Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
             Function[BoxForm`e$, 
              MatrixForm[BoxForm`e$]]]}],
           Function[BoxForm`e$, 
            MatrixForm[BoxForm`e$]]], ",", "\[IndentingNewLine]", "True", ",",
           " ", 
          RowBox[{
          "Throw", "[", "\"\<Invalid magnet state for dPcom\>\"", "]"}]}], 
         "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "position", " ", "of", " ", "center", " ", "of", " ", "masses", " ", "and",
     " ", "end", " ", "points", " ", "on", " ", "each", " ", "link"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"P0", "[", "q_", "]"}], " ", ":=", " ", 
   RowBox[{"q", "\[LeftDoubleBracket]", 
    RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"P1", "[", "q_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"P0", "[", "q", "]"}], " ", "+", " ", 
    RowBox[{"r1", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Sin", "[", 
        RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
        "]"}], ",", " ", 
       RowBox[{"-", 
        RowBox[{"Cos", "[", 
         RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}]}], "}"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"P2", "[", "q_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"P3", "[", "q", "]"}], " ", "+", " ", 
    RowBox[{"r2", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Sin", "[", 
        RowBox[{
         RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "+", 
         RowBox[{
         "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], "]"}],
        ",", " ", 
       RowBox[{"-", 
        RowBox[{"Cos", "[", 
         RowBox[{
          RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}]}], "}"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"P3", "[", "q_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"P0", "[", "q", "]"}], " ", "+", " ", 
    RowBox[{"L1", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Sin", "[", 
        RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
        "]"}], ",", " ", 
       RowBox[{"-", 
        RowBox[{"Cos", "[", 
         RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}]}], "}"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"P4", "[", "q_", "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"P3", "[", "q", "]"}], " ", "+", " ", 
     RowBox[{"L2", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Sin", "[", 
         RowBox[{
          RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}], ",", " ", 
        RowBox[{"-", 
         RowBox[{"Cos", "[", 
          RowBox[{
           RowBox[{
           "q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], "+", 
           RowBox[{
           "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
          "]"}]}]}], "}"}]}]}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", "energy", " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KE", "[", "x_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"1", "/", "2"}], 
    RowBox[{
     RowBox[{"x", "\[LeftDoubleBracket]", 
      RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}], ".", 
     RowBox[{"M", "[", "x", "]"}], ".", 
     RowBox[{"x", "\[LeftDoubleBracket]", 
      RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PE", "[", "q_", "]"}], " ", ":=", " ", 
   RowBox[{"g", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"m1", " ", 
        RowBox[{"P1", "[", "q", "]"}]}], "+", 
       RowBox[{"m2", " ", 
        RowBox[{"P2", "[", "q", "]"}]}]}], ")"}], ".", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TE", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"KE", "[", "x", "]"}], " ", "+", " ", 
     RowBox[{"PE", "[", "x", "]"}]}]}], ";"}], "\n"}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DynamicQnts", "[", 
     RowBox[{"mag_", ",", " ", "x_", ",", " ", "u_"}], "]"}], " ", ":=", " ", 
    
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "q", ",", " ", "qd", ",", " ", "qdd", ",", " ", "\[Lambda]", ",", " ", 
        "J", ",", " ", "Jd", ",", " ", "Minv", ",", " ", "\[CapitalLambda]"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mag", " ", "\[Equal]", " ", "0"}], ",", " ", 
         RowBox[{"J", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"both", " ", "magnets", " ", "off"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"mag", " ", "\[Equal]", " ", "1"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"J", ",", " ", "Jd"}], "}"}], " ", "=", " ", 
          RowBox[{"J1", "[", "x", "]"}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"magnet", " ", "on", " ", "link", " ", "1", " ", "on"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"mag", " ", "\[Equal]", " ", "2"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"J", ",", " ", "Jd"}], "}"}], " ", "=", " ", 
          RowBox[{"J2", "[", "x", "]"}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"magnet", " ", "on", " ", "link", " ", "2", " ", "on"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"mag", " ", "\[Equal]", " ", "3"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"J", ",", " ", "Jd"}], "}"}], " ", "=", " ", 
          RowBox[{"J3", "[", "x", "]"}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"both", " ", "magnets", " ", "on"}], " ", "*)"}], 
         "\[IndentingNewLine]", "True", ",", " ", 
         RowBox[{
         "Throw", "[", "\"\<Invalid Magnet State for DynamicQnts\>\"", 
          "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"q", " ", "=", " ", 
        RowBox[{"x", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", "4"}], "\[RightDoubleBracket]"}]}], ";", " ", 
       RowBox[{"(*", " ", "configuration", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"qd", " ", "=", " ", 
        RowBox[{"x", "\[LeftDoubleBracket]", 
         RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}], ";", " ", 
       RowBox[{"(*", " ", "velocity", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Minv", " ", "=", " ", 
        RowBox[{"Inverse", "[", 
         RowBox[{"M", "[", "q", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Lambda]", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"forces", " ", "on", " ", "magnets"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"qdd", " ", "=", " ", 
        RowBox[{"Minv", ".", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"fext", "[", 
            RowBox[{"x", ",", " ", "u"}], "]"}], " ", "-", " ", 
           RowBox[{"c", "[", "x", "]"}]}], ")"}]}]}], ";", " ", 
       RowBox[{"(*", " ", "acceleration", " ", "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"J", " ", "\[NotEqual]", " ", 
          RowBox[{"{", "}"}]}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", " ", "=", " ", 
           RowBox[{"Inverse", "[", 
            RowBox[{"J", ".", "Minv", ".", 
             RowBox[{"J", "\[Transpose]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Lambda]", " ", "=", " ", 
           RowBox[{"-", 
            RowBox[{"\[CapitalLambda]", ".", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Jd", ".", "qd"}], " ", "+", " ", 
               RowBox[{"J", ".", "qdd"}]}], ")"}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"qdd", " ", "=", " ", 
           RowBox[{"qdd", " ", "+", " ", 
            RowBox[{"Minv", ".", 
             RowBox[{"J", "\[Transpose]"}], ".", "\[Lambda]"}]}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"\[Lambda]", " ", "=", " ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"mag", " ", "\[Equal]", " ", "1"}], ",", " ", 
             RowBox[{"PadRight", "[", 
              RowBox[{"\[Lambda]", ",", " ", "4"}], "]"}], ",", " ", 
             RowBox[{"PadLeft", "[", 
              RowBox[{"\[Lambda]", ",", " ", "4"}], "]"}]}], "]"}]}], ";"}]}],
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"qdd", ",", " ", "\[Lambda]"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ImpactQnts", "[", 
     RowBox[{"mag_", ",", " ", "x_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "q", ",", " ", "qd", ",", " ", "J", ",", " ", "Minv", ",", " ", "v", 
        ",", " ", "\[Lambda]", ",", " ", "\[CapitalLambda]"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mag", " ", "\[Equal]", " ", "0"}], ",", " ", 
         RowBox[{"J", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"both", " ", "magnets", " ", "off"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"mag", " ", "\[Equal]", " ", "1"}], ",", " ", 
         RowBox[{"J", " ", "=", " ", 
          RowBox[{"First", "@", 
           RowBox[{"J1", "[", "x", "]"}]}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"magnet", " ", "on", " ", "link", " ", "1", " ", "on"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"mag", " ", "\[Equal]", " ", "2"}], ",", " ", 
         RowBox[{"J", " ", "=", " ", 
          RowBox[{"First", "@", 
           RowBox[{"J2", "[", "x", "]"}]}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"magnet", " ", "on", " ", "link", " ", "2", " ", "on"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"mag", " ", "\[Equal]", " ", "3"}], ",", " ", 
         RowBox[{"J", " ", "=", " ", 
          RowBox[{"First", "@", 
           RowBox[{"J3", "[", "x", "]"}]}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"both", " ", "magnets", " ", "on"}], " ", "*)"}], 
         "\[IndentingNewLine]", "True", ",", " ", 
         RowBox[{
         "Throw", "[", "\"\<Invalid Magnet State for DynamicQnts\>\"", 
          "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"q", " ", "=", " ", 
        RowBox[{"x", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", "4"}], "\[RightDoubleBracket]"}]}], ";", " ", 
       RowBox[{"(*", " ", "configuration", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"qd", " ", "=", " ", 
        RowBox[{"x", "\[LeftDoubleBracket]", 
         RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"pre", "-", 
         RowBox[{"impact", " ", "velocity"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Minv", " ", "=", " ", 
        RowBox[{"Inverse", "[", 
         RowBox[{"M", "[", "q", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Lambda]", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"impulsive", " ", "force", " ", "on", " ", "magnets"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"v", " ", "=", " ", "qd"}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"post", "-", 
         RowBox[{"impact", " ", "velocity"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"J", " ", "\[NotEqual]", " ", 
          RowBox[{"{", "}"}]}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", " ", "=", " ", 
           RowBox[{"Inverse", "[", 
            RowBox[{"J", ".", "Minv", ".", 
             RowBox[{"J", "\[Transpose]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Lambda]", " ", "=", " ", 
           RowBox[{"-", 
            RowBox[{"\[CapitalLambda]", ".", "J", ".", "v"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"v", " ", "=", " ", 
           RowBox[{"v", " ", "+", " ", 
            RowBox[{"Minv", ".", 
             RowBox[{"J", "\[Transpose]"}], ".", "\[Lambda]"}]}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"\[Lambda]", " ", "=", " ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"mag", " ", "\[Equal]", " ", "1"}], ",", " ", 
             RowBox[{"PadRight", "[", 
              RowBox[{"\[Lambda]", ",", " ", "4"}], "]"}], ",", " ", 
             RowBox[{"PadLeft", "[", 
              RowBox[{"\[Lambda]", ",", " ", "4"}], "]"}]}], "]"}]}], ";"}]}],
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"v", ",", " ", "\[Lambda]"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MotorInput", "[", 
     RowBox[{"mag_", ",", " ", "x_", ",", " ", "b_", ",", " ", 
      RowBox[{"v_:", "0"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "q", ",", " ", "qd", ",", " ", "J", ",", " ", "Jd", ",", " ", "Minv", 
        ",", " ", "zi", ",", " ", "zs", ",", " ", "\[CapitalLambda]"}], "}"}],
       ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
         "returns", " ", "input", " ", "torque", " ", "u", " ", "such", " ", 
          "that", " ", 
          RowBox[{"b", ".", "qdd"}]}], " ", "\[Equal]", " ", "du"}], ",", " ",
         "where"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"qdd", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"d", "^", "2"}], "/", 
          RowBox[{"dt", "^", "2"}]}], " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "qx", ",", " ", "qy", " ", ",", "q\[Theta]1", ",", " ", 
            "q\[Theta]2"}], "}"}], ".", " ", "This"}], " ", "can", " ", "be", 
         " ", "used", " ", "to", " ", "apply", " ", "feedback"}]}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "linearization", " ", "when", " ", "using", " ", "the", " ", 
        "optional", " ", "parameter", " ", 
        RowBox[{"du", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mag", " ", "\[Equal]", " ", "0"}], ",", " ", 
         RowBox[{"J", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"both", " ", "magnets", " ", "off"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"mag", " ", "\[Equal]", " ", "1"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"J", ",", " ", "Jd"}], "}"}], " ", "=", " ", 
          RowBox[{"J1", "[", "x", "]"}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"magnet", " ", "on", " ", "link", " ", "1", " ", "on"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"mag", " ", "\[Equal]", " ", "2"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"J", ",", " ", "Jd"}], "}"}], " ", "=", " ", 
          RowBox[{"J2", "[", "x", "]"}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"magnet", " ", "on", " ", "link", " ", "2", " ", "on"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"mag", " ", "\[Equal]", " ", "3"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"J", ",", " ", "Jd"}], "}"}], " ", "=", " ", 
          RowBox[{"J3", "[", "x", "]"}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"both", " ", "magnets", " ", "on"}], " ", "*)"}], 
         "\[IndentingNewLine]", "True", ",", " ", 
         RowBox[{
         "Throw", "[", "\"\<Invalid Magnet State for MotorInput\>\"", "]"}]}],
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"q", " ", "=", " ", 
        RowBox[{"x", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", "4"}], "\[RightDoubleBracket]"}]}], ";", " ", 
       RowBox[{"(*", " ", "configuration", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"qd", " ", "=", " ", 
        RowBox[{"x", "\[LeftDoubleBracket]", 
         RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}], ";", " ", 
       RowBox[{"(*", " ", "velocity", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Minv", " ", "=", " ", 
        RowBox[{"Inverse", "[", 
         RowBox[{"M", "[", "q", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"zi", " ", "=", " ", 
        RowBox[{"Minv", ".", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"fext", "[", 
            RowBox[{"x", ",", " ", "0"}], "]"}], " ", "-", " ", 
           RowBox[{"c", "[", "x", "]"}]}], ")"}]}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"zero", "-", 
         RowBox[{"input", " ", "acceleration"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"zs", " ", "=", " ", 
        RowBox[{"Minv", ".", "T"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"zero", "-", 
         RowBox[{"state", " ", "acceleration"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"J", " ", "\[NotEqual]", " ", 
          RowBox[{"{", "}"}]}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{"(*", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\[CapitalLambda]", " ", "=", " ", 
            RowBox[{"Inverse", "[", 
             RowBox[{"J", ".", "Minv", ".", 
              RowBox[{"J", "\[Transpose]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"zi", " ", "=", " ", 
            RowBox[{"zi", " ", "-", " ", 
             RowBox[{"Minv", ".", 
              RowBox[{"J", "\[Transpose]"}], ".", "\[CapitalLambda]", ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Jd", ".", "qd"}], " ", "+", " ", 
                RowBox[{"J", ".", "zi"}]}], ")"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"zs", " ", "=", " ", 
            RowBox[{"zs", " ", "-", " ", 
             RowBox[{"Minv", ".", 
              RowBox[{"J", "\[Transpose]"}], ".", "\[CapitalLambda]", ".", 
              "J", ".", "zs"}]}]}], ";"}], "\[IndentingNewLine]", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", " ", "=", " ", 
           RowBox[{"Minv", ".", 
            RowBox[{"J", "\[Transpose]"}], ".", 
            RowBox[{"Inverse", "[", 
             RowBox[{"J", ".", "Minv", ".", 
              RowBox[{"J", "\[Transpose]"}]}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"zi", " ", "=", " ", 
           RowBox[{"zi", " ", "-", " ", 
            RowBox[{"\[CapitalLambda]", ".", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Jd", ".", "qd"}], " ", "+", " ", 
               RowBox[{"J", ".", "zi"}]}], ")"}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[CapitalLambda]", " ", "=", " ", 
           RowBox[{"\[CapitalLambda]", ".", "J"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"zs", " ", "=", " ", 
           RowBox[{"zs", " ", "-", " ", 
            RowBox[{"\[CapitalLambda]", ".", "zs"}]}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "cancel", " ", "out", " ", "dynamics", " ", "and", " ", "add", " ", 
         "controller", " ", "v"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          RowBox[{"b", ".", "zi"}]}], "/", 
         RowBox[{"b", ".", "zs"}]}], " ", "+", " ", 
        RowBox[{"v", "/", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MatrixQ", "[", "b", "]"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Norm", "[", 
              RowBox[{"#", " ", "zs"}], "]"}], "&"}], "/@", " ", "b"}], ",", 
           " ", 
           RowBox[{"Norm", "[", 
            RowBox[{"b", " ", "zs"}], "]"}]}], "]"}]}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FreeFlightVelocity", "[", 
     RowBox[{
     "mag_", ",", " ", "q_", ",", " ", "\[CapitalDelta]x_", ",", " ", 
      "\[CapitalDelta]y_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "vcom", ",", " ", "\[Theta]d", ",", " ", "qd", ",", " ", "dP", ",", 
        " ", "dq", ",", " ", "c3", ",", " ", "s3", ",", " ", "c34", ",", " ", 
        "s34"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
         "solve", " ", "\[Theta]d", " ", "such", " ", "that", " ", "vcom"}], 
         " ", "=", " ", 
         RowBox[{"dP", ".", "\[Theta]d"}]}], ",", " ", 
        RowBox[{
         RowBox[{"where", " ", "\[Theta]d"}], " ", "=", " ", 
         RowBox[{
          RowBox[{"d", "/", "dt"}], 
          RowBox[{"{", 
           RowBox[{"\[Theta]1", ",", " ", "\[Theta]2"}], "}"}]}]}], ","}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"dP", " ", "=", " ", 
         RowBox[{
          RowBox[{"d", "/", "dq"}], " ", "Pcom"}]}], ",", " ", 
        RowBox[{
        "where", " ", "Pcom", " ", "is", " ", "the", " ", "center", " ", "of",
          " ", "mass", " ", "of", " ", "the", " ", "robot"}], ","}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "and", " ", "vcom", " ", "is", " ", "the", " ", "velocity", " ", "of", 
        " ", "the", " ", "center", " ", "of", " ", 
        RowBox[{"mass", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "unique", " ", "solutions", " ", "do", " ", "not", " ", "exist", " ", 
         "whenever", " ", 
         RowBox[{
         "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], " ", 
        "\[Equal]", " ", 
        RowBox[{"0", " ", "mod", " ", "\[Pi]"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"if", " ", 
          RowBox[{
          "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], " ", 
         "\[Equal]", " ", "0"}], ",", " ", 
        RowBox[{
         RowBox[{
         "then", " ", "a", " ", "line", " ", "of", " ", "slns", " ", "exist", 
          " ", "\[CapitalDelta]y"}], " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Tan", "[", 
            RowBox[{
            "q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
            "]"}], "/", "2"}], " ", 
          RowBox[{"\[CapitalDelta]x", "."}]}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dP", " ", "=", " ", 
        RowBox[{"dPcom", "[", 
         RowBox[{"mag", ",", " ", "q"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"vcom", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"g", " ", 
           RowBox[{"\[CapitalDelta]x", "/", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"2", " ", "g", " ", "\[CapitalDelta]y"}], "]"}]}]}], ",",
           " ", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"2", " ", "g", " ", "\[CapitalDelta]y"}], "]"}]}], "}"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"\[Theta]d", " ", "=", " ", 
        RowBox[{"LinearSolve", "[", 
         RowBox[{"dP", ",", " ", "vcom"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"return", " ", "qd"}], " ", "=", " ", 
         RowBox[{
          RowBox[{"d", "/", "dt"}], " ", 
          RowBox[{"{", 
           RowBox[{
           "qx", ",", " ", "qy", ",", " ", "q\[Theta]1", ",", " ", 
            "q\[Theta]2"}], "}"}], " ", "subject", " ", "to", " ", "a", " ", 
          "magnet", " ", "being", " ", "on"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"c3", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s3", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c34", " ", "=", " ", 
        RowBox[{"Cos", "[", 
         RowBox[{
          RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s34", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{
          RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           "+", 
          RowBox[{
          "q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "dPcom", " ", "already", " ", "does", " ", "a", " ", "sanity", " ", 
         "check", " ", "on", " ", "magnet", " ", "values"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"dq", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"mag", " ", "\[Equal]", " ", "1"}], ",", " ", 
          TagBox[
           RowBox[{"(", "\[NoBreak]", GridBox[{
              {"0", "0"},
              {"0", "0"},
              {"1", "0"},
              {"0", "1"}
             },
             
             GridBoxAlignment->{
              "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
               "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
             GridBoxSpacings->{"Columns" -> {
                 Offset[0.27999999999999997`], {
                  Offset[0.7]}, 
                 Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, 
               "Rows" -> {
                 Offset[0.2], {
                  Offset[0.4]}, 
                 Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
           Function[BoxForm`e$, 
            MatrixForm[BoxForm`e$]]], ",", " ", 
          TagBox[
           TagBox[
            RowBox[{"(", "\[NoBreak]", GridBox[{
               {
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "L1"}], " ", "c3"}], "-", 
                 RowBox[{"L2", " ", "c34"}]}], 
                RowBox[{
                 RowBox[{"-", "L2"}], " ", "c34"}]},
               {
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "L1"}], " ", "s3"}], "-", 
                 RowBox[{"L2", " ", "s34"}]}], 
                RowBox[{
                 RowBox[{"-", "L2"}], " ", "s34"}]},
               {"1", "0"},
               {"0", "1"}
              },
              
              GridBoxAlignment->{
               "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
                "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
              GridBoxSpacings->{"Columns" -> {
                  Offset[0.27999999999999997`], {
                   Offset[0.7]}, 
                  Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, 
                "Rows" -> {
                  Offset[0.2], {
                   Offset[0.4]}, 
                  Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
            Function[BoxForm`e$, 
             MatrixForm[BoxForm`e$]]],
           Function[BoxForm`e$, 
            MatrixForm[BoxForm`e$]]]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dq", ".", "\[Theta]d"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MinimizeFreeFlight", "[", 
     RowBox[{
     "mag_", ",", " ", "\[CapitalDelta]x_", ",", " ", "\[CapitalDelta]y_"}], 
     "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "q", ",", " ", "qx", ",", "qy", ",", " ", "q\[Theta]1", ",", " ", 
        "q\[Theta]2", ",", " ", "\[Theta]", ",", " ", "\[Theta]d"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"solve", " ", "\[Theta]", " ", "such", " ", "that", " ", 
         RowBox[{"1", "/", "2"}], " ", 
         RowBox[{"\[Theta]d", ".", "\[Theta]d"}], " ", "is", " ", 
         "minimized"}], ",", " ", 
        RowBox[{
        "where", " ", "\[Theta]d", " ", "is", " ", "the", " ", "initial"}]}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "velocity", " ", "during", " ", "free", " ", "flight", " ", "required",
         " ", "to", " ", "travel", " ", "a", " ", "distance", " ", "of", " ", 
        "\[CapitalDelta]x", " ", "at"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"a", " ", "maximum", " ", "height", " ", "\[CapitalDelta]y"}],
         ",", " ", 
        RowBox[{
         RowBox[{"and", " ", "\[Theta]"}], " ", "=", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"q\[Theta]1", ",", " ", "q\[Theta]2"}], "}"}], " ", "for", 
          " ", "when", " ", "the", " ", "robot", " ", "has", " ", 
          "only"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"one", " ", "magnet", " ", "on", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"a", " ", "\"\<pinned\>\"", " ", "configuration"}], ")"}], 
         "."}]}], " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mag", " ", "\[Equal]", " ", "1"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"qx", ",", " ", "qy"}], "}"}], " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0"}], "}"}]}], ",", "\[IndentingNewLine]", 
         
         RowBox[{"mag", " ", "\[Equal]", " ", "2"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"qx", ",", " ", "qy"}], "}"}], " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"-", "L1"}], " ", 
              RowBox[{"Sin", "[", "q\[Theta]1", "]"}]}], "-", 
             RowBox[{"L2", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"q\[Theta]1", "+", "q\[Theta]2"}], "]"}]}]}], ",", " ", 
            RowBox[{
             RowBox[{"L1", " ", 
              RowBox[{"Cos", "[", "q\[Theta]1", "]"}]}], "+", 
             RowBox[{"L2", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"q\[Theta]1", "+", "q\[Theta]2"}], "]"}]}]}]}], 
           "}"}]}], ",", "\[IndentingNewLine]", "True", ",", " ", 
         RowBox[{
         "Throw", "[", "\"\<Invalid magnet state for MinimizeFreeFlight\>\"", 
          "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"q", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
         "qx", ",", "qy", ",", " ", "q\[Theta]1", ",", " ", "q\[Theta]2"}], 
         "}"}]}], ";", " ", 
       RowBox[{"(*", " ", "configuration", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Theta]d", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"FreeFlightVelocity", "[", 
           RowBox[{
           "mag", ",", " ", "q", ",", " ", "\[CapitalDelta]x", ",", " ", 
            "\[CapitalDelta]y"}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"3", ";;", "4"}], "\[RightDoubleBracket]"}], " ", "//", " ",
          "Simplify"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"q\[Theta]1", ",", " ", "q\[Theta]2"}], "}"}], " ", "=", " ", 
        RowBox[{"ArgMin", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"1", "/", "2"}], 
           RowBox[{"\[Theta]d", ".", "\[Theta]d"}]}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"q\[Theta]1", ",", " ", "q\[Theta]2"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Join", "[", 
        RowBox[{"q", ",", " ", 
         RowBox[{"FreeFlightVelocity", "[", 
          RowBox[{
          "mag", ",", " ", "q", ",", " ", "\[CapitalDelta]x", ",", " ", 
           "\[CapitalDelta]y"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MaximizeFreeFlight", "[", 
     RowBox[{
     "mag_", ",", " ", "\[CapitalDelta]x_", ",", " ", "\[CapitalDelta]y_", 
      ",", " ", 
      RowBox[{"\[Alpha]_:", "1"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "q", ",", " ", "qx", ",", "qy", ",", " ", "q\[Theta]1", ",", " ", 
        "q\[Theta]2", ",", " ", "\[Theta]", ",", " ", "\[Theta]d"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"solve", " ", "\[Theta]", " ", "such", " ", "that", " ", 
          RowBox[{"1", "/", "2"}], " ", 
          RowBox[{"\[Theta]d", ".", "\[Theta]d"}], " ", "is", " ", 
          "maximized", " ", "subject", " ", "to", " ", 
          RowBox[{
          "\[Theta]d", "\[LeftDoubleBracket]", "3", 
           "\[RightDoubleBracket]"}]}], " ", "=", " ", 
         RowBox[{"\[Alpha]", " ", 
          RowBox[{
          "\[Theta]d", "\[LeftDoubleBracket]", "4", 
           "\[RightDoubleBracket]"}]}]}], ","}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "where", " ", "\[Theta]d", " ", "is", " ", "the", " ", "initial", " ", 
        "velocity", " ", "during", " ", "free", " ", "flight", " ", 
        "required", " ", "to", " ", "travel"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "a", " ", "distance", " ", "of", " ", "\[CapitalDelta]x", " ", "at", 
         " ", "a", " ", "maximum", " ", "height", " ", "\[CapitalDelta]y"}], 
        ",", " ", 
        RowBox[{
         RowBox[{"and", " ", "\[Theta]"}], " ", "=", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"q\[Theta]1", ",", " ", "q\[Theta]2"}], "}"}], " ", "for", 
          " ", "when", " ", "the"}]}]}], " ", "*)"}], " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "robot", " ", "has", " ", "only", " ", "one", " ", "magnet", " ", "on",
         " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"a", " ", "\"\<pinned\>\"", " ", "configuration"}], ")"}], 
         "."}]}], " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mag", " ", "\[Equal]", " ", "1"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"qx", ",", " ", "qy"}], "}"}], " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0"}], "}"}]}], ",", "\[IndentingNewLine]", 
         
         RowBox[{"mag", " ", "\[Equal]", " ", "2"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"qx", ",", " ", "qy"}], "}"}], " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"-", "L1"}], " ", 
              RowBox[{"Sin", "[", "q\[Theta]1", "]"}]}], "-", 
             RowBox[{"L2", " ", 
              RowBox[{"Sin", "[", 
               RowBox[{"q\[Theta]1", "+", "q\[Theta]2"}], "]"}]}]}], ",", " ", 
            RowBox[{
             RowBox[{"L1", " ", 
              RowBox[{"Cos", "[", "q\[Theta]1", "]"}]}], "+", 
             RowBox[{"L2", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"q\[Theta]1", "+", "q\[Theta]2"}], "]"}]}]}]}], 
           "}"}]}], ",", "\[IndentingNewLine]", "True", ",", " ", 
         RowBox[{
         "Throw", "[", "\"\<Invalid magnet state for MaximizeFreeFlight\>\"", 
          "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"q", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
         "qx", ",", "qy", ",", " ", "q\[Theta]1", ",", " ", "q\[Theta]2"}], 
         "}"}]}], ";", " ", 
       RowBox[{"(*", " ", "configuration", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Theta]d", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"FreeFlightVelocity", "[", 
           RowBox[{
           "mag", ",", " ", "q", ",", " ", "\[CapitalDelta]x", ",", " ", 
            "\[CapitalDelta]y"}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"3", ";;", "4"}], "\[RightDoubleBracket]"}], " ", "//", " ",
          "Simplify"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"q\[Theta]1", ",", " ", "q\[Theta]2"}], "}"}], " ", "=", " ", 
        RowBox[{"ArgMax", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"1", "/", "2"}], 
             RowBox[{"\[Theta]d", ".", "\[Theta]d"}]}], ",", " ", 
            RowBox[{
             RowBox[{
             "\[Theta]d", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], " ", "\[Equal]", " ", 
             RowBox[{"\[Alpha]", " ", 
              RowBox[{
              "\[Theta]d", "\[LeftDoubleBracket]", "2", 
               "\[RightDoubleBracket]"}]}]}]}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"q\[Theta]1", ",", " ", "q\[Theta]2"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"visualize", " ", "cost", " ", "function"}], ",", " ", 
         RowBox[{"useful", " ", "for", " ", "debugging"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", "\[IndentingNewLine]", 
        RowBox[{"ParametricPlot", "[", 
         RowBox[{"\[Theta]d", ",", " ", 
          RowBox[{"{", 
           RowBox[{"q\[Theta]1", ",", " ", 
            RowBox[{"-", "\[Pi]"}], ",", "\[Pi]"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"q\[Theta]2", ",", " ", 
            RowBox[{"-", "\[Pi]"}], ",", "\[Pi]"}], "}"}], ",", " ", 
          RowBox[{"Epilog", "\[Rule]", " ", 
           RowBox[{"InfiniteLine", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{"\[Alpha]", ",", "1"}], "}"}]}], "}"}], "]"}]}]}], 
         "]"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Join", "[", 
        RowBox[{"q", ",", " ", 
         RowBox[{"FreeFlightVelocity", "[", 
          RowBox[{
          "mag", ",", " ", "q", ",", " ", "\[CapitalDelta]x", ",", " ", 
           "\[CapitalDelta]y"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DrawGibbot", "[", 
     RowBox[{"mag_", ",", " ", "x_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "Graphics", "]"}]}]}], "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "P", ",", " ", "psz", ",", " ", "ma", ",", " ", "com", ",", " ", "mo", 
        ",", " ", "li"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"psz", " ", "=", " ", 
        RowBox[{"0.01", " ", 
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{"L1", ",", " ", "L2"}], "]"}], "/", "0.3"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"get", " ", "positions"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"P", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", "\[LeftDoubleBracket]", 
           RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], ",", " ", 
          RowBox[{"P1", "[", "x", "]"}], ",", " ", 
          RowBox[{"P2", "[", "x", "]"}], ",", " ", 
          RowBox[{"P3", "[", "x", "]"}], ",", " ", 
          RowBox[{"P4", "[", "x", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", "motor", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"mo", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"Red", ",", " ", 
          RowBox[{"Disk", "[", 
           RowBox[{
            RowBox[{
            "P", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], ",", 
            " ", 
            RowBox[{"2", "psz"}]}], "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "center", " ", "of", " ", "mass", " ", "of", " ", "each", " ", 
         "link"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"com", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"Gray", ",", " ", 
          RowBox[{"Disk", "[", 
           RowBox[{
            RowBox[{
            "P", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            " ", "psz"}], "]"}], ",", " ", 
          RowBox[{"Disk", "[", 
           RowBox[{
            RowBox[{
            "P", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ",", 
            " ", "psz"}], "]"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"magnets", ":", " ", "on"}], " ", "\[Rule]", " ", "dark"}], 
         ",", " ", 
         RowBox[{"off", " ", "\[Rule]", " ", "light"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ma", " ", "=", " ", 
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mag", " ", "\[Equal]", " ", "0"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"LightRed", ",", " ", "LightRed"}], "}"}], ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{"mag", " ", "\[Equal]", " ", "1"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"Red", ",", " ", "LightRed"}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"mag", " ", "\[Equal]", " ", "2"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"LightRed", ",", " ", "Red"}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"mag", " ", "\[Equal]", " ", "3"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"Red", ",", " ", "Red"}], "}"}]}], "\[IndentingNewLine]", 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ma", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
          "ma", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
          " ", 
          RowBox[{"Disk", "[", 
           RowBox[{
            RowBox[{
            "P", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
            " ", "psz"}], "]"}], ",", " ", 
          RowBox[{
          "ma", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
          " ", 
          RowBox[{"Disk", "[", 
           RowBox[{
            RowBox[{
            "P", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], ",", 
            " ", "psz"}], "]"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", "links", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"li", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"Thick", ",", " ", "Black", ",", " ", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{"P", "\[LeftDoubleBracket]", 
             RowBox[{"{", 
              RowBox[{"1", ",", "4", ",", "5"}], "}"}], 
             "\[RightDoubleBracket]"}], "}"}], "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Graphics", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"li", ",", " ", "mo", ",", " ", "ma", ",", " ", "com"}], 
          "}"}], ",", " ", "opts"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"FixAngles", ",", " ", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FixAngles", "[", "q_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "x", "}"}], ",", " ", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{" ", 
        RowBox[{
        "make", " ", "sure", " ", "angles", " ", "are", " ", "btw", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "pi"}], " ", "pi"}]}]}], "]"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"Mod", "[", 
         RowBox[{"q", ",", " ", 
          RowBox[{"2", "\[Pi]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"x", ">", "\[Pi]"}], ",", " ", 
         RowBox[{"x", " ", "-", " ", 
          RowBox[{"2", "\[Pi]"}]}], ",", " ", "x"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FixState", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"y", " ", "=", " ", "x"}], ",", " ", "n"}], "}"}], ",", " ", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", " ", "=", " ", "4"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ListQ", "[", 
          RowBox[{"y", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"y", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{"3", ";;", "4"}]}], "\[RightDoubleBracket]"}], " ", "=", 
          " ", 
          RowBox[{"FixAngles", "[", 
           RowBox[{"y", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", " ", 
             RowBox[{"3", ";;", "4"}]}], "\[RightDoubleBracket]"}], "]"}]}], 
         ",", " ", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"y", "\[LeftDoubleBracket]", 
           RowBox[{"3", ";;", "4"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
          RowBox[{"FixAngles", "[", 
           RowBox[{"y", "\[LeftDoubleBracket]", 
            RowBox[{"3", ";;", "4"}], "\[RightDoubleBracket]"}], "]"}]}]}], 
        "]"}], ";", "\[IndentingNewLine]", "y"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.5844197483839703`*^9, {3.5844250604318256`*^9, 3.5844250721475377`*^9}, {
   3.5844251233785*^9, 3.5844251234877005`*^9}, {3.5844253988774505`*^9, 
   3.5844254390946617`*^9}, {3.5844254919948354`*^9, 3.5844254990149255`*^9}, 
   3.584425543397398*^9, {3.584425574800518*^9, 3.584425581945394*^9}, {
   3.5844256737523947`*^9, 3.5844257230957055`*^9}, {3.5844279668250203`*^9, 
   3.5844279860756264`*^9}, {3.584428374816189*^9, 3.584428378919037*^9}, {
   3.5914865865694637`*^9, 3.591486626255737*^9}, {3.5914867823906765`*^9, 
   3.5914867827646985`*^9}, {3.591486817520689*^9, 3.5914868205858636`*^9}, {
   3.591486965884186*^9, 3.5914869664642324`*^9}, {3.5915022447717495`*^9, 
   3.5915022459698176`*^9}, {3.591542902441803*^9, 3.591542929051241*^9}, {
   3.59154329988008*^9, 3.591543327692632*^9}, 3.5915439898189273`*^9, {
   3.5915443331789765`*^9, 3.5915443348977413`*^9}, {3.591544409656703*^9, 
   3.591544412687962*^9}, {3.591721260928192*^9, 3.591721326772053*^9}, {
   3.5922422663532963`*^9, 3.592242267056429*^9}, {3.5922818277082567`*^9, 
   3.59228183637475*^9}, {3.593367653922082*^9, 3.5933676540470953`*^9}, {
   3.60224862205973*^9, 3.602248628162079*^9}, {3.618410239888734*^9, 
   3.618410243607942*^9}, {3.618411402838331*^9, 3.6184114053624744`*^9}, 
   3.618648264733282*^9, {3.618648379655821*^9, 3.6186484159840155`*^9}, {
   3.6186600689430113`*^9, 3.618660147690508*^9}, 3.61866274541527*^9, {
   3.6186633481607847`*^9, 3.6186633510349493`*^9}, 3.618663382293741*^9, {
   3.618664471157302*^9, 3.6186644734544353`*^9}, 3.618676224046091*^9, {
   3.6186981040546894`*^9, 3.6186981152563276`*^9}, {3.6196234592833757`*^9, 
   3.6196234777521663`*^9}, {3.619623515299116*^9, 3.6196235156741133`*^9}, 
   3.6196328601116304`*^9, 3.6196401674237742`*^9, {3.6196488597011433`*^9, 
   3.619648863131336*^9}, {3.6196492958539968`*^9, 3.6196493018480144`*^9}, {
   3.619650251272032*^9, 3.6196504742620487`*^9}, 3.619650665427994*^9, {
   3.6196507656223774`*^9, 3.619650833773438*^9}, {3.6196523917501316`*^9, 
   3.6196524111052427`*^9}, {3.6196528648799553`*^9, 3.619652901014676*^9}, {
   3.6196578897032647`*^9, 3.619657991034055*^9}, {3.619658030577319*^9, 
   3.6196580384157686`*^9}, {3.619658163576936*^9, 3.6196581661690845`*^9}, {
   3.619658254715153*^9, 3.619658255251199*^9}, {3.619658620842122*^9, 
   3.619658664420618*^9}, {3.6197419655520043`*^9, 3.6197419751613955`*^9}, {
   3.6197529087892003`*^9, 3.619752914554837*^9}, {3.6197529853674746`*^9, 
   3.6197531276802497`*^9}, {3.619831201246524*^9, 3.6198312626372876`*^9}, {
   3.6198321902485676`*^9, 3.6198322071392403`*^9}, {3.6198693533094535`*^9, 
   3.6198693660438504`*^9}, {3.6289931356527596`*^9, 
   3.6289931597278786`*^9}, {3.6289931990588293`*^9, 
   3.6289932002276473`*^9}, {3.6289935174160986`*^9, 
   3.6289935434786215`*^9}, {3.628999690999849*^9, 3.6289996940029626`*^9}, {
   3.6290874696346054`*^9, 3.629087496195485*^9}, {3.6290893794609632`*^9, 
   3.6290893878469396`*^9}, 3.6290896294286284`*^9, {3.6290896777369585`*^9, 
   3.629089856925326*^9}, {3.6290901996289024`*^9, 3.6290903470286636`*^9}, {
   3.6290903788752985`*^9, 3.6290904769489727`*^9}, {3.6290941716047225`*^9, 
   3.629094189846675*^9}, {3.629094236592229*^9, 3.629094250795303*^9}, {
   3.629094284635376*^9, 3.6290943321701436`*^9}, {3.6290950649229198`*^9, 
   3.6290950763900695`*^9}, {3.629096692277546*^9, 3.629096794749364*^9}, {
   3.6291371605944824`*^9, 3.6291371759584045`*^9}, {3.6293296264268723`*^9, 
   3.6293296570054536`*^9}, {3.629329828179557*^9, 3.629329851164239*^9}, {
   3.6293303783900037`*^9, 3.6293303895620413`*^9}, {3.6293316179533696`*^9, 
   3.6293317690178957`*^9}, {3.629333385556221*^9, 3.6293334228692465`*^9}, {
   3.6293335228862004`*^9, 3.6293335269956183`*^9}, {3.629333619715615*^9, 
   3.629333755795559*^9}, 3.629333835171608*^9, {3.6293341680041604`*^9, 
   3.629334181613716*^9}, {3.6293342520209026`*^9, 3.62933427814625*^9}, {
   3.6293343940540133`*^9, 3.6293343971009283`*^9}, {3.6293346816828413`*^9, 
   3.6293346820109997`*^9}, {3.6293354129957447`*^9, 3.629335442855516*^9}, {
   3.629335490621723*^9, 3.6293355244972005`*^9}, {3.629335585966768*^9, 
   3.62933559316999*^9}, {3.6293356337642803`*^9, 3.629335747609542*^9}, {
   3.6293357895944767`*^9, 3.6293358964771442`*^9}, {3.629336178762163*^9, 
   3.6293362466224403`*^9}, {3.629338835081946*^9, 3.629338837488228*^9}, {
   3.629469374846306*^9, 3.629469520599386*^9}, {3.6294696371502223`*^9, 
   3.6294696386572943`*^9}, {3.6294697994025893`*^9, 
   3.6294698796015825`*^9}, {3.6294699779865155`*^9, 
   3.6294699882988653`*^9}, {3.629470024010219*^9, 3.6294700654466753`*^9}, {
   3.629470145532591*^9, 3.629470233162876*^9}, {3.6294702664445305`*^9, 
   3.629470480376577*^9}, {3.6294705325987005`*^9, 3.6294705825211725`*^9}, {
   3.629470633836641*^9, 3.629470843753844*^9}, {3.6294709340320063`*^9, 
   3.6294710398922396`*^9}, {3.6294710849512625`*^9, 
   3.6294710858819284`*^9}, {3.629471160657074*^9, 3.6294711886569743`*^9}, {
   3.6294712261186223`*^9, 3.629471327358551*^9}, {3.6294789185643525`*^9, 
   3.629478968165583*^9}, {3.6294790760272665`*^9, 3.6294790858512487`*^9}, 
   3.6294792689984083`*^9, {3.629479348920209*^9, 3.62947936517177*^9}, {
   3.6294794720807533`*^9, 3.629479472167816*^9}, {3.6294802024698644`*^9, 
   3.6294803962515755`*^9}, {3.629480426413014*^9, 3.629480448688848*^9}, {
   3.6294805310213757`*^9, 3.629480531197501*^9}, {3.6294805806026073`*^9, 
   3.6294806036570005`*^9}, {3.6294806700131617`*^9, 
   3.6294806750417356`*^9}, {3.629480718810835*^9, 3.62948071937222*^9}, {
   3.6294807807848916`*^9, 3.62948079389318*^9}, {3.6294808463164663`*^9, 
   3.6294808465736485`*^9}, {3.629480880129498*^9, 3.6294808803366456`*^9}, {
   3.629481404771348*^9, 3.6294814952326717`*^9}, {3.629481650607094*^9, 
   3.629481655709719*^9}, {3.6294822726782255`*^9, 3.629482305426502*^9}, {
   3.6295020831260214`*^9, 3.629502115830265*^9}, 3.629502480571497*^9, 
   3.629502663221318*^9, {3.6296676436468954`*^9, 3.6296676716004066`*^9}, {
   3.629668043292823*^9, 3.629668133122157*^9}, {3.629668351468812*^9, 
   3.629668376797289*^9}, {3.6296684209228773`*^9, 3.62966848243932*^9}, {
   3.6296688800852356`*^9, 3.629669003055621*^9}, {3.6296690594782486`*^9, 
   3.629669206808332*^9}, 3.629669250605791*^9, {3.6296693133097496`*^9, 
   3.6296693164504166`*^9}, {3.6296700157409716`*^9, 
   3.6296700272723603`*^9}, {3.6296700730698586`*^9, 3.629670079960574*^9}, {
   3.629670529154052*^9, 3.6296705697795906`*^9}, {3.6296706037019176`*^9, 
   3.62967061459272*^9}, {3.6296706541244636`*^9, 3.6296706552807302`*^9}, {
   3.6296707370318174`*^9, 3.629670771235397*^9}, {3.629670859970951*^9, 
   3.629670861299096*^9}, 3.629670899908986*^9, 3.6296709316125326`*^9, {
   3.629672354975218*^9, 3.6296724440232563`*^9}, {3.6296726898103933`*^9, 
   3.6296727258577137`*^9}, {3.6296814222491016`*^9, 3.629681422717843*^9}, {
   3.62974088646299*^9, 3.6297408873692675`*^9}, {3.629740922416609*^9, 
   3.629740953213866*^9}, {3.629741219935405*^9, 3.6297412374356527`*^9}, {
   3.6297520612432384`*^9, 3.629752063446393*^9}, {3.629752346178745*^9, 
   3.6297523844605*^9}, {3.629752431929887*^9, 3.629752436523698*^9}, {
   3.6297525230248504`*^9, 3.629752575541169*^9}, {3.6297526214636602`*^9, 
   3.6297526266512284`*^9}, {3.6297529749199686`*^9, 
   3.6297529952014885`*^9}, {3.629753113437434*^9, 3.629753126906358*^9}, {
   3.6297534590623703`*^9, 3.6297534621717887`*^9}, {3.629753670221429*^9, 
   3.6297537353316727`*^9}, 3.629753835557296*^9, {3.6297545427237225`*^9, 
   3.6297546319124126`*^9}, {3.6297567457410374`*^9, 
   3.6297567463191805`*^9}, {3.6297575150921135`*^9, 
   3.6297575190764837`*^9}, {3.6297575693727417`*^9, 
   3.6297575869042463`*^9}, {3.6297576342017293`*^9, 3.629757634279849*^9}, {
   3.6298513958126945`*^9, 3.6298514023033075`*^9}, {3.6298529706009817`*^9, 
   3.6298529706664724`*^9}, {3.6298533121690636`*^9, 
   3.6298533182801228`*^9}, {3.630762287146578*^9, 3.6307623468585434`*^9}, {
   3.6307624095314655`*^9, 3.6307624761200447`*^9}, {3.6307644620563707`*^9, 
   3.63076446207938*^9}, {3.6312825570987663`*^9, 3.63128256013291*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"g", "::", "shdw"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Symbol \[NoBreak]\\!\\(\\\"g\\\"\\)\[NoBreak] appears in \
multiple contexts \[NoBreak]\\!\\({\\\"GibbotQnts`\\\", \\\"Global`\\\"}\\)\
\[NoBreak]; definitions in context \[NoBreak]\\!\\(\\\"GibbotQnts`\\\"\\)\
\[NoBreak] may shadow or be shadowed by other definitions. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, ButtonData:>\\\"paclet:ref/message/General/shdw\\\", \
ButtonNote -> \\\"GibbotQnts`g::shdw\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.631447073929022*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Examples", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.6289934659285192`*^9, 3.6289934886106005`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"robot", " ", 
     RowBox[{"configuration", ":", " ", "q"}]}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
     "qx", ",", " ", "qy", ",", " ", "q\[Theta]1", ",", " ", "q\[Theta]2"}], 
     "}"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"mag", " ", "=", " ", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "3"}], "}"}], "]"}]}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"magnet", " ", 
      RowBox[{"state", ":", " ", "0"}]}], " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"both", " ", "off"}], "..."}], "3"}], " ", "=", " ", 
      RowBox[{"both", " ", "on"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"x", " ", "=", " ", 
    RowBox[{"RandomReal", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", " ", "8"}], "]"}]}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"robot", " ", 
     RowBox[{"state", ":", " ", 
      RowBox[{"{", 
       RowBox[{"q", ",", " ", 
        RowBox[{"dq", "/", "dt"}]}], "}"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"u", " ", "=", " ", 
    RowBox[{"RandomReal", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"motor", " ", "output"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dx", " ", "=", " ", 
     RowBox[{"2", "L1"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"free", " ", "flight", " ", 
     RowBox[{"distance", " ", "@", " ", "maximum"}], " ", "height"}], " ", 
    "*)"}], "\n", 
   RowBox[{
    RowBox[{"dy", " ", "=", " ", "L1"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "maximum", " ", "height", " ", "during", " ", "free", " ", "flight"}], 
    " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "errors", " ", "and", " ", "bizarre", " ", "answers", " ", "may", " ", 
     "result", " ", "if", " ", "constraint", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Jmag", "[", "q", "]"}], ".", "dq"}], "/", "dt"}], " ", 
     RowBox[{"isn", "'"}], "t", " ", "satisfied"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"dynamics", " ", "and", " ", "impacts"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"DynamicQnts", "[", 
    RowBox[{"mag", ",", " ", "x", ",", " ", "u"}], "]"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "returns", " ", "accelerations", " ", "and", " ", "tangential", " ", 
     "loads", " ", "on", " ", "each", " ", "magnet"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"ImpactQnts", "[", 
    RowBox[{"mag", ",", " ", "x"}], "]"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"returns", " ", "post"}], "-", 
     RowBox[{
     "impact", " ", "state", " ", "and", " ", "impulse", " ", "felt", " ", 
      "by", " ", "each", " ", "magnet"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"input", " ", "torque", " ", "from", " ", "motor"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"b", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "vector", " ", "for", " ", "finding", " ", "a", " ", "u", " ", "such", 
      " ", "that", " ", 
      RowBox[{"b", ".", "qdd"}]}], " ", "=", " ", "0"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"u", " ", "=", " ", 
    RowBox[{"MotorInput", "[", 
     RowBox[{"mag", ",", " ", "x", ",", " ", "b"}], "]"}]}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "input", " ", "torque", " ", "needed", " ", "to", " ", "make", " ", 
      RowBox[{
       RowBox[{"d", "^", "2"}], "/", 
       RowBox[{"dt", "^", "2"}]}], " ", "q\[Theta]2"}], " ", "=", " ", "0"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DynamicQnts", "[", 
      RowBox[{"mag", ",", " ", "x", ",", " ", "u"}], "]"}], 
     "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", "//", " ", 
    "Chop"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "double", " ", "pendulum", " ", "to", " ", "free", " ", "flight"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"0", " ", "<", " ", "mag", " ", "<", " ", "3"}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"FreeFlightVelocity", "[", 
      RowBox[{"mag", ",", " ", "x", ",", " ", "dx", ",", " ", "dy"}], "]"}]}],
     " ", 
    RowBox[{"(*", " ", 
     RowBox[{
     "returns", " ", "velocity", " ", "required", " ", "to", " ", "travel", 
      " ", 
      RowBox[{"(", 
       RowBox[{"dx", ",", " ", "dy"}], ")"}]}], " ", "*)"}], 
    "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"0", " ", "<", " ", "mag", " ", "<", " ", "3"}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"MinimizeFreeFlight", "[", 
      RowBox[{"mag", ",", " ", "dx", ",", " ", "dy"}], "]"}]}], " ", 
    RowBox[{"(*", " ", 
     RowBox[{
     "returns", " ", "state", " ", "that", " ", "minimizes", " ", "velocity", 
      " ", "required"}], " ", "*)"}], "\[IndentingNewLine]", "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"0", " ", "<", " ", "mag", " ", "<", " ", "3"}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"MaximizeFreeFlight", "[", 
      RowBox[{"mag", ",", " ", "dx", ",", " ", "dy", ",", " ", 
       RowBox[{"1", "/", "2"}]}], "]"}]}], " ", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
      "returns", " ", "state", " ", "that", " ", "maximizes", " ", "velocity",
        " ", "subject", " ", "to", " ", 
       RowBox[{"d", "/", "dt"}], " ", "q3"}], " ", "\[Equal]", " ", 
      RowBox[{
       RowBox[{"1", "/", "2"}], " ", 
       RowBox[{"d", "/", "dt"}], " ", "q4"}]}], " ", "*)"}], 
    "\[IndentingNewLine]", "]"}], " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"DrawGibbot", "[", 
    RowBox[{"mag", ",", " ", "x"}], "]"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "returns", " ", "a", " ", "graphic", " ", "of", " ", "the", " ", 
     "gibbot"}], " ", "*)"}]}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQA2IQHbt7dtVBzteOUe/ugOkTVVJrjwBpjQVMm0F0kVb8
LhC9yY5xL4jm87vr9wFI7zFgDgLRRxb4hYFopfQpySD6Vepx9o9AOujyBD4Q
fWmnzNxPQHofA8MCEL1ZstnmC5AWMrzmAKLZPCUngGif/jWTQfS3DReNObhe
O34qMTYB0dKFLXczgPSS2RP4MoH0EYVYERDdpPpQEkR3aSbLgWiDnYUGIPrY
nhITEC10YJYFiNb4IhoGoh+WvAXTerX8q1YB6SKVFWCa4az8eRAtLfIcTBvp
v47i4X7t+Gbj+VgQfWcXawaIfrKLG0zv+7Z6DYj+U71jE4iOmVj9ywRIawh2
gekv0mrspkA6TTGSF0QDAPjEn9g=
  "]]
}, Closed]],

Cell[CellGroupData[{

Cell["Specs", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.6289934659285192`*^9, 3.6289934886106005`*^9}, {3.629138508061183*^9, 
  3.629138516540187*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{
     RowBox[{"s_", "?", "NumericQ"}], ",", " ", "q_", ",", " ", "qd_"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "x", "}"}], ",", " ", 
     RowBox[{
      RowBox[{"x", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"q", ",", "qd"}], "]"}]}], ";", " ", 
      RowBox[{"First", "@", 
       RowBox[{"DynamicQnts", "[", 
        RowBox[{"mag", ",", " ", "x", ",", " ", 
         RowBox[{"u", "[", 
          RowBox[{"s", ",", " ", "x"}], "]"}]}], "]"}]}]}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{3.6297582460562477`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"V", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"E", ",", " ", "Emax"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Emax", " ", "=", " ", 
        RowBox[{"TE", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\[Pi]", ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", " ", "4"}], "]"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"E", " ", "=", " ", 
        RowBox[{
         RowBox[{"TE", "[", "x", "]"}], " ", "-", " ", "Emax"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"1", "/", "2"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ke", " ", 
           RowBox[{"E", "^", "2"}]}], " ", "+", " ", 
          RowBox[{"kp", " ", 
           RowBox[{
            RowBox[{
            "x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], "^", 
            "2"}]}], " ", "+", " ", 
          RowBox[{"kd", " ", 
           RowBox[{
            RowBox[{
            "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}], "^", 
            "2"}]}]}], ")"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Vdot", "[", 
     RowBox[{"x_", ",", " ", "u_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"E", ",", " ", "Emax", ",", " ", "qdd"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"qdd", " ", "=", " ", 
        RowBox[{"First", "@", 
         RowBox[{"DynamicQnts", "[", 
          RowBox[{"mag", ",", " ", "x", ",", " ", "u"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Emax", " ", "=", " ", 
        RowBox[{"TE", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\[Pi]", ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", " ", "4"}], "]"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"E", " ", "=", " ", 
        RowBox[{
         RowBox[{"TE", "[", "x", "]"}], " ", "-", " ", "Emax"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ke", " ", "E", " ", "u"}], " ", "+", " ", 
          RowBox[{"kd", " ", 
           RowBox[{
           "qdd", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
          " ", "+", " ", 
          RowBox[{"kp", " ", 
           RowBox[{
           "x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}]}], 
         ")"}], 
        RowBox[{
        "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"zizs", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "f", ",", " ", "J", ",", " ", "Jd", ",", " ", "Minv", ",", " ", "zi", 
        ",", " ", "zs", ",", " ", "\[CapitalLambda]"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mag", " ", "\[Equal]", " ", "1"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"J", ",", " ", "Jd"}], "}"}], " ", "=", " ", 
          RowBox[{"GibbotQnts`Private`J1", "[", "x", "]"}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"magnet", " ", "on", " ", "link", " ", "1", " ", "on"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"mag", " ", "\[Equal]", " ", "2"}], ",", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"J", ",", " ", "Jd"}], "}"}], " ", "=", " ", 
          RowBox[{"GibbotQnts`Private`J2", "[", "x", "]"}]}], ",", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"magnet", " ", "on", " ", "link", " ", "2", " ", "on"}], 
          " ", "*)"}], "\[IndentingNewLine]", "True", ",", " ", 
         RowBox[{
         "Throw", "[", "\"\<Invalid Magnet State for zizs\>\"", "]"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Minv", " ", "=", " ", 
        RowBox[{"Inverse", "[", 
         RowBox[{"GibbotQnts`Private`M", "[", 
          RowBox[{"x", "\[LeftDoubleBracket]", 
           RowBox[{"1", ";;", "4"}], "\[RightDoubleBracket]"}], "]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"f", " ", "=", " ", 
        RowBox[{
         RowBox[{"GibbotQnts`Private`fext", "[", 
          RowBox[{"x", ",", " ", "0"}], "]"}], " ", "-", " ", 
         RowBox[{"GibbotQnts`Private`c", "[", "x", "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"zi", " ", "=", " ", 
        RowBox[{"Minv", ".", "f"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"zero", "-", 
         RowBox[{"input", " ", "acceleration"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"zs", " ", "=", " ", 
        RowBox[{"Minv", ".", "T"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"zero", "-", 
         RowBox[{"state", " ", "acceleration"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"\[CapitalLambda]", " ", "=", " ", 
        RowBox[{"Minv", ".", 
         RowBox[{"J", "\[Transpose]"}], ".", 
         RowBox[{"Inverse", "[", 
          RowBox[{"J", ".", "Minv", ".", 
           RowBox[{"J", "\[Transpose]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"zi", " ", "=", " ", 
        RowBox[{"zi", " ", "-", " ", 
         RowBox[{"\[CapitalLambda]", ".", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Jd", ".", 
             RowBox[{"x", "\[LeftDoubleBracket]", 
              RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}], " ", "+",
             " ", 
            RowBox[{"J", ".", "zi"}]}], ")"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[CapitalLambda]", " ", "=", " ", 
        RowBox[{"\[CapitalLambda]", ".", "J"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"zs", " ", "=", " ", 
        RowBox[{"zs", " ", "-", " ", 
         RowBox[{"\[CapitalLambda]", ".", "zs"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"zi", ",", " ", "zs"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"gains", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "zsmin", ",", " ", "x3", ",", " ", "x4", ",", " ", "c4", ",", " ", 
        "c5"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"c4", " ", "=", " ", 
        RowBox[{
         RowBox[{"zizs", "[", 
          RowBox[{"{", 
           RowBox[{
           "0", ",", "0", ",", "x3", ",", "x4", ",", "0", ",", "0", ",", "0", 
            ",", "0"}], "}"}], "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"2", ",", " ", "4"}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"c5", " ", "=", " ", 
        RowBox[{"RegionProduct", "[", 
         RowBox[{
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "0", "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", "\[Pi]"}], "}"}]}], "}"}], "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "0", "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", "\[Pi]"}], "}"}]}], "}"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"zsmin", " ", "=", " ", 
        RowBox[{"NMinValue", "[", 
         RowBox[{"c4", ",", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x3", ",", "x4"}], "}"}], " ", "\[Element]", " ", 
           "c5"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"c4", " ", "=", " ", 
        RowBox[{
         RowBox[{"m1", " ", "r1"}], " ", "+", " ", 
         RowBox[{"m2", " ", "L1"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c5", " ", "=", " ", 
        RowBox[{"m2", " ", "r2"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"kd", "/", "ke"}], ",", " ", 
           RowBox[{"kp", "/", "ke"}]}], "}"}], " ", "\[GreaterEqual]"}], "  ",
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"c4", "+", "c5"}], ")"}], 
          RowBox[{"g", "/", "zsmin"}]}], ",", " ", 
         RowBox[{"2", " ", "c4", " ", "c5", " ", 
          RowBox[{"g", "^", "2"}]}]}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"u", "[", 
    RowBox[{"t_", ",", " ", "x_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"E", ",", " ", "Emax", ",", " ", "zi", ",", " ", "zs"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"zi", ",", " ", "zs"}], "}"}], " ", "=", " ", 
       RowBox[{"zizs", "[", "x", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Emax", " ", "=", " ", 
       RowBox[{"TE", "[", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"x", "\[LeftDoubleBracket]", 
           RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"\[Pi]", ",", " ", "0"}], "}"}], ",", " ", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", " ", "4"}], "]"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"E", " ", "=", " ", 
       RowBox[{
        RowBox[{"TE", "[", "x", "]"}], " ", "-", " ", "Emax"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"t", " ", "<", " ", "tsw"}], ",", " ", "\[IndentingNewLine]", 
        
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "kv"}], " ", 
            RowBox[{
            "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}], 
           " ", "-", " ", 
           RowBox[{"kp", " ", 
            RowBox[{
            "x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
           " ", "-", " ", 
           RowBox[{"kd", " ", 
            RowBox[{
            "zi", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}]}], 
          ")"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ke", " ", "E"}], " ", "+", " ", 
           RowBox[{"kd", " ", 
            RowBox[{
            "zs", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}]}], 
          ")"}]}], ",", "\[IndentingNewLine]", "0"}], 
       RowBox[{"(*", 
        RowBox[{"-", 
         RowBox[{"K", ".", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"x", "\[LeftDoubleBracket]", 
             RowBox[{"{", 
              RowBox[{"3", ",", "4", ",", "7", ",", "8"}], "}"}], 
             "\[RightDoubleBracket]"}], " ", "-", " ", 
            RowBox[{"{", 
             RowBox[{"\[Pi]", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
           ")"}]}]}], "*)"}], "\[IndentingNewLine]", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.629102572344222*^9, 3.629102616246416*^9}, {
   3.629102673889389*^9, 3.6291026757847357`*^9}, {3.629102707932582*^9, 
   3.629102724570407*^9}, {3.629102824212227*^9, 3.6291028515106297`*^9}, {
   3.629103458936345*^9, 3.6291034976568656`*^9}, 3.6291062660494623`*^9, {
   3.6291063315740194`*^9, 3.6291063522276955`*^9}, {3.6291366102133226`*^9, 
   3.6291366107096777`*^9}, 3.629136643988329*^9, {3.6291372660454154`*^9, 
   3.6291372709028816`*^9}, {3.6291383415458364`*^9, 
   3.6291383720585203`*^9}, {3.6291390979924393`*^9, 3.629139147196424*^9}, {
   3.6291391992364035`*^9, 3.629139229192713*^9}, {3.6291765125582294`*^9, 
   3.6291765172865906`*^9}, {3.629177725725466*^9, 3.6291777259075937`*^9}, {
   3.6293282671501536`*^9, 3.6293283058850317`*^9}, 3.6293295170504637`*^9, {
   3.629333934891714*^9, 3.6293339941893797`*^9}, {3.6293340285492115`*^9, 
   3.629334056815211*^9}, {3.6293340977845035`*^9, 3.6293341113471556`*^9}, {
   3.6293341942388697`*^9, 3.6293342335363126`*^9}, {3.6293347332929306`*^9, 
   3.6293347615745897`*^9}, {3.6293348669978657`*^9, 
   3.6293349089514947`*^9}, {3.6293349757805614`*^9, 3.629335033671955*^9}, {
   3.6293351113448687`*^9, 3.629335126798152*^9}, {3.6293359701187935`*^9, 
   3.6293361519805584`*^9}, {3.629337056883222*^9, 3.629337060602053*^9}, {
   3.629337190919478*^9, 3.6293372241542435`*^9}, {3.6293373715468507`*^9, 
   3.62933744793849*^9}, {3.629337537502183*^9, 3.629337579862133*^9}, {
   3.6293377090513124`*^9, 3.629337754317539*^9}, {3.6293378020369825`*^9, 
   3.6293378081464415`*^9}, {3.6293381656043015`*^9, 
   3.6293381689168615`*^9}, {3.6293383144812975`*^9, 
   3.6293383358409615`*^9}, {3.629482338782209*^9, 3.629482339269555*^9}, {
   3.629482444358246*^9, 3.6294824461835413`*^9}, 3.6294824873808217`*^9, {
   3.629482518515935*^9, 3.629482544523435*^9}, {3.629482589869665*^9, 
   3.6294827702617035`*^9}, {3.6294828729826837`*^9, 
   3.6294830743588376`*^9}, {3.629483136168738*^9, 3.6294831596624627`*^9}, {
   3.629484619658128*^9, 3.629484657839264*^9}, {3.6294905539597464`*^9, 
   3.629490557058961*^9}, 3.62949058708829*^9, {3.629490619586402*^9, 
   3.6294906876387568`*^9}, {3.6294907534325457`*^9, 
   3.6294907643873262`*^9}, {3.6294908273130283`*^9, 
   3.6294909984576793`*^9}, {3.629491030280282*^9, 3.6294910308747163`*^9}, {
   3.62949107109732*^9, 3.6294913174063816`*^9}, {3.6294913501066213`*^9, 
   3.62949138210036*^9}, {3.6294949768249083`*^9, 3.6294949769079523`*^9}, {
   3.6294992474005966`*^9, 3.629499278310549*^9}, {3.6294993197410135`*^9, 
   3.6294995141431646`*^9}, {3.6294995676181765`*^9, 
   3.6294996014982367`*^9}, {3.629499706259715*^9, 3.6294997882529964`*^9}, {
   3.6294998252422705`*^9, 3.6294999056494336`*^9}, 3.6294999543610477`*^9, {
   3.6294999939341526`*^9, 3.6294999941363087`*^9}, {3.62950002989371*^9, 
   3.629500035893975*^9}, {3.629500093936256*^9, 3.6295000998454423`*^9}, {
   3.6295003509299088`*^9, 3.6295003542052383`*^9}, {3.6295004409739056`*^9, 
   3.629500602462672*^9}, {3.629500637084278*^9, 3.629500638585352*^9}, 
   3.629500707095046*^9, {3.629500762646514*^9, 3.6295008022266536`*^9}, {
   3.6295008451201468`*^9, 3.629500915922449*^9}, {3.629500964685119*^9, 
   3.629500971789173*^9}, {3.629501006008494*^9, 3.6295010061165705`*^9}, {
   3.6295010904495077`*^9, 3.6295010931694136`*^9}, {3.6295011358807907`*^9, 
   3.6295011367093782`*^9}, {3.6295011864137135`*^9, 3.62950118917267*^9}, 
   3.629501230127781*^9, {3.629501378631328*^9, 3.6295013865279408`*^9}, {
   3.629501466785965*^9, 3.6295014704445553`*^9}, {3.6295016185278296`*^9, 
   3.629501638998379*^9}, 3.629501804837249*^9, {3.629501847519582*^9, 
   3.6295018481520314`*^9}, 3.629502142272071*^9, {3.62950220673889*^9, 
   3.6295022119956264`*^9}, {3.629502253739267*^9, 3.6295022636112833`*^9}, {
   3.629502306982129*^9, 3.6295023685759125`*^9}, {3.62950252145957*^9, 
   3.6295025495044966`*^9}, {3.6295028469919205`*^9, 
   3.6295029064051476`*^9}, {3.6295029408546467`*^9, 3.629502940903672*^9}, {
   3.6295029898114443`*^9, 3.6295030873517656`*^9}, {3.629503123961785*^9, 
   3.629503124027822*^9}, {3.6295031590717387`*^9, 3.629503159793256*^9}, {
   3.629503350772975*^9, 3.6295033636141176`*^9}, {3.6295035176716037`*^9, 
   3.629503525067839*^9}, {3.6295035906644897`*^9, 3.629503592926093*^9}, {
   3.6295036344005737`*^9, 3.629503637666895*^9}, {3.629503669960843*^9, 
   3.6295036736284513`*^9}, {3.629503714210288*^9, 3.6295037147216635`*^9}, 
   3.6295037471807303`*^9, {3.6295038196862593`*^9, 3.62950382032471*^9}, {
   3.629503896529877*^9, 3.6295039204408436`*^9}, {3.6295039549113665`*^9, 
   3.6295039944234457`*^9}, {3.6295040565916367`*^9, 3.629504326487461*^9}, {
   3.629504477708912*^9, 3.629504521959385*^9}, {3.629504626065366*^9, 
   3.629504809708902*^9}, {3.6295048955638933`*^9, 3.629504996104351*^9}, {
   3.6295051237631016`*^9, 3.6295052831273756`*^9}, 3.629505353708537*^9, {
   3.6295054742892237`*^9, 3.629505504706843*^9}, {3.629505542047398*^9, 
   3.6295055869783173`*^9}, {3.629505627147882*^9, 3.6295056331471453`*^9}, {
   3.6295056754702263`*^9, 3.629505682133956*^9}, {3.629505712695676*^9, 
   3.6295059725993996`*^9}, {3.6295061337809553`*^9, 3.629506408491209*^9}, {
   3.6295064409752865`*^9, 3.629506441268502*^9}, {3.629506479055352*^9, 
   3.6295066392591915`*^9}, {3.629506674209052*^9, 3.6295068401189785`*^9}, {
   3.6295069162460833`*^9, 3.629507054118059*^9}, {3.6295070941455235`*^9, 
   3.6295071105391626`*^9}, {3.6295071428661423`*^9, 
   3.6295072191573725`*^9}, {3.629507265107024*^9, 3.6295073623381376`*^9}, {
   3.62950752406207*^9, 3.6295080843752985`*^9}, 3.629508267606538*^9, {
   3.6295083036351376`*^9, 3.6295083423896766`*^9}, {3.629508377506647*^9, 
   3.629508421509922*^9}, {3.629508579062872*^9, 3.6295086209206495`*^9}, {
   3.6295086902809305`*^9, 3.629508837180337*^9}, {3.6295089356713533`*^9, 
   3.6295091214063597`*^9}, {3.6295091823576574`*^9, 3.629509227302618*^9}, {
   3.6295092577452526`*^9, 3.6295092738306885`*^9}, {3.6295093099843817`*^9, 
   3.62950931161654*^9}, {3.6295093534793015`*^9, 3.6295094498808165`*^9}, {
   3.6295094806556883`*^9, 3.6295094915834475`*^9}, {3.629509523024798*^9, 
   3.629509524574897*^9}, {3.6295095637637577`*^9, 3.629509657855632*^9}, {
   3.6295097393805676`*^9, 3.6295097394626245`*^9}, {3.6295097926554313`*^9, 
   3.6295098250824785`*^9}, {3.629509856424752*^9, 3.6295098789767833`*^9}, {
   3.6295099092392974`*^9, 3.6295099093013263`*^9}, {3.629509944009009*^9, 
   3.629509944070038*^9}, {3.6295099756965303`*^9, 3.6295100414052234`*^9}, {
   3.6295100824764147`*^9, 3.6295100825594654`*^9}, {3.6295101147803664`*^9, 
   3.6295101298940945`*^9}, {3.6295101942958965`*^9, 
   3.6295101988231077`*^9}, {3.6295102308008327`*^9, 3.629510243317732*^9}, {
   3.629510285299576*^9, 3.6295104585827255`*^9}, {3.6295104900751114`*^9, 
   3.629510556188098*^9}, {3.62951058988103*^9, 3.629510639001956*^9}, {
   3.6296718857346325`*^9, 3.6296718875627794`*^9}, 3.6296719269695234`*^9, {
   3.629671962985627*^9, 3.629671991111003*^9}, {3.6296720373616176`*^9, 
   3.62967206464323*^9}, 3.6296721109250965`*^9, {3.629672149425639*^9, 
   3.6296721710665207`*^9}, {3.629672241692461*^9, 3.6296722792867427`*^9}, {
   3.629672651622384*^9, 3.6296726735445476`*^9}, {3.6296727594519424`*^9, 
   3.629673070471675*^9}, {3.629673129800623*^9, 3.6296731544102707`*^9}, {
   3.6296732120829215`*^9, 3.629673267458641*^9}, {3.6296733218031445`*^9, 
   3.629673476945864*^9}, {3.629673509508767*^9, 3.6296735172120256`*^9}, {
   3.629673562025119*^9, 3.629673582415995*^9}, {3.6296744407086887`*^9, 
   3.629674442505555*^9}, 3.6296745310379825`*^9, {3.629674604663962*^9, 
   3.629674604913965*^9}, {3.629675481706911*^9, 3.629675482519391*^9}, {
   3.6296755512859654`*^9, 3.6296757340539885`*^9}, {3.629675791804788*^9, 
   3.6296758172113447`*^9}, {3.629677221019473*^9, 3.6296772320196486`*^9}, {
   3.6296818215356655`*^9, 3.6296818437234945`*^9}, {3.6296819356934633`*^9, 
   3.629681951928025*^9}, 3.629682031429082*^9, {3.629682110008253*^9, 
   3.6296821391023903`*^9}, {3.6296821980250816`*^9, 3.629682240478725*^9}, {
   3.6296822842136955`*^9, 3.629682313526616*^9}, {3.6296823630584955`*^9, 
   3.629682365699145*^9}, {3.629682593639717*^9, 3.6296827077974305`*^9}, {
   3.629682747532361*^9, 3.629682777688982*^9}, {3.629682839908622*^9, 
   3.629682840471125*^9}, {3.629682910753313*^9, 3.6296830403487854`*^9}, {
   3.6296831144591465`*^9, 3.6296831716161275`*^9}, {3.629683252648484*^9, 
   3.6296832918364763`*^9}, {3.62968334083713*^9, 3.629683367446892*^9}, {
   3.629683429838312*^9, 3.6296834435729065`*^9}, {3.6296835105581694`*^9, 
   3.6296836574976234`*^9}, {3.62968375140512*^9, 3.6296837585770617`*^9}, {
   3.6296838301092625`*^9, 3.629683833906189*^9}, {3.629683949220255*^9, 
   3.629683970861135*^9}, {3.629684018893024*^9, 3.6296840190961533`*^9}, {
   3.629684460648903*^9, 3.629684465523967*^9}, 3.629684572087885*^9, {
   3.6296847025583706`*^9, 3.6296847158398275`*^9}, {3.6296847577935104`*^9, 
   3.6296848367633114`*^9}, {3.6296849951403885`*^9, 3.629685007984294*^9}, 
   3.629685109079439*^9, {3.62968542658366*^9, 3.6296856339301386`*^9}, {
   3.629685781322723*^9, 3.6296858570581055`*^9}, {3.6296858926835804`*^9, 
   3.629685927605919*^9}, {3.6296859627939157`*^9, 3.629686011544536*^9}, {
   3.6296860424356003`*^9, 3.629686093873789*^9}, {3.6296863984871564`*^9, 
   3.6296864446753297`*^9}, 3.6296864886133833`*^9, {3.6296865493329735`*^9, 
   3.629686551145496*^9}, {3.6296868389461985`*^9, 3.629686861665209*^9}, {
   3.6296869100252705`*^9, 3.629686910697156*^9}, {3.6296869727448573`*^9, 
   3.6296870568084135`*^9}, {3.6296870994652634`*^9, 3.629687358890588*^9}, {
   3.6296874521262035`*^9, 3.6296875187989655`*^9}, {3.6296875792528954`*^9, 
   3.629687633191144*^9}, {3.6296876641602736`*^9, 3.6296877958182755`*^9}, {
   3.629688020774394*^9, 3.6296881156819057`*^9}, {3.629688206511241*^9, 
   3.629688248808704*^9}, {3.6296883603882875`*^9, 3.629688405701391*^9}, {
   3.629689587447905*^9, 3.6296895876666117`*^9}, {3.6296916456627555`*^9, 
   3.629691699397847*^9}, {3.6296917673362837`*^9, 3.629691769930024*^9}, {
   3.6296918147118535`*^9, 3.6296918628375216`*^9}, {3.629691991323637*^9, 
   3.629692023620911*^9}, {3.6296920674027767`*^9, 3.6296920746528735`*^9}, 
   3.6296925878315425`*^9, {3.6296926341446595`*^9, 3.629692648207346*^9}, {
   3.6296926804421816`*^9, 3.6296927137863436`*^9}, {3.6296928114751434`*^9, 
   3.629692811537635*^9}, {3.629693017821638*^9, 3.629693063822282*^9}, {
   3.629693109791645*^9, 3.629693181511346*^9}, {3.6296932120898757`*^9, 
   3.629693329638316*^9}, {3.629693371013838*^9, 3.6296933743107567`*^9}, {
   3.629693420014526*^9, 3.6296934819059663`*^9}, {3.6296935131095095`*^9, 
   3.6296935405942183`*^9}, {3.629693578391631*^9, 3.6296936255953817`*^9}, {
   3.6296938633329177`*^9, 3.6296938872550807`*^9}, {3.6296939616623206`*^9, 
   3.6296939904439535`*^9}, {3.6296942176060266`*^9, 3.62969426363789*^9}, {
   3.6296943772019005`*^9, 3.6296943809207*^9}, {3.6296944378433323`*^9, 
   3.6296944386402173`*^9}, {3.6296957775174055`*^9, 
   3.6296958032365294`*^9}, {3.6296959760357018`*^9, 
   3.6296960153018193`*^9}, {3.629756736975297*^9, 3.6297567380065594`*^9}, {
   3.6300124119611435`*^9, 3.630012412679869*^9}, {3.6300124863836937`*^9, 
   3.6300125117121077`*^9}, {3.63001262861942*^9, 3.6300126314319487`*^9}, {
   3.630012763745719*^9, 3.63001279368349*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"mag", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kv", " ", "=", " ", "30"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ke", " ", "=", " ", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"kd", ",", " ", "kp"}], "}"}], " ", "=", " ", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", " ", "1"}], "}"}], " ", 
   RowBox[{"gains", "[", "]"}], " ", "ke"}]}]}], "Input",
 CellChangeTimes->{{3.629102572344222*^9, 3.629102616246416*^9}, {
   3.629102673889389*^9, 3.6291026757847357`*^9}, {3.629102707932582*^9, 
   3.629102724570407*^9}, {3.629102824212227*^9, 3.6291028515106297`*^9}, {
   3.629103458936345*^9, 3.6291034976568656`*^9}, 3.6291062660494623`*^9, {
   3.6291063315740194`*^9, 3.6291063522276955`*^9}, {3.6291366102133226`*^9, 
   3.6291366107096777`*^9}, 3.629136643988329*^9, {3.6291372660454154`*^9, 
   3.6291372709028816`*^9}, {3.6291383415458364`*^9, 
   3.6291383720585203`*^9}, {3.6291390979924393`*^9, 3.629139147196424*^9}, {
   3.6291391992364035`*^9, 3.629139229192713*^9}, {3.6291765125582294`*^9, 
   3.6291765172865906`*^9}, {3.629177725725466*^9, 3.6291777259075937`*^9}, {
   3.6293282671501536`*^9, 3.6293283058850317`*^9}, 3.6293295170504637`*^9, {
   3.629333934891714*^9, 3.6293339941893797`*^9}, {3.6293340285492115`*^9, 
   3.629334056815211*^9}, {3.6293340977845035`*^9, 3.6293341113471556`*^9}, {
   3.6293341942388697`*^9, 3.6293342335363126`*^9}, {3.6293347332929306`*^9, 
   3.6293347615745897`*^9}, {3.6293348669978657`*^9, 
   3.6293349089514947`*^9}, {3.6293349757805614`*^9, 3.629335033671955*^9}, {
   3.6293351113448687`*^9, 3.629335126798152*^9}, {3.6293359701187935`*^9, 
   3.6293361519805584`*^9}, {3.629337056883222*^9, 3.629337060602053*^9}, {
   3.629337190919478*^9, 3.6293372241542435`*^9}, {3.6293373715468507`*^9, 
   3.62933744793849*^9}, {3.629337537502183*^9, 3.629337579862133*^9}, {
   3.6293377090513124`*^9, 3.629337754317539*^9}, {3.6293378020369825`*^9, 
   3.6293378081464415`*^9}, {3.6293381656043015`*^9, 
   3.6293381689168615`*^9}, {3.6293383144812975`*^9, 
   3.6293383358409615`*^9}, {3.629482338782209*^9, 3.629482339269555*^9}, {
   3.629482444358246*^9, 3.6294824461835413`*^9}, 3.6294824873808217`*^9, {
   3.629482518515935*^9, 3.629482544523435*^9}, {3.629482589869665*^9, 
   3.6294827702617035`*^9}, {3.6294828729826837`*^9, 
   3.6294830743588376`*^9}, {3.629483136168738*^9, 3.6294831596624627`*^9}, {
   3.629484619658128*^9, 3.629484657839264*^9}, {3.6294905539597464`*^9, 
   3.629490557058961*^9}, 3.62949058708829*^9, {3.629490619586402*^9, 
   3.6294906876387568`*^9}, {3.6294907534325457`*^9, 
   3.6294907643873262`*^9}, {3.6294908273130283`*^9, 
   3.6294909984576793`*^9}, {3.629491030280282*^9, 3.6294910308747163`*^9}, {
   3.62949107109732*^9, 3.6294913174063816`*^9}, {3.6294913501066213`*^9, 
   3.62949138210036*^9}, {3.6294949768249083`*^9, 3.6294949769079523`*^9}, {
   3.6294992474005966`*^9, 3.629499278310549*^9}, {3.6294993197410135`*^9, 
   3.6294995141431646`*^9}, {3.6294995676181765`*^9, 
   3.6294996014982367`*^9}, {3.629499706259715*^9, 3.6294997882529964`*^9}, {
   3.6294998252422705`*^9, 3.6294999056494336`*^9}, 3.6294999543610477`*^9, {
   3.6294999939341526`*^9, 3.6294999941363087`*^9}, {3.62950002989371*^9, 
   3.629500035893975*^9}, {3.629500093936256*^9, 3.6295000998454423`*^9}, {
   3.6295003509299088`*^9, 3.6295003542052383`*^9}, {3.6295004409739056`*^9, 
   3.629500602462672*^9}, {3.629500637084278*^9, 3.629500638585352*^9}, 
   3.629500707095046*^9, {3.629500762646514*^9, 3.6295008022266536`*^9}, {
   3.6295008451201468`*^9, 3.629500915922449*^9}, {3.629500964685119*^9, 
   3.629500971789173*^9}, {3.629501006008494*^9, 3.6295010061165705`*^9}, {
   3.6295010904495077`*^9, 3.6295010931694136`*^9}, {3.6295011358807907`*^9, 
   3.6295011367093782`*^9}, {3.6295011864137135`*^9, 3.62950118917267*^9}, 
   3.629501230127781*^9, {3.629501378631328*^9, 3.6295013865279408`*^9}, {
   3.629501466785965*^9, 3.6295014704445553`*^9}, {3.6295016185278296`*^9, 
   3.629501638998379*^9}, 3.629501804837249*^9, {3.629501847519582*^9, 
   3.6295018481520314`*^9}, 3.629502142272071*^9, {3.62950220673889*^9, 
   3.6295022119956264`*^9}, {3.629502253739267*^9, 3.6295022636112833`*^9}, {
   3.629502306982129*^9, 3.6295023685759125`*^9}, {3.62950252145957*^9, 
   3.6295025495044966`*^9}, {3.6295028469919205`*^9, 
   3.6295029064051476`*^9}, {3.6295029408546467`*^9, 3.629502940903672*^9}, {
   3.6295029898114443`*^9, 3.6295030873517656`*^9}, {3.629503123961785*^9, 
   3.629503124027822*^9}, {3.6295031590717387`*^9, 3.629503159793256*^9}, {
   3.629503350772975*^9, 3.6295033636141176`*^9}, {3.6295035176716037`*^9, 
   3.629503525067839*^9}, {3.6295035906644897`*^9, 3.629503592926093*^9}, {
   3.6295036344005737`*^9, 3.629503637666895*^9}, {3.629503669960843*^9, 
   3.6295036736284513`*^9}, {3.629503714210288*^9, 3.6295037147216635`*^9}, 
   3.6295037471807303`*^9, {3.6295038196862593`*^9, 3.62950382032471*^9}, {
   3.629503896529877*^9, 3.6295039204408436`*^9}, {3.6295039549113665`*^9, 
   3.6295039944234457`*^9}, {3.6295040565916367`*^9, 3.629504326487461*^9}, {
   3.629504477708912*^9, 3.629504521959385*^9}, {3.629504626065366*^9, 
   3.629504809708902*^9}, {3.6295048955638933`*^9, 3.629504996104351*^9}, {
   3.6295051237631016`*^9, 3.6295052831273756`*^9}, 3.629505353708537*^9, {
   3.6295054742892237`*^9, 3.629505504706843*^9}, {3.629505542047398*^9, 
   3.6295055869783173`*^9}, {3.629505627147882*^9, 3.6295056331471453`*^9}, {
   3.6295056754702263`*^9, 3.629505682133956*^9}, {3.629505712695676*^9, 
   3.6295059725993996`*^9}, {3.6295061337809553`*^9, 3.629506408491209*^9}, {
   3.6295064409752865`*^9, 3.629506441268502*^9}, {3.629506479055352*^9, 
   3.6295066392591915`*^9}, {3.629506674209052*^9, 3.6295068401189785`*^9}, {
   3.6295069162460833`*^9, 3.629507054118059*^9}, {3.6295070941455235`*^9, 
   3.6295071105391626`*^9}, {3.6295071428661423`*^9, 
   3.6295072191573725`*^9}, {3.629507265107024*^9, 3.6295073623381376`*^9}, {
   3.62950752406207*^9, 3.6295080843752985`*^9}, 3.629508267606538*^9, {
   3.6295083036351376`*^9, 3.6295083423896766`*^9}, {3.629508377506647*^9, 
   3.629508421509922*^9}, {3.629508579062872*^9, 3.6295086209206495`*^9}, {
   3.6295086902809305`*^9, 3.629508837180337*^9}, {3.6295089356713533`*^9, 
   3.6295091214063597`*^9}, {3.6295091823576574`*^9, 3.629509227302618*^9}, {
   3.6295092577452526`*^9, 3.6295092738306885`*^9}, {3.6295093099843817`*^9, 
   3.62950931161654*^9}, {3.6295093534793015`*^9, 3.6295094498808165`*^9}, {
   3.6295094806556883`*^9, 3.6295094915834475`*^9}, {3.629509523024798*^9, 
   3.629509524574897*^9}, {3.6295095637637577`*^9, 3.629509657855632*^9}, {
   3.6295097393805676`*^9, 3.6295097394626245`*^9}, {3.6295097926554313`*^9, 
   3.6295098250824785`*^9}, {3.629509856424752*^9, 3.6295098789767833`*^9}, {
   3.6295099092392974`*^9, 3.6295099093013263`*^9}, {3.629509944009009*^9, 
   3.629509944070038*^9}, {3.6295099756965303`*^9, 3.6295100414052234`*^9}, {
   3.6295100824764147`*^9, 3.6295100825594654`*^9}, {3.6295101147803664`*^9, 
   3.6295101298940945`*^9}, {3.6295101942958965`*^9, 
   3.6295101988231077`*^9}, {3.6295102308008327`*^9, 3.629510243317732*^9}, {
   3.629510285299576*^9, 3.6295104585827255`*^9}, {3.6295104900751114`*^9, 
   3.629510556188098*^9}, {3.62951058988103*^9, 3.629510639001956*^9}, {
   3.6296718857346325`*^9, 3.6296718875627794`*^9}, 3.6296719269695234`*^9, {
   3.629671962985627*^9, 3.629671991111003*^9}, {3.6296720373616176`*^9, 
   3.62967206464323*^9}, 3.6296721109250965`*^9, {3.629672149425639*^9, 
   3.6296721710665207`*^9}, {3.629672241692461*^9, 3.6296722792867427`*^9}, {
   3.629672651622384*^9, 3.6296726735445476`*^9}, {3.6296727594519424`*^9, 
   3.629673070471675*^9}, {3.629673129800623*^9, 3.6296731544102707`*^9}, {
   3.6296732120829215`*^9, 3.629673267458641*^9}, {3.6296733218031445`*^9, 
   3.629673476945864*^9}, {3.629673509508767*^9, 3.6296735172120256`*^9}, {
   3.629673562025119*^9, 3.629673582415995*^9}, {3.6296744407086887`*^9, 
   3.629674442505555*^9}, 3.6296745310379825`*^9, {3.629674604663962*^9, 
   3.629674604913965*^9}, {3.629675481706911*^9, 3.629675482519391*^9}, {
   3.6296755512859654`*^9, 3.6296757340539885`*^9}, {3.629675791804788*^9, 
   3.6296758172113447`*^9}, {3.629677221019473*^9, 3.6296772320196486`*^9}, {
   3.6296818215356655`*^9, 3.6296818437234945`*^9}, {3.6296819356934633`*^9, 
   3.629681951928025*^9}, 3.629682031429082*^9, {3.629682110008253*^9, 
   3.6296821391023903`*^9}, {3.6296821980250816`*^9, 3.629682240478725*^9}, {
   3.6296822842136955`*^9, 3.629682313526616*^9}, {3.6296823630584955`*^9, 
   3.629682365699145*^9}, {3.629682593639717*^9, 3.6296827077974305`*^9}, {
   3.629682747532361*^9, 3.629682777688982*^9}, {3.629682839908622*^9, 
   3.629682840471125*^9}, {3.629682910753313*^9, 3.6296830403487854`*^9}, {
   3.6296831144591465`*^9, 3.6296831716161275`*^9}, {3.629683252648484*^9, 
   3.6296832918364763`*^9}, {3.62968334083713*^9, 3.629683367446892*^9}, {
   3.629683429838312*^9, 3.6296834435729065`*^9}, {3.6296835105581694`*^9, 
   3.6296836574976234`*^9}, {3.62968375140512*^9, 3.6296837585770617`*^9}, {
   3.6296838301092625`*^9, 3.629683833906189*^9}, {3.629683949220255*^9, 
   3.629683970861135*^9}, {3.629684018893024*^9, 3.6296840190961533`*^9}, {
   3.629684460648903*^9, 3.629684465523967*^9}, 3.629684572087885*^9, {
   3.6296847025583706`*^9, 3.6296847158398275`*^9}, {3.6296847577935104`*^9, 
   3.6296848367633114`*^9}, {3.6296849951403885`*^9, 3.629685007984294*^9}, 
   3.629685109079439*^9, {3.62968542658366*^9, 3.6296856339301386`*^9}, {
   3.629685781322723*^9, 3.6296858570581055`*^9}, {3.6296858926835804`*^9, 
   3.629685927605919*^9}, {3.6296859627939157`*^9, 3.629686011544536*^9}, {
   3.6296860424356003`*^9, 3.629686093873789*^9}, {3.6296863984871564`*^9, 
   3.6296864446753297`*^9}, 3.6296864886133833`*^9, {3.6296865493329735`*^9, 
   3.629686551145496*^9}, {3.6296868389461985`*^9, 3.629686861665209*^9}, {
   3.6296869100252705`*^9, 3.629686910697156*^9}, {3.6296869727448573`*^9, 
   3.6296870568084135`*^9}, {3.6296870994652634`*^9, 3.629687358890588*^9}, {
   3.6296874521262035`*^9, 3.6296875187989655`*^9}, {3.6296875792528954`*^9, 
   3.629687633191144*^9}, {3.6296876641602736`*^9, 3.6296877958182755`*^9}, {
   3.629688020774394*^9, 3.6296881156819057`*^9}, {3.629688206511241*^9, 
   3.629688248808704*^9}, {3.6296883603882875`*^9, 3.629688405701391*^9}, {
   3.629689587447905*^9, 3.6296895876666117`*^9}, {3.6296916456627555`*^9, 
   3.629691699397847*^9}, {3.6296917673362837`*^9, 3.629691769930024*^9}, {
   3.6296918147118535`*^9, 3.6296918628375216`*^9}, {3.629691991323637*^9, 
   3.629692023620911*^9}, {3.6296920674027767`*^9, 3.6296920746528735`*^9}, 
   3.6296925878315425`*^9, {3.6296926341446595`*^9, 3.629692648207346*^9}, {
   3.6296926804421816`*^9, 3.6296927137863436`*^9}, {3.6296928114751434`*^9, 
   3.629692811537635*^9}, {3.629693017821638*^9, 3.629693063822282*^9}, {
   3.629693109791645*^9, 3.629693181511346*^9}, {3.6296932120898757`*^9, 
   3.629693329638316*^9}, {3.629693371013838*^9, 3.6296933743107567`*^9}, {
   3.629693420014526*^9, 3.6296934819059663`*^9}, {3.6296935131095095`*^9, 
   3.6296935405942183`*^9}, {3.629693578391631*^9, 3.629693717955987*^9}, {
   3.6296940394290104`*^9, 3.629694090679696*^9}, {3.629694462484317*^9, 
   3.6296944892659216`*^9}, {3.629695185978286*^9, 3.629695196540958*^9}, {
   3.6296953037298813`*^9, 3.629695303792379*^9}, {3.6296957982833385`*^9, 
   3.6296958000489855`*^9}, {3.6296999023836794`*^9, 3.62969991009516*^9}, 
   3.6297015785988555`*^9, {3.62970164258405*^9, 3.6297016441778517`*^9}, {
   3.6297017048505373`*^9, 3.629701724522669*^9}, {3.6297018934155436`*^9, 
   3.62970189499369*^9}, 3.629701956916388*^9, {3.629702088855646*^9, 
   3.629702103746436*^9}, {3.629702137731263*^9, 3.629702137809419*^9}, {
   3.629702430047685*^9, 3.6297024768607764`*^9}, {3.629702521548902*^9, 
   3.629702590040435*^9}, 3.629702627540934*^9, {3.62970283112177*^9, 
   3.6297028959350996`*^9}, 3.6297029710455055`*^9, {3.6297030308275485`*^9, 
   3.6297030938908873`*^9}, {3.6297031311257596`*^9, 3.629703175485727*^9}, {
   3.6297032083299165`*^9, 3.6297033228626823`*^9}, {3.6297034277390814`*^9, 
   3.6297034673333273`*^9}, {3.629703936870854*^9, 3.6297040060905247`*^9}, {
   3.629704047106666*^9, 3.6297041387953854`*^9}, {3.6297041857647324`*^9, 
   3.6297043448762817`*^9}, 3.6297043936269298`*^9, {3.629704944899835*^9, 
   3.6297049673689394`*^9}, {3.629853408236723*^9, 3.629853426309946*^9}, {
   3.6298534761049137`*^9, 3.629853510341093*^9}, {3.6298535422848177`*^9, 
   3.6298536203752007`*^9}, {3.629853658527918*^9, 3.629853687221178*^9}, 
   3.6298556756336613`*^9, 3.6298557154130397`*^9, {3.6298558442583604`*^9, 
   3.6298558458411236`*^9}, {3.629856333561937*^9, 3.629856352888467*^9}, {
   3.629856814364602*^9, 3.6298568444996743`*^9}, {3.6300127000264015`*^9, 
   3.630012746979952*^9}, {3.6307625489181967`*^9, 3.630762613294297*^9}, {
   3.630762648654248*^9, 3.6307626649514008`*^9}, {3.630762723858659*^9, 
   3.63076274429648*^9}, {3.6307627877503767`*^9, 3.6307628309230223`*^9}, {
   3.6307628764706736`*^9, 3.630762914111884*^9}, {3.6307629500813084`*^9, 
   3.6307630041916103`*^9}, {3.630763041817234*^9, 3.6307630696146064`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"21.864536366085616`", ",", "450.1040923470607`"}], "}"}]], "Output",\

 CellChangeTimes->{3.6314470843094277`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"mag", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t", " ", "=", " ", "25"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", " ", "8"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}], " ", 
   "=", " ", 
   RowBox[{"-", "1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], " ", 
   "=", " ", 
   RowBox[{"30", " ", "Degree"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], " ", 
    "=", " ", 
    RowBox[{"0", " ", "Degree"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "q", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tsw", " ", "=", " ", "\[Infinity]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"q", " ", "=", " ", 
    RowBox[{"q", "/.", 
     RowBox[{"First", "@", 
      RowBox[{"NDSolve", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"q", "''"}], "[", "s", "]"}], " ", "\[Equal]", " ", 
           RowBox[{"f", "[", 
            RowBox[{"s", ",", " ", 
             RowBox[{"q", "[", "s", "]"}], ",", " ", 
             RowBox[{
              RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"q", "[", "0", "]"}], " ", "\[Equal]", " ", 
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", "4"}], "\[RightDoubleBracket]"}]}], ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"q", "'"}], "[", "0", "]"}], " ", "\[Equal]", " ", 
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"WhenEvent", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}], ".", 
              RowBox[{"q", "[", "s", "]"}]}], "-", "\[Pi]"}], ",", " ", 
            "\"\<StopIntegration\>\""}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"WhenEvent", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}], ".", 
              RowBox[{"q", "[", "s", "]"}]}], "+", "\[Pi]"}], ",", " ", 
            "\"\<StopIntegration\>\""}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"WhenEvent", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ".", 
              RowBox[{"q", "[", "s", "]"}]}], "-", "\[Pi]"}], ",", " ", 
            RowBox[{
             RowBox[{"tsw", " ", "=", " ", "s"}], ";", 
             "\"\<StopIntegration\>\""}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"WhenEvent", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ".", 
               RowBox[{"q", "[", "s", "]"}]}], "+", "\[Pi]"}], " ", 
             "\[Equal]", "   ", "0"}], ",", " ", 
            RowBox[{
             RowBox[{"tsw", " ", "=", " ", "s"}], ";", 
             "\"\<StopIntegration\>\""}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"WhenEvent", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "1"}], "}"}], ".", 
             RowBox[{"GibbotQnts`Private`P4", "[", 
              RowBox[{"q", "[", "s", "]"}], "]"}]}], ",", " ", 
            RowBox[{
             RowBox[{"ty", " ", "=", " ", "s"}], ";"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}], ",", " ", "\[IndentingNewLine]", "q", 
        ",", " ", 
        RowBox[{"{", 
         RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"MaxStepSize", "\[Rule]", "0.01"}]}], "\[IndentingNewLine]", 
       "]"}]}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", "tsw", \
"\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t", " ", "=", " ", 
   RowBox[{
    RowBox[{"q", "[", "\"\<Domain\>\"", "]"}], "\[LeftDoubleBracket]", 
    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"q", "'"}], "[", "t", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Animate", "[", 
   RowBox[{
    RowBox[{"DrawGibbot", "[", 
     RowBox[{"mag", ",", " ", 
      RowBox[{"q", "[", "s", "]"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", " ", 
       RowBox[{"1.5", 
        RowBox[{"(", 
         RowBox[{"L1", "+", "L2"}], ")"}]}]}]}], "]"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}], ",", " ", 
    RowBox[{"AnimationRepetitions", "\[Rule]", "1"}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.629102572344222*^9, 3.629102616246416*^9}, {
   3.629102673889389*^9, 3.6291026757847357`*^9}, {3.629102707932582*^9, 
   3.629102724570407*^9}, {3.629102824212227*^9, 3.6291028515106297`*^9}, {
   3.629103458936345*^9, 3.6291034976568656`*^9}, 3.6291062660494623`*^9, {
   3.6291063315740194`*^9, 3.6291063522276955`*^9}, {3.6291366102133226`*^9, 
   3.6291366107096777`*^9}, 3.629136643988329*^9, {3.6291372660454154`*^9, 
   3.6291372709028816`*^9}, {3.6291383415458364`*^9, 
   3.6291383720585203`*^9}, {3.6291390979924393`*^9, 3.629139147196424*^9}, {
   3.6291391992364035`*^9, 3.629139229192713*^9}, {3.6291765125582294`*^9, 
   3.6291765172865906`*^9}, {3.629177725725466*^9, 3.6291777259075937`*^9}, {
   3.6293282671501536`*^9, 3.6293283058850317`*^9}, 3.6293295170504637`*^9, {
   3.629333934891714*^9, 3.6293339941893797`*^9}, {3.6293340285492115`*^9, 
   3.629334056815211*^9}, {3.6293340977845035`*^9, 3.6293341113471556`*^9}, {
   3.6293341942388697`*^9, 3.6293342335363126`*^9}, {3.6293347332929306`*^9, 
   3.6293347615745897`*^9}, {3.6293348669978657`*^9, 
   3.6293349089514947`*^9}, {3.6293349757805614`*^9, 3.629335033671955*^9}, {
   3.6293351113448687`*^9, 3.629335126798152*^9}, {3.6293359701187935`*^9, 
   3.6293361519805584`*^9}, {3.629337056883222*^9, 3.629337060602053*^9}, {
   3.629337190919478*^9, 3.6293372241542435`*^9}, {3.6293373715468507`*^9, 
   3.62933744793849*^9}, {3.629337537502183*^9, 3.629337579862133*^9}, {
   3.6293377090513124`*^9, 3.629337754317539*^9}, {3.6293378020369825`*^9, 
   3.6293378081464415`*^9}, {3.6293381656043015`*^9, 
   3.6293381689168615`*^9}, {3.6293383144812975`*^9, 
   3.6293383358409615`*^9}, {3.629482338782209*^9, 3.629482339269555*^9}, {
   3.629482444358246*^9, 3.6294824461835413`*^9}, 3.6294824873808217`*^9, {
   3.629482518515935*^9, 3.629482544523435*^9}, {3.629482589869665*^9, 
   3.6294827702617035`*^9}, {3.6294828729826837`*^9, 
   3.6294830743588376`*^9}, {3.629483136168738*^9, 3.6294831596624627`*^9}, {
   3.629484619658128*^9, 3.629484657839264*^9}, {3.6294905539597464`*^9, 
   3.629490557058961*^9}, 3.62949058708829*^9, {3.629490619586402*^9, 
   3.6294906876387568`*^9}, {3.6294907534325457`*^9, 
   3.6294907643873262`*^9}, {3.6294908273130283`*^9, 
   3.6294909984576793`*^9}, {3.629491030280282*^9, 3.6294910308747163`*^9}, {
   3.62949107109732*^9, 3.6294913174063816`*^9}, {3.6294913501066213`*^9, 
   3.62949138210036*^9}, {3.6294949768249083`*^9, 3.6294949769079523`*^9}, {
   3.6294992474005966`*^9, 3.629499278310549*^9}, {3.6294993197410135`*^9, 
   3.6294995141431646`*^9}, {3.6294995676181765`*^9, 
   3.6294996014982367`*^9}, {3.629499706259715*^9, 3.6294997882529964`*^9}, {
   3.6294998252422705`*^9, 3.6294999056494336`*^9}, 3.6294999543610477`*^9, {
   3.6294999939341526`*^9, 3.6294999941363087`*^9}, {3.62950002989371*^9, 
   3.629500035893975*^9}, {3.629500093936256*^9, 3.6295000998454423`*^9}, {
   3.6295003509299088`*^9, 3.6295003542052383`*^9}, {3.6295004409739056`*^9, 
   3.629500602462672*^9}, {3.629500637084278*^9, 3.629500638585352*^9}, 
   3.629500707095046*^9, {3.629500762646514*^9, 3.6295008022266536`*^9}, {
   3.6295008451201468`*^9, 3.629500915922449*^9}, {3.629500964685119*^9, 
   3.629500971789173*^9}, {3.629501006008494*^9, 3.6295010061165705`*^9}, {
   3.6295010904495077`*^9, 3.6295010931694136`*^9}, {3.6295011358807907`*^9, 
   3.6295011367093782`*^9}, {3.6295011864137135`*^9, 3.62950118917267*^9}, 
   3.629501230127781*^9, {3.629501378631328*^9, 3.6295013865279408`*^9}, {
   3.629501466785965*^9, 3.6295014704445553`*^9}, {3.6295016185278296`*^9, 
   3.629501638998379*^9}, 3.629501804837249*^9, {3.629501847519582*^9, 
   3.6295018481520314`*^9}, 3.629502142272071*^9, {3.62950220673889*^9, 
   3.6295022119956264`*^9}, {3.629502253739267*^9, 3.6295022636112833`*^9}, {
   3.629502306982129*^9, 3.6295023685759125`*^9}, {3.62950252145957*^9, 
   3.6295025495044966`*^9}, {3.6295028469919205`*^9, 
   3.6295029064051476`*^9}, {3.6295029408546467`*^9, 3.629502940903672*^9}, {
   3.6295029898114443`*^9, 3.6295030873517656`*^9}, {3.629503123961785*^9, 
   3.629503124027822*^9}, {3.6295031590717387`*^9, 3.629503159793256*^9}, {
   3.629503350772975*^9, 3.6295033636141176`*^9}, {3.6295035176716037`*^9, 
   3.629503525067839*^9}, {3.6295035906644897`*^9, 3.629503592926093*^9}, {
   3.6295036344005737`*^9, 3.629503637666895*^9}, {3.629503669960843*^9, 
   3.6295036736284513`*^9}, {3.629503714210288*^9, 3.6295037147216635`*^9}, 
   3.6295037471807303`*^9, {3.6295038196862593`*^9, 3.62950382032471*^9}, {
   3.629503896529877*^9, 3.6295039204408436`*^9}, {3.6295039549113665`*^9, 
   3.6295039944234457`*^9}, {3.6295040565916367`*^9, 3.629504326487461*^9}, {
   3.629504477708912*^9, 3.629504521959385*^9}, {3.629504626065366*^9, 
   3.629504809708902*^9}, {3.6295048955638933`*^9, 3.629504996104351*^9}, {
   3.6295051237631016`*^9, 3.6295052831273756`*^9}, 3.629505353708537*^9, {
   3.6295054742892237`*^9, 3.629505504706843*^9}, {3.629505542047398*^9, 
   3.6295055869783173`*^9}, {3.629505627147882*^9, 3.6295056331471453`*^9}, {
   3.6295056754702263`*^9, 3.629505682133956*^9}, {3.629505712695676*^9, 
   3.6295059725993996`*^9}, {3.6295061337809553`*^9, 3.629506408491209*^9}, {
   3.6295064409752865`*^9, 3.629506441268502*^9}, {3.629506479055352*^9, 
   3.6295066392591915`*^9}, {3.629506674209052*^9, 3.6295068401189785`*^9}, {
   3.6295069162460833`*^9, 3.629507054118059*^9}, {3.6295070941455235`*^9, 
   3.6295071105391626`*^9}, {3.6295071428661423`*^9, 
   3.6295072191573725`*^9}, {3.629507265107024*^9, 3.6295073623381376`*^9}, {
   3.62950752406207*^9, 3.6295080843752985`*^9}, 3.629508267606538*^9, {
   3.6295083036351376`*^9, 3.6295083423896766`*^9}, {3.629508377506647*^9, 
   3.629508421509922*^9}, {3.629508579062872*^9, 3.6295086209206495`*^9}, {
   3.6295086902809305`*^9, 3.629508837180337*^9}, {3.6295089356713533`*^9, 
   3.6295091214063597`*^9}, {3.6295091823576574`*^9, 3.629509227302618*^9}, {
   3.6295092577452526`*^9, 3.6295092738306885`*^9}, {3.6295093099843817`*^9, 
   3.62950931161654*^9}, {3.6295093534793015`*^9, 3.6295094498808165`*^9}, {
   3.6295094806556883`*^9, 3.6295094915834475`*^9}, {3.629509523024798*^9, 
   3.629509524574897*^9}, {3.6295095637637577`*^9, 3.629509657855632*^9}, {
   3.6295097393805676`*^9, 3.6295097394626245`*^9}, {3.6295097926554313`*^9, 
   3.6295098250824785`*^9}, {3.629509856424752*^9, 3.6295098789767833`*^9}, {
   3.6295099092392974`*^9, 3.6295099093013263`*^9}, {3.629509944009009*^9, 
   3.629509944070038*^9}, {3.6295099756965303`*^9, 3.6295100414052234`*^9}, {
   3.6295100824764147`*^9, 3.6295100825594654`*^9}, {3.6295101147803664`*^9, 
   3.6295101298940945`*^9}, {3.6295101942958965`*^9, 
   3.6295101988231077`*^9}, {3.6295102308008327`*^9, 3.629510243317732*^9}, {
   3.629510285299576*^9, 3.6295104585827255`*^9}, {3.6295104900751114`*^9, 
   3.629510556188098*^9}, {3.62951058988103*^9, 3.629510639001956*^9}, {
   3.6296718857346325`*^9, 3.6296718875627794`*^9}, 3.6296719269695234`*^9, {
   3.629671962985627*^9, 3.629671991111003*^9}, {3.6296720373616176`*^9, 
   3.62967206464323*^9}, 3.6296721109250965`*^9, {3.629672149425639*^9, 
   3.6296721710665207`*^9}, {3.629672241692461*^9, 3.6296722792867427`*^9}, {
   3.629672651622384*^9, 3.6296726735445476`*^9}, {3.6296727594519424`*^9, 
   3.629673070471675*^9}, {3.629673129800623*^9, 3.6296731544102707`*^9}, {
   3.6296732120829215`*^9, 3.629673267458641*^9}, {3.6296733218031445`*^9, 
   3.629673476945864*^9}, {3.629673509508767*^9, 3.6296735172120256`*^9}, {
   3.629673562025119*^9, 3.629673582415995*^9}, {3.6296744407086887`*^9, 
   3.629674442505555*^9}, 3.6296745310379825`*^9, {3.629674604663962*^9, 
   3.629674604913965*^9}, {3.629675481706911*^9, 3.629675482519391*^9}, {
   3.6296755512859654`*^9, 3.6296757340539885`*^9}, {3.629675791804788*^9, 
   3.6296758172113447`*^9}, {3.629677221019473*^9, 3.6296772320196486`*^9}, {
   3.6296818215356655`*^9, 3.6296818437234945`*^9}, {3.6296819356934633`*^9, 
   3.629681951928025*^9}, 3.629682031429082*^9, {3.629682110008253*^9, 
   3.6296821391023903`*^9}, {3.6296821980250816`*^9, 3.629682240478725*^9}, {
   3.6296822842136955`*^9, 3.629682313526616*^9}, {3.6296823630584955`*^9, 
   3.629682365699145*^9}, {3.629682593639717*^9, 3.629682700031763*^9}, {
   3.6296918820096855`*^9, 3.629691882306531*^9}, {3.62969196333889*^9, 
   3.6296919878235855`*^9}, {3.6296931933708487`*^9, 
   3.6296931939646363`*^9}, {3.629693399842346*^9, 3.6296934001704764`*^9}, {
   3.6296945694388647`*^9, 3.6296946616119633`*^9}, {3.629694870395962*^9, 
   3.6296948743647966`*^9}, 3.629695004085241*^9, {3.6296950726330566`*^9, 
   3.6296950889769955`*^9}, {3.62969516072795*^9, 3.629695160806061*^9}, {
   3.629695222150642*^9, 3.62969522219751*^9}, {3.6296953833090353`*^9, 
   3.6296954815290947`*^9}, 3.629695568577096*^9, {3.629695784251849*^9, 
   3.6296957861581454`*^9}, {3.62969602856765*^9, 3.62969604677102*^9}, {
   3.6296961218813615`*^9, 3.629696122756374*^9}, {3.6296965261523952`*^9, 
   3.6296965267461557`*^9}, {3.6296966300756226`*^9, 3.629696637638254*^9}, {
   3.629696673013726*^9, 3.6296967354520254`*^9}, {3.6296974850089045`*^9, 
   3.6296975422752604`*^9}, {3.6296975874008613`*^9, 3.629697732199662*^9}, {
   3.629697896811227*^9, 3.6296980364381175`*^9}, {3.6296981628928633`*^9, 
   3.6296982006121445`*^9}, {3.6296983156605496`*^9, 
   3.6296984317402444`*^9}, {3.6296984687407417`*^9, 3.629698477600232*^9}, {
   3.629698535866605*^9, 3.6296985359916058`*^9}, {3.6297002303152475`*^9, 
   3.6297002533312244`*^9}, {3.6297002848941116`*^9, 
   3.6297003005661964`*^9}, {3.6297004778810854`*^9, 3.629700541381899*^9}, {
   3.62970067960252*^9, 3.629700709696638*^9}, {3.62970086124553*^9, 
   3.6297009227775984`*^9}, {3.6297009722001643`*^9, 3.629701030310279*^9}, {
   3.6297010654670005`*^9, 3.6297012372505646`*^9}, {3.6297012830480165`*^9, 
   3.6297012845480375`*^9}, {3.629701397955795*^9, 3.6297014065340147`*^9}, {
   3.6297014753162003`*^9, 3.6297014932070923`*^9}, 3.6297016838346*^9, {
   3.6297019870886335`*^9, 3.6297020314642253`*^9}, {3.629702082261775*^9, 
   3.6297020823242593`*^9}, {3.6297021677941923`*^9, 
   3.6297021817475023`*^9}, {3.6297023925159025`*^9, 3.629702423688178*^9}, {
   3.6297026923073645`*^9, 3.629702735589245*^9}, {3.629702779371049*^9, 
   3.629702807199544*^9}, {3.62970293701377*^9, 3.6297029537483687`*^9}, {
   3.6297030072178297`*^9, 3.629703008733508*^9}, {3.6297033400503836`*^9, 
   3.6297034170201573`*^9}, {3.6297034795834894`*^9, 3.629703546943737*^9}, {
   3.6297035985381975`*^9, 3.629703655226452*^9}, {3.6297037071021423`*^9, 
   3.6297037210085773`*^9}, {3.6297037554309397`*^9, 
   3.6297038721512427`*^9}, {3.629703902307864*^9, 3.629703924651911*^9}, {
   3.6297043585326843`*^9, 3.629704358704561*^9}, {3.629704464518469*^9, 
   3.629704550582114*^9}, {3.6297550782067432`*^9, 3.629755082306635*^9}, {
   3.6297582385405226`*^9, 3.629758239509254*^9}, 3.6298533631088195`*^9, {
   3.629853397495614*^9, 3.6298533977263546`*^9}, {3.629853439787386*^9, 
   3.6298534403465834`*^9}, {3.6298535981088753`*^9, 3.629853598176324*^9}, {
   3.6298549776992793`*^9, 3.6298550656830587`*^9}, 3.6298551255788975`*^9, 
   3.629855388416956*^9, {3.629855720237568*^9, 3.629855742005224*^9}, {
   3.629855821997023*^9, 3.629855822325505*^9}, 3.630012682807435*^9, 
   3.6300127684957995`*^9, 3.630762762328099*^9, 3.6314470969654565`*^9}],

Cell[BoxData["1.5362383997744917`"], "Output",
 CellChangeTimes->{{3.631447085790485*^9, 3.6314470978070416`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "6.261311053059352`*^-16"}], ",", "5.264949550387539`*^-16", 
   ",", "5.5296579201268425`", ",", 
   RowBox[{"-", "7.528469139625237`"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.631447085790485*^9, 3.6314470978090305`*^9}}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"q", "[", "s", "]"}], "\[LeftDoubleBracket]", "3", 
       "\[RightDoubleBracket]"}], "-", "\[Pi]"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"q", "'"}], "[", "s", "]"}], "\[LeftDoubleBracket]", "3", 
      "\[RightDoubleBracket]"}]}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
   RowBox[{"Epilog", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Line", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", " ", "\[Pi]"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", "\[Pi]"}], "}"}]}], "}"}], "]"}], ",", " ", 
      RowBox[{"Line", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", " ", 
           RowBox[{"-", "\[Pi]"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", ",", " ", 
           RowBox[{"-", "\[Pi]"}]}], "}"}]}], "}"}], "]"}]}], "}"}]}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Plot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"TE", "[", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"q", "[", "s", "]"}], ",", " ", 
          RowBox[{
           RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}], "]"}], "-", 
       RowBox[{"TE", "[", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"x", "\[LeftDoubleBracket]", 
           RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"\[Pi]", ",", " ", "0"}], "}"}], ",", " ", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", " ", "4"}], "]"}]}], "]"}], "]"}]}], ")"}], "/", 
     
     RowBox[{"TE", "[", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"x", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"\[Pi]", ",", " ", "0"}], "}"}], ",", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", " ", "4"}], "]"}]}], "]"}], "]"}]}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ParametricPlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ".", 
       RowBox[{"q", "[", "s", "]"}]}], ",", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ".", 
       RowBox[{
        RowBox[{"q", "'"}], "[", "s", "]"}]}]}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"u", "[", 
    RowBox[{"s", ",", " ", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"q", "[", "s", "]"}], ",", " ", 
       RowBox[{
        RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], "]"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "0", ",", 
      RowBox[{
       RowBox[{"60", "/", "2"}], "/", "\[Pi]"}]}], "}"}], ".", 
    RowBox[{
     RowBox[{"q", "'"}], "[", "s", "]"}]}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"RootMeanSquare", "[", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"u", "[", 
     RowBox[{"s", ",", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"q", "[", "s", "]"}], ",", " ", 
        RowBox[{
         RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], "]"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"s", ",", "0", ",", "t", ",", " ", 
      RowBox[{"t", "/", "200"}]}], "}"}]}], "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"RootMeanSquare", "[", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"60", "/", "2"}], "/", "\[Pi]"}]}], "}"}], ".", 
     RowBox[{
      RowBox[{"q", "'"}], "[", "s", "]"}]}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"s", ",", "0", ",", "t", ",", " ", 
      RowBox[{"t", "/", "200"}]}], "}"}]}], "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.6296946717370386`*^9, 3.629694826723506*^9}, 
   3.629694987850649*^9, {3.6296951276181345`*^9, 3.629695136149528*^9}, {
   3.6296952460103655`*^9, 3.6296952805420732`*^9}, {3.629695892393964*^9, 
   3.6296959347226505`*^9}, {3.629696158225628*^9, 3.629696192929185*^9}, {
   3.629696229257819*^9, 3.62969623219536*^9}, {3.6296962635394974`*^9, 
   3.6296962906805143`*^9}, {3.6296963253215694`*^9, 
   3.6296963553219495`*^9}, {3.6296963904161844`*^9, 
   3.6296964358855705`*^9}, {3.6296985122413225`*^9, 3.629698514022593*^9}, {
   3.6296985695858335`*^9, 3.629698611570766*^9}, {3.6296999590460553`*^9, 
   3.62970002607817*^9}, {3.6297001004072824`*^9, 3.629700101813551*^9}, 
   3.629700138814073*^9, {3.6297003987706585`*^9, 3.629700400458181*^9}, {
   3.6297005897888255`*^9, 3.62970059211698*^9}, 3.629701664881222*^9, {
   3.629701814820717*^9, 3.6297018204614167`*^9}, {3.629702219513629*^9, 
   3.6297022242949452`*^9}, 3.6297023294213123`*^9, {3.6297027636833706`*^9, 
   3.629702773855381*^9}, {3.6307631355531845`*^9, 3.630763164413101*^9}, {
   3.6307631982105536`*^9, 3.630763210945116*^9}, {3.6312826504931297`*^9, 
   3.63128265336817*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"N2lbf", " ", "=", " ", 
   RowBox[{"1", "/", "4.4482216"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Plot", "[", 
   RowBox[{
    RowBox[{"N2lbf", " ", 
     RowBox[{"Rest", "@", 
      RowBox[{"DynamicQnts", "[", 
       RowBox[{"mag", ",", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"q", "[", "s", "]"}], ",", " ", 
          RowBox[{
           RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}], ",", " ", 
        RowBox[{"u", "[", 
         RowBox[{"s", ",", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"q", "[", "s", "]"}], ",", " ", 
            RowBox[{
             RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], "]"}]}], 
       "]"}]}]}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}], ",", " ", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"N2lbf", " ", 
  RowBox[{"Max", "[", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Max", "@", 
      RowBox[{"Rest", "@", 
       RowBox[{"DynamicQnts", "[", 
        RowBox[{"mag", ",", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"q", "[", "s", "]"}], ",", " ", 
           RowBox[{
            RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}], ",", " ", 
         RowBox[{"u", "[", 
          RowBox[{"s", ",", " ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"q", "[", "s", "]"}], ",", " ", 
             RowBox[{
              RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], "]"}]}], 
        "]"}]}]}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"s", ",", "0", ",", "t", ",", " ", 
       RowBox[{"t", "/", "200"}]}], "}"}]}], "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.6312826747903357`*^9, 3.6312827097439413`*^9}, {
  3.63128276260401*^9, 3.6312827817448936`*^9}, {3.6312828425813284`*^9, 
  3.631282885969198*^9}, {3.631282972259715*^9, 3.6312830187759757`*^9}, {
  3.6312830877144165`*^9, 3.631283121355502*^9}}],

Cell[BoxData[
 RowBox[{"Quiet", "@", 
  RowBox[{"ParametricPlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"u", "[", 
       RowBox[{"s", ",", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"q", "[", "s", "]"}], ",", " ", 
          RowBox[{
           RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", 
         RowBox[{
          RowBox[{"60", "/", "2"}], "/", "\[Pi]"}]}], "}"}], ".", 
       RowBox[{
        RowBox[{"q", "'"}], "[", "s", "]"}]}]}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}], ",", " ", 
    RowBox[{"AspectRatio", "\[Rule]", " ", "1"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.629704708662342*^9, 3.629704759991125*^9}, {
  3.629704817773198*^9, 3.6297048189919353`*^9}, {3.6297048611956224`*^9, 
  3.6297048651488085`*^9}, {3.6297050040881767`*^9, 3.6297050155883303`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SpeedTorqueCurve", "[", 
  RowBox[{"10", ",", " ", "25", ",", " ", 
   RowBox[{"Point", "@", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Abs", "@", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"u", "[", 
           RowBox[{"s", ",", " ", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"q", "[", "s", "]"}], ",", " ", 
              RowBox[{
               RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], "]"}], " ", 
          "1000"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"q", "'"}], "[", "s", "]"}], "\[LeftDoubleBracket]", "4", 
           "\[RightDoubleBracket]"}], " ", 
          RowBox[{
           RowBox[{"60", "/", "2"}], "/", "\[Pi]"}]}]}], "}"}]}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"s", ",", "0", ",", "t", ",", " ", 
        RowBox[{"t", "/", "200"}]}], "}"}]}], "]"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6307646487411795`*^9, 3.6307647622587137`*^9}, {
   3.630764800087515*^9, 3.6307648320880423`*^9}, {3.630764936206891*^9, 
   3.630764941431609*^9}, 3.6307650420599003`*^9, {3.631447117125819*^9, 
   3.631447117198871*^9}}],

Cell[BoxData[
 TemplateBox[{GraphicsBox[
    GraphicsComplexBox[CompressedData["
1:eJxdmHk0lO0bx2VX9shSok3RYsmrkpovlaUsKVtIjKXJToSxRJbsKRVJUtYk
iUTWyVYkSaRFZK1XpQWlQr95z/E8zvld/zjf89wz537ue87l87lWUN0POLCy
sLCELGBh+e/vPbYGrr/j+yjP/lATL72i4334momOzGhwsoqnUw/QMeRcE/6u
LBVX8uJ5W2v9oWBrO8L1KhMJanT9T6r+0PvYxxnzTz6UJjKGK4v8EO5VfZsn
oQgqBlG966X9kCVp62zVVIKkpJEbB5J9kfRbuL54VxmM/DleSLD74jsP26Ga
ogrURVofSjx+Akm7dWe7B6qRcHLT7epPPgh903b1dwEDFeK1DrEWPrCQX60j
uK8OGleaxgQ6vPExMeUMS3896LrcT3fpecN+sUi216VGiFxcKCheeRzBN9Xq
nFUegrstbFXm5uM4eYR2a+TbIxzOqU5uy/DC1vWlW9RzW2Cfo2R3Q9AL53hv
NYtTWtF0dtmC7TGe6OQpkPP99QRRUo/+ukx5oGyZ6Vmri0+RdX603cTDA4zs
sMH+/HbsMb/MUXPfHQuaPz45FfkMWS+6xBRS3LDYV0796MEOlK+fbeOLcYV4
idPZOKXnSHiQq73RwQVj/qFOkyydkNhEcag46IyM1rVJ+1o7wT26VylH2wla
t55dH8jrQvlId03H6mOoEjdSrT7xAtIVB765iNIgK9xZ9NKkG3vaDIa1vzjC
JXmE3q/4Es+Uak+HtjkgLLft0caZlxB0kXq67oE94vdUzFS8fgXh99Pdglfs
QHMLuBd74zVatrZEOMZRIb2qtUbX+w2GXi0akAy1RYuDTKHO/h4wKtv+Chyx
wZ7Ne1fESr1F1ofZ8OEMa9xN8A3gn34LnTfU+A2mVhj3ph/qetwLq4DrfQbK
FuB/z3s6OrkPKhUtCZskzJFw/Jk+Re0dztMnGWc6TDCzlSvV8to7WH34o95a
fBCOjTWHxIX6kdfNrh7jYIRqsZ0PHgf3w+/xJ4VFWgYIUsgblRnuh4fm6YBy
/r1Q5T9/eonxAPyqZJ/QAvfAvNhp5FblAHTOBhU/3aIB2jKez9tXDGK/9r5M
qpAavPTljjqdGYSMV/bn9TOKGNqlkqn2YxDI7qlp4F6BnSxsv/7ShsAiyetN
ExmrtfNxKOnM9Men4B1isxfoELq+1OCKAvP5wy3u0wb8sDIdVnqZeQzWO9qf
Py6j4/f33KmPwkNAcv7rsDRxrDM6k2mgx1zPUDkw0PyDoi8+vKkv8xCS0ySK
ix/R4b50TD+JfQiMr0oFnGZSSPPvmprcwVwvItf64xU7StbpGuRaMPOjCpvy
2TaKQtrQus+ZulDR27lC9hkd+QpnpxxnBhFyZVJE5640XsT7ZTarMte7FV3x
P8+DMfVPU/SDzCyuZ33/xijFTyQn87ktM9u/tawwflE7njm4jCdrG1iz2l8e
6aLj4f2BJ+2/BsFScdPe21MGE2Itfps3/3ce3pyV3xZh0cMdbUOGzOx4K+SI
wHfKxfSffjusmVmGpdDP5GatZYxx2zGH/57PtFOvDtUGlPSza2TJYfTppbuB
3XS8CI4t55hi7leh4eyyahmwvvWyoykx13/rqrCU4YNk3Ei5hAEzC3v+m+Ey
Qcmyy7DzsmLmdrV/LOTKKU6GM+Xpdsy87NNsbXNfrV7jzUGVo/+db/j14UP/
1hL9TOCCQRMjM5a8TyIT/YwjIiuyxzaS7GfjTSyrDNSDyH7mWh3X83WLD9nP
tC2+PZBKcCf72a+WE2PnfGlkP4tKGTxlcpNK9rOFTvSKTCMrsp8hYV1nhL4J
2c9k9p/sXRuuT/azlTrFna8ZmmQ/w33lPl4fZbD8XxHvR+R00br+hwmN5LrE
fTYigakZGE7sdg5uCMXOnIwfOly5SPojdzK31A/ytI0lbXm3EFZxg2dc1Qvn
tc7wbZYvRp8Ld6lfjTPSFqolc0WUQizExXirrQM0WRclbP1dDtnR/EhHPRto
rs1Z/1i3CrdMJgZFC8xx/XCvM/eSejyqODASX7cd6w6Ypm6rbgBj6fPo2bQV
OBVaa+ry4wp6bm83FO4Kwz22ULd1HtmgRTTzBrfTUXmD8/CGLzeRLPw06Pu1
44izyrFebnUHGwbbznacc0XGOf0Fxdl3YZC52uppryOcZhPyJpeXw3iDAS3v
uC1SU4zrdgdV4uBmT/YtPhaY3bXAIq6oDk2rVtWd0gViPH+KSBk2IOOt1IKO
tesRFbq4jrozGacoHOJN/dGweWEz82DbddA0RHV/8IegUYcRfCw9Dzwl7Jsk
ek7gkqwxjyf1Njqcb7u++eKBNEW/Ku2pYuzuNPkrycvsz76VQeEB9VCMtY87
wb8FTcql0qbrmfdxj507ME4QJT9qXGXN0rAySktciycCXsqe8ilZWfiprX9i
6Z8AhO8dV7IUvgk1bSk9/qPeiHqvxCUyWQTacL6mRqwbrpuaqXKp3sWmrlqt
pNyjCJ5u/8f4ThnER/mFTPio0Hp2M36BWCUOKeumfbCxxIYyYaO2oDrYBNje
2x6mAbUFOh384g3g7T666T2LIqYS33FLO11DjNvDn1/6QnDKt0jtVUcuFuV1
B0Y98AX1IXqvRhRChn9L/r4znkipZHPYcbYYnHycAkb9TvAebfVu0mHe9+9y
RWGHbfCt43irPdGArxHc7ukvJGDEy6AUX7iKkUn/v9m1p/C7M7G4fHsONi5T
SeWp8Mer/hyz9ZHM9efVI+5YyuLeD1rmij8pOL//1F59tiiIZtpT7anM8+uL
6drnPEPRu7PTP+z0ZRRlWAilF0WgXfcYd/vOLBjFTyaWpQTiQ+qxtO+Z+bDe
UOg28cQbnLd83yQ8KILqiHydySJ3ZG7taVeaLUHz1SqBLH4aov54BobRy6DY
O8n50JKKNFez8b7BCvCvF7W79tIS9R6X9dzt6xC+8mtA3ApNCOt+LTo9XY+C
qBP2QmpK2O2WkaDPeg2J7s4Pkw1D8S4hT1zINRdLh95K5G/zQ5NYmc4WsUJM
/25YyzfgiSWhutvKDxdD2o3DuNfAGYuyTDyOKtQjpTsi4+s5NexfWFjJeNkA
Qer1ComI5RhtouwTaErHtE6/+DOtMJh/ikr82pWN2cfd3/o16SiWM1TNcmqA
X7+ALh9jHaTVa5TrlqXAvFs0XXQ0CmOjvBpvtRrxburVUZ1+Lnxrohmx2VyE
h+GBJ6afYpBOPzzbJsB8PiAv7LVJFOqWVWEfgxoRQk1YG202QklJmJ29I30Z
gnkZWt+5IhFi4vDz46IsXCgVfl39byAk67OMalzy8e6GsGc8qw8az6Tuac0t
wuqrEwxbPWZ/vLF8ufZACWBQwOjVpIE/oE566ZEynD3Hu8UpjIqH2zfKGrZU
gJLXMDIlYoWEJ0daas3q4Ehde3expyZmXXbLNIzVI8SoIcS4WwmjViHP7Nsy
8COpaP3h6FCcSc3i2qiWi1WSw2vlff0wRfk+w/ruFgr61guq8Xqhy84lc3JX
McwKDR/TIp3xgkVyrGwl8/sEkn9Fym+H+ibW9TMtDcib2nDU2l0Gqll/23dY
p8NBkvGaIz4MXFPhJ3kzs6Hmx3dwcTQd6fqZ2e+sGvDyoe6N0HE5dPbS6Odu
JaPaoUGwxC4ar/ltiyS2NQKqO/IuB/Ai59jiS8+/XkD9nrIUR/9YxKTfcV3E
2gjFo1FfakPFsO6k4PhaD+Z6myGVizoTFNaH5c8yjJnnL+vjNqXLhv1baCK3
Y5m//5GtGodzGJSdQb0azR9TMbr2YtM5lUiYWw6O+X/PxPrXoqydwkHYbKa5
YbVRPnILBGPWSPlg9YKC36OpRTA3+h0v5+qO1QO1DUadJeDyGjotd5iG9gqn
b45GZehovtxsmkxFz8qU2sjqCuS63O7etdkKE380eGhGdaByLaF8SdHERPCY
2cD7epjfDJtaIauMHcZfvTzuZuCOVWrEg5xQOGas/Fshk4uIxr4HOhf9INR5
5iWt4Ra6oxa/Dl/hBZWuIHORLcVoSgwYO3LdGeoK0xtsljH75a1Aw8AT26GM
AurShgZwj9yPFeFcgZ5zfYtN5NPx009r7GlRGHpnWH1To7Phacb1O6OAjvNH
9N/OmjRA3NBULSFeHpsUd6b/9knG5YO0j3LXo9Eus+jDFmXm+Q1fNP/QzI+Q
IstsuT8NQEnVv9M3xbH8bIW81jHm+R8Le7r51RRl6iWVp1a/ETJx947gAge0
dIX1noQzP18v9VE1+DVF2dWxkseXeT/qjpsHvb5QyP+3IfpbzfjtKf/PGwQ/
BG47vSr5RSTJD0XZezb2d4SS/MBuzGY6YxFE8sPkI411F5z9SH7QeXahuu+B
N8kPymN3m3kXepH8UCj/NGYnxZ3kh6USHU4LfZ1JfihMD0nevYdG+lAaO0Mq
ieJA+tBhWcfo0gdU0ods1ZKFDprZkD40arrSWpdmRfrQDi//sph6c9KHSj0s
1fKlTUgf+pJRUSjyy4j0IWHtrxc/n9MnfYghIp7gck+b9CFe1SYF2zhN0oe4
m7o6D/mrkT5kVbnjUiKXEulDGVd7Rx4dkCF9iOAdwoeITPgQkQkfIjLhQ0Qm
fIjIhA8RmfAhIhM+RGTCh4hM+BCRCR8iMuFDRCZ8iMiEDxGZ8CEiEz5EZMKH
iEz4EJEJHyLfb86HiEz4EJEJHyIy6UNEnuNJyozy1T8rYkiebPfWP6jAG07y
5FRnvCTL8hCSJ5/39FvwldBJngzeH6nL53+C5MnQ1h/PVI2PoyVoPN0xvRYB
Uxysw40eGDv16zhH4AM0ZGgLftB2xXjVtGSyGvP+D+w0+vfPIiywO/vpqcD8
/ZN+NlcEXzZuXN40aBlB8qVMtbDh3bEQki+VLq5Z7P4rgOTLsp9OaUudfEm+
vLbVjrqV0xubbNMNrjJqUNhc+PyjnSe2KgzxhIg8gH3rgjqXnW5o2S1s5snW
BcUdj3L/2SOG1VF3tA/1zP9eCT8kMsGbI56Rthdto0je3NmYW059d4rkzQNl
a8aTqoKRckp242H7e9AS0RK7Ge6PZf+8763y7ALuaAeoqI9TSN+cK4IvXwnX
LbZYHEnyJeP82b0K1qEkX65J4jRNyQkk+ZKF1hpU+MGX5MsWVcfCZqo33nUc
z6k0qkESn8vnz6WesIp4ZVz9joGPbI3yIdVuKOWW8ul93wkZl+nRzd+XojRV
Y/JK3fz7E75LZII/DbmvyHqqRZP8OSMW4b3RK4zkT7ErP3WM/E4iVUuRWjxR
iutp5wQWStDB/evbtJxpF2x6u9jYHrLO+zNx3nP8idoQxWaJWPSGcG1jl+5C
4ovXfMHpwlDy7GEYxjP3B+pqaZkiCunbc0Xw5T/tMz6uxyNJvjzK8tryTXIo
yZd7d8k+fvM3kORLi1K2xCQ5P5Iv/Yq7jVjPeaMi1rpDV7IGy9fV6pf3ecJN
0fj3myYGbgc99uCedUO+00p20dedYInuPSi6bzlmM3n0GKXz50f4PpEJ/hQR
bQzWKYgm+VPobbXSspowkj+LOrmUVr46icvrSqd7qkoRJ3yn0siBjlmLn7E2
Oszvn/x1ZvwI1/z8gOgfc/zZSNHaZZYWi84B3kdqQl0IUfl+RvibCGSf9xtG
nmR+XlCZx2LrEIWcN8yVcPIn13E75nqLwJurqNMUdYFuJYnL8+9DziPmiuDL
5/e3iF/JiiT5MliYbbdyaSjJl5H2azsUNgaRfGl1UdPAY68fyZf3FUs399zw
huyHgx8SZ6shdvOo+LMJT0xFCOl/vM9AflhfYvxyd2Qvzd6n+LwT++Nz/0j7
SeN6nquv0e35/ZHzkLki+PPE5sNOmSPRJH++3fj7ft9QGMmfIvisvpaD2f8u
/dT9nlEK4dFec5Y4OqYW0Z8HaHQhw+yLc/wtnvn5ylw9TTojYLqwC+1fNoh/
l1yCFeH2ydf8mPtpDp35YPqZQs5f5opPx72U/zDz+yYH3uYHsECVcchf5fz8
/sn5zFxtWHmE2zmS+fyaUZzXthcUDWvj0Zlr8+vJ+c1cEXyZ5yUTGlIdSfIl
jfND+mx9KMmXRRq03Vy7g0i+HBsczv1l4UfyZZ3XxqqXpd7MezI4fvdrNfTP
yCc4/fVElaLHD68SBoI4dsS92+SOld6OX6qfMv/f64ZMO3DJYCJfmk+yYH5/
xPyIyAR/sh+UOa7AHkPy55L41uc+U2Ekfy7TG9aMFQrBso6Ur9PnSiHdav2D
fpWOE/bbfXl2Mn+fCleEMjsXzs+j5krv0/6SQc4uMNw/mHMVLUF6z5rtCj7M
9TELTbPHv1LIedVcxWQoHko7xFx/N3EB5doC3BVfKlWXOL9/cp41VzfoMgVT
p5jPqxSkzI37KDX3RBNi0+fXk/Ouubp/NKUrJ3n+eWHzFfu30cy8X9KcAy0U
ch42V5lp8kmO7RfI+VfdmnGD/e3ZZP4fwb2CtQ==
     "], {{{}, {}, {}, {
        EdgeForm[], 
        Directive[
         RGBColor[1, 0, 0], 
         Opacity[0.2]], 
        GraphicsGroupBox[{
          PolygonBox[CompressedData["
1:eJwt0uc2FgAAgOGPO+mGHGQfe4X0GdkkJET2HtmULWSnrMqKygV5nNOP5wre
90l6QWQwNBAIhNBEGIkkcc8+f5niH7vc0coefxjnC78pY5IdbnnLMOtckE0L
Y2xyTQGv6WWRUxIopZEh1vhFFkFq6WGBE+KJI5ZMXvCKbj5xTAwZ5FNDFx/5
TjTpPKeaTub5RhQlvGGQVX6SRh5VdDDHEU95SQMDrPCDVHKppJ1ZvhJJMfX0
s8w5KTQzygZX5FDBe2Y4JIIi6uhjiTOS/zcd4TOXPKOcNqY5IJx3fGCLGwqZ
YPuxjTkeAJECTok=
           "]]}]}, {
        EdgeForm[], 
        Directive[
         RGBColor[0.560181, 0.691569, 0.194885], 
         Opacity[0.2]], 
        GraphicsGroupBox[{
          PolygonBox[CompressedData["
1:eJwl0nlTj1EABeBfZYsQZUm0kUq2KCVaKWtKhFAIlWiTypKm7+P7hCIUqVRU
ZC09xh/PnHfmnDvv3JkbX9Nc3hQcCASCeEaIj1LZI4+wh0U0cp4cUoii1+6m
PMl+YlnNYpqoIJcdbOK5/S15inTiCGcJzVwgj1SieWF/W54mg3jWsJQWLpLP
Tjbz0r5WlnCABNayjD5dnTxDJluJIJR+Xf2/e5PFNiJZzivdHVnGQRJZxwpe
6wZ4w1veMcgQ7/nAMB8ZYZQxPtHg/Fmy2c562rjMUfYSRiuXKGAXHVRxjC08
4ApFPOI6T0mjk2q6OM5jbjDu/3dlOYdIYgMrmdBN8pkvTDHNDF/5xizf+cFP
fvGbP8wxz9/A/0cVRDD3OMdhktnIKu5TSSG7iaGdqxSzj4dc4wRPqKGbBbLn
SWo=
           
           "]]}]}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}}, {{}, \
{}, {
        Directive[
         Opacity[1.], 
         AbsoluteThickness[1.6], 
         Thickness[Large], 
         RGBColor[0, 0, 1]], 
        LineBox[{1, 71, 65, 60, 56, 53, 51, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 
         12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 
         29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 
         46, 47, 48, 49, 72, 66, 61, 57, 54, 52, 73, 67, 62, 58, 55, 74, 68, 
         63, 59, 75, 69, 64, 76, 70, 77, 50}]}, {
        Directive[
         Opacity[1.], 
         AbsoluteThickness[1.6], 
         Thickness[Large], 
         RGBColor[1, 0, 0]], 
        LineBox[CompressedData["
1:eJwt0dVSFAAABdDlU/gjXECBB2JRRGppKUG6u1tSQUklRelUST+IwwwPZ+59
vXMjQ+FgTkQgEKilStmUk+Tyjx+M00wUP5mmlfe85Yo1RmggkRO+0sdH8njB
HjO0UUI6f1hnlEaSOOUb/VSTT5BfzNJOKe9I5owlBqihgGh+M0cHZWSQwjnL
DD5vLySGfebppJxMQsRywGe6qCCLVF5yyBe6+UA2r3lFHPEcsUAPleTwhgtW
GKKOIhI4ZpHep28I85fvjNFEGpesMkw9N2zxiWKu2WCCO3Zo4ZZtHpjinl3+
8whBBE19
         "]]}, {
        Directive[
         Opacity[1.], 
         AbsoluteThickness[1.6], 
         Thickness[Large], 
         GrayLevel[0.5]], 
        LineBox[CompressedData["
1:eJwVzelWDlAABdCvImUoqdBEmUoaFFFJIRSZKqQoSQNJRYaMq+fxQEKSRKhE
ESpk92Ovc9c6596b0tRV1RkUCASe0edQSjZLuMlZ9rOdOJ7bXZXH2cVGIlnK
4kPnKCadePrtm2UFu0lmNaF0cZ4SdpDAC/sWeYI8UohiGd3UcIAMEnlp3ypP
sodNrCGMV7o2eYq9bCaacAZ01+Rp8tlCDMt5rbsuz1DAVmJZwaDuDUO8ZZh3
jPCeD4zykU98Zoxx2t2vpJBtrKWHOg6zk5Xc4gIHyeQe9ZSRxB0ucoQHNPKE
HO7TwGPKecgVJvx/Q1axj1TWsYovukm+8o0ppvnOD2b4yS9+M8sc8/zhL/9Y
IOC9IILpoJoi0lhPBLep5RBZbOAulzhKLr1c5hiPaOIpIfwH2ONJGA==
         "]]}}}], {
    DisplayFunction -> Identity, AspectRatio -> 
     NCache[GoldenRatio^(-1), 0.6180339887498948], Axes -> {True, True}, 
     AxesLabel -> {None, None}, AxesOrigin -> {0., 0.}, DisplayFunction :> 
     Identity, Epilog -> {
       PointSize[Large], 
       TagBox[
        TooltipBox[
         PointBox[
          NCache[{4000, 420/Pi}, {4000, 133.69015219719208`}]], 
         "\"Operating Point\"", LabelStyle -> "TextStyling"], 
        Annotation[#, "Operating Point", "Tooltip"]& ], 
       Thickness[Large], 
       TagBox[
        TooltipBox[
         LineBox[{{10680., 0}, {10680., 6000}}], "\"Max Battery Current\"", 
         LabelStyle -> "TextStyling"], 
        Annotation[#, "Max Battery Current", "Tooltip"]& ], 
       RGBColor[0.5, 0, 0.5], 
       TagBox[
        TooltipBox[
         PointBox[{7000, 75}], "\"Operating Point with Safety Factor\"", 
         LabelStyle -> "TextStyling"], 
        Annotation[#, "Operating Point with Safety Factor", "Tooltip"]& ], 
       PointBox[{{995.5691836233261, 9.549296585513721}, {1040.4844308269317`,
          10.071821153585347`}, {1086.7755306803813`, 10.604701117843078`}, {
         1134.5525652164815`, 11.148041089703115`}, {1183.9345155819994`, 
         11.701997829621748`}, {1235.0494000219833`, 12.266784881976825`}, {
         1288.0346882017313`, 12.842681722173658`}, {1343.0367724907883`, 
         13.430027405354505`}, {1400.2116622543308`, 14.02923408094803}, {
         1459.7254121053008`, 14.640794853576114`}, {1521.7529156860458`, 
         15.265265775220744`}, {1586.4795457694022`, 15.90329215202231}, {
         1654.1008247560405`, 16.555602353207338`}, {1724.8226893596247`, 
         17.223010018979394`}, {1798.8619640653615`, 17.906418220778043`}, {
         1876.4469609000987`, 18.606823904554428`}, {1957.8178584951636`, 
         19.325317209360225`}, {2043.2275473067505`, 20.06308596751525}, {
         2132.9424416559286`, 20.821417478841788`}, {2227.2434524799596`, 
         21.601700301182532`}, {2326.4271880752417`, 22.405426818621326`}, {
         2430.8072833146994`, 23.234194918190447`}, {2540.7159483984556`, 
         24.089709891660213`}, {2656.5057219650084`, 24.973786128617245`}, {
         2778.551440006894, 25.888348656432054`}, {2907.252417363723, 
         26.835434432197278`}, {3043.034834446437, 27.817193368110747`}, {
         3186.3543002411443`, 28.835888757778537`}, {3337.6985407968796`, 
         29.893896908365864`}, {3497.590126832121, 30.993705563302203`}, {
         3666.5891478527356`, 32.1379112740833}, {3845.295611510212, 
         33.32921432902356}, {4034.351284516594, 34.57041034407151}, {
         4234.440557893759, 35.8643771653215}, {4446.289887872789, 
         37.214057372512755`}, {4670.664975465147, 38.622433357487026`}, {
         4908.3644412223375`, 40.092490018166}, {5160.208523646158, 
         41.6271624619475}, {5427.0209624827785`, 43.22926688565721}, {
         5709.60172376759, 44.901413203869}, {6008.685988593022, 
         46.64587792209962}, {6324.885293849367, 48.46443513923731}, {
         6658.60527814218, 50.358136148315005`}, {7009.935573744405, 
         52.32704932916576}, {7378.501049899378, 54.36990394326199}, {
         7763.268365353029, 56.483638205690504`}, {8162.303992089404, 
         58.66285381903847}, {8572.489822379956, 60.89922480356922}, {
         8989.194077844986, 63.18074522423944}, {9405.941998499597, 
         65.4910125684019}, {9814.120507314345, 67.80847052574984}, {
         10202.809894063741`, 70.10584573418333}, {10558.835017739382`, 
         72.34985931875751}, {10867.145931695311`, 74.5014037649902}, {
         11111.610995565996`, 76.51639360294917}, {11276.215233446925`, 
         78.34732884771137}, {11346.55252432924, 79.94562767112451}, {
         11311.349183939612`, 81.26443481283842}, {11163.693479503665`, 
         82.26156442861954}, {10901.662197597041`, 82.90209879717413}, {
         10528.177911968705`, 83.16017390710556}, {10050.137184891653`, 
         83.01967106218565}, {9477.035821581821, 82.47379215302864}, {
         8819.40818576108, 81.52366627287128}, {8087.384088993058, 
         80.17632245991646}, {7289.576826552698, 78.44236896443455}, {
         6432.401304218828, 76.33370492647009}, {5519.824095894711, 
         73.86143637704299}, {4553.494964038857, 71.03415215593014}, {
         3533.168953146699, 67.85656467602111}, {2457.340294549654, 
         64.32856012125953}, {1324.012728389883, 60.44464707165253}, {
         131.55832647143913`, 56.19382337312667}, {1120.3304668627181`, 
         51.55999966491989}, {2429.5707113710605`, 46.52298165636516}, {
         3790.405036089671, 41.060334142380356`}, {5191.824529809325, 
         35.150288640904165`}, {6615.701222406372, 28.775889541053097`}, {
         8034.890921298448, 21.930635637871458`}, {9412.009419357571, 
         14.62519620940159}, {10700.107000184385`, 6.894395613721735}, {
         11846.618415143432`, 1.197321831144701}, {12801.119251696677`, 
         9.554501404975854}, {13525.317118706373`, 18.05522917390289}, {
         14001.51511359666, 26.562186228975293`}, {14235.52207405325, 
         34.937407652284485`}, {14252.709809589494`, 43.056614707518854`}, {
         14089.572922868045`, 50.819246811985366`}, {13784.872396258312`, 
         58.1526533520537}, {13373.442530632223`, 65.01127072303228}, {
         12883.527078807332`, 71.37286978796682}, {12336.868527677081`, 
         77.23373555415996}, {11750.189975773801`, 82.60401403381134}, {
         11136.938477336933`, 87.50370682953722}, {10508.657852269165`, 
         91.95936655367541}, {9875.812998016188, 96.00139886350489}, {
         9248.160292029635, 99.66186828510547}, {8634.85076028202, 
         102.97275402196541`}, {8044.427906012914, 105.964637180004}, {
         7484.814225964446, 108.66580079097423`}, {6963.314268611896, 
         111.10171400176358`}, {6486.621350664586, 113.29485377579155`}, {
         6060.80042811278, 115.26480325349142`}, {5691.224359075729, 
         117.02855520336817`}, {5382.455599727601, 118.60096084622496`}, {
         5138.087034990045, 119.99521203677855`}, {4960.567660547293, 
         121.22333816873089`}, {4851.052946428079, 122.2966088150576}, {
         4809.315247469241, 123.22581736604812`}, {4833.740125904398, 
         124.02140623484168`}, {4921.415043749473, 124.6934280289905}, {
         5068.296482075305, 125.251356189606}, {5269.4250420104545`, 
         125.70377625225294`}, {5519.150099189974, 126.05799940078674`}, {
         5811.32735917215, 126.31964196403392`}, {6139.462619796554, 
         126.49221548141061`}, {6496.78863451347, 126.57673112787232`}, {
         6876.281453734495, 126.5714340262525}, {7270.631947315939, 
         126.47156388125995`}, {7672.207400750055, 126.26927303251755`}, {
         8073.045244027405, 125.95369130091728`}, {8464.927534931205, 
         125.51117119323813`}, {8839.583604763182, 124.9257385316729}, {
         9189.054540879195, 124.17973834568981`}, {9506.231189277807, 
         123.25469970064103`}, {9785.53148310694, 122.13233780401765`}, {
         10023.634159607449`, 120.795574128968}, {10220.149786644919`, 
         119.22954264420825`}, {10378.065985577401`, 117.42225780454253`}, {
         10503.850285698749`, 115.3650392564894}, {10607.1078781181, 
         113.05239173812322`}, {10699.812213412652`, 110.48158473356476`}, {
         10795.156847764929`, 107.65173156330602`}, {10906.188012798155`, 
         104.56277622416303`}, {11044.363640967966`, 101.21437478367265`}, {
         11218.21237754371, 97.60495138172686}, {11432.239343090609`, 
         93.73107103034813}, {11686.203984393846`, 89.58727886966665}, {
         11974.861270496629`, 85.16649659609813}, {12288.222147122977`, 
         80.46106014195762}, {12612.32690625187, 75.46432777732765}, {
         12930.456677344766`, 70.17270103318693}, {13224.65748833336, 
         64.58789459396374}, {13477.368834836718`, 58.71903562489221}, {
         13672.933937886248`, 52.5843282188453}, {13798.784617153151`, 
         46.21190281893842}, {13846.126170865109`, 39.639714946985215`}, {
         13810.061047685223`, 32.91454062287829}, {13689.178308658988`, 
         26.09006506460973}, {13484.750079983793`, 19.224536230713337`}, {
         13199.738102309444`, 12.37820250051399}, {12837.820368124541`, 
         5.610827597065776}, {12402.64123139508, 1.0204886731239646`}, {
         11897.40433416813, 7.463160061224693}, {11324.852426663021`, 
         13.670557360538533`}, {10687.597933858322`, 19.60316258263576}, {
         9988.695582219329, 25.229430510116057`}, {9232.312638326473, 
         30.526347375177124`}, {8424.324237746412, 35.47967770506472}, {
         7572.714154993085, 40.083822580520895`}, {6687.668682595997, 
         44.341233831734016`}, {5781.341233720843, 48.261439928045675`}, {
         4867.31842481642, 51.85968770812796}, {3959.8723728660652`, 
         55.15536318179102}, {3073.102436175942, 58.170352228300644`}, {
         2220.1036541235976`, 60.92748223939348}, {1412.2496306619523`, 
         63.44920415081071}, {658.6679222828174, 65.75656140587014}, {
         34.04441398889772, 67.86854160730272}, {661.888418827985, 
         69.8017164691496}, {1223.3248518859025`, 71.5701636255707}, {
         1718.9886921138227`, 73.18558009766313}, {2151.307995992558, 
         74.6575266682572}, {2524.082053908426, 75.99373407736039}, {
         2842.061427343825, 77.20042008940295}, {3110.5618875834325`, 
         78.28258776753552}, {3335.1283831230394`, 79.24429359741337}, {
         3521.2656881311764`, 80.08886525180053}, {3674.2257357635867`, 
         80.8190806537618}, {3798.855843472675, 81.43731132034415}, {
         3899.496114072245, 81.94563210175146}, {3979.9195314757467`, 
         82.3459087930398}, {4043.3062148952504`, 82.63986708543001}, {
         4092.244587691975, 82.82914940790145}, {4128.753929612724, 
         82.91536117292954}, {4154.3226191566655`, 82.90010973694777}, {
         4169.957705170713, 82.78504354363737}, {4176.243631724042, 
         82.57188125072913}, {4173.406682263697, 82.26243655773264}, {
         4161.382235349143, 81.85864318117211}, {4139.883202713809, 
         81.36257360066386}, {4108.467666042618, 80.77645169229537}, {
         4066.6037472643993`, 80.10266190741702}, {4013.7301414026574`, 
         79.34375143716389}, {3949.3107523446033`, 78.50242678659231}, {
         3872.8822107910355`, 77.58154337298855}, {3784.0933538606755`, 
         76.58408923183033}, {3682.7360054556707`, 75.51316289473974}, {
         3568.7667917938957`, 74.37194568051758}, {3442.3201528762083`, 
         73.16366991874968}, {0, 71.89158464916869}}]}, 
     Frame -> {{True, True}, {True, True}}, FrameLabel -> {{
        FormBox["\"Speed (rpm)\"", TraditionalForm], 
        FormBox["\"Duty Cycle (%)\"", TraditionalForm]}, {
        FormBox["\"Torque (mNm)\"", TraditionalForm], 
        FormBox["\"Current (A)\"", TraditionalForm]}}, 
     FrameTicks -> {{Automatic, {{40.71086534290774, 
          FormBox["10", TraditionalForm]}, {124.84840926533343`, 
          FormBox["20", TraditionalForm]}, {180.37216953414992`, 
          FormBox["30", TraditionalForm]}, {224.1326050927042, 
          FormBox["40", TraditionalForm]}, {261.224911024109, 
          FormBox["50", TraditionalForm]}, {293.92574876799756`, 
          FormBox["60", TraditionalForm]}, {323.469387107115, 
          FormBox["70", TraditionalForm]}, {350.60864557283963`, 
          FormBox["80", TraditionalForm]}, {375.8408171965254, 
          FormBox["90", TraditionalForm]}, {399.51390599999996`, 
          FormBox["100", TraditionalForm]}}}, {
       Automatic, Charting`ScaledFrameTicks[
         (Join[
          Map[{#, Null}& , 
           FindDivisions[{#, #2}, 50]], 
          Map[{#, 
            NumberForm[
             N[(#/$CellContext`km)/10], {5, 1}]}& , 
           FindDivisions[{#, #2}, 10]]]& )[
          SlotSequence[1]], {Identity, Identity}]& }}, 
     GridLines -> {None, None}, GridLinesStyle -> Directive[
       GrayLevel[0.5, 0.4]], ImageSize -> Full, 
     Method -> {
      "DefaultBoundaryStyle" -> Automatic, "ScalingFunctions" -> None, 
       "AxesInFront" -> True}, 
     PlotRange -> {{0, 41800}, {-0.9399912134693409, 884.4691282405128}}, 
     PlotRangeClipping -> True, PlotRangePadding -> {{
        Scaled[0.02], 
        Scaled[0.02]}, {
        Scaled[0.05], 
        Scaled[0.05]}}, Ticks -> {Automatic, Automatic}}],FormBox[
    FormBox[
     TemplateBox[{
      "\"Speed-Torque Curve at Vnom\"", "\"Continuous Operation\"", 
       "\"Dangerous Operation\""}, "LineLegend", DisplayFunction -> (FormBox[
        StyleBox[
         StyleBox[
          PaneBox[
           TagBox[
            GridBox[{{
               TagBox[
                GridBox[{{
                   GraphicsBox[{{
                    Directive[
                    EdgeForm[
                    Directive[
                    Opacity[0.3], 
                    GrayLevel[0]]], 
                    PointSize[0.5], 
                    Opacity[1.], 
                    AbsoluteThickness[1.6], 
                    Thickness[Large], 
                    RGBColor[0, 0, 1]], {
                    LineBox[{{0, 10}, {20, 10}}]}}, {
                    Directive[
                    EdgeForm[
                    Directive[
                    Opacity[0.3], 
                    GrayLevel[0]]], 
                    PointSize[0.5], 
                    Opacity[1.], 
                    AbsoluteThickness[1.6], 
                    Thickness[Large], 
                    RGBColor[0, 0, 1]], {}}}, AspectRatio -> Full, 
                    ImageSize -> {20, 10}, PlotRangePadding -> None, 
                    ImagePadding -> Automatic, 
                    BaselinePosition -> (Scaled[0.1] -> Baseline)], #, 
                   GraphicsBox[{{
                    Directive[
                    EdgeForm[
                    Directive[
                    Opacity[0.3], 
                    GrayLevel[0]]], 
                    PointSize[0.5], 
                    Opacity[1.], 
                    AbsoluteThickness[1.6], 
                    Thickness[Large], 
                    RGBColor[1, 0, 0]], {
                    LineBox[{{0, 10}, {20, 10}}]}}, {
                    Directive[
                    EdgeForm[
                    Directive[
                    Opacity[0.3], 
                    GrayLevel[0]]], 
                    PointSize[0.5], 
                    Opacity[1.], 
                    AbsoluteThickness[1.6], 
                    Thickness[Large], 
                    RGBColor[1, 0, 0]], {}}}, AspectRatio -> Full, 
                    ImageSize -> {20, 10}, PlotRangePadding -> None, 
                    ImagePadding -> Automatic, 
                    BaselinePosition -> (Scaled[0.1] -> Baseline)], #2}}, 
                 GridBoxAlignment -> {
                  "Columns" -> {Center, Left}, "Rows" -> {{Baseline}}}, 
                 AutoDelete -> False, 
                 GridBoxDividers -> {
                  "Columns" -> {{False}}, "Rows" -> {{False}}}, 
                 GridBoxItemSize -> {"Columns" -> {{All}}, "Rows" -> {{All}}},
                  GridBoxSpacings -> {"Columns" -> {{0.8, 0.5}}}], "Grid"]}, {
              
               TagBox[
                GridBox[{{
                   GraphicsBox[{{
                    Directive[
                    EdgeForm[
                    Directive[
                    Opacity[0.3], 
                    GrayLevel[0]]], 
                    PointSize[0.5], 
                    Opacity[1.], 
                    AbsoluteThickness[1.6], 
                    Thickness[Large], 
                    GrayLevel[0.5]], {
                    LineBox[{{0, 10}, {20, 10}}]}}, {
                    Directive[
                    EdgeForm[
                    Directive[
                    Opacity[0.3], 
                    GrayLevel[0]]], 
                    PointSize[0.5], 
                    Opacity[1.], 
                    AbsoluteThickness[1.6], 
                    Thickness[Large], 
                    GrayLevel[0.5]], {}}}, AspectRatio -> Full, 
                    ImageSize -> {20, 10}, PlotRangePadding -> None, 
                    ImagePadding -> Automatic, 
                    BaselinePosition -> (Scaled[0.1] -> Baseline)], #3}}, 
                 GridBoxAlignment -> {
                  "Columns" -> {Center, Left}, "Rows" -> {{Baseline}}}, 
                 AutoDelete -> False, 
                 GridBoxDividers -> {
                  "Columns" -> {{False}}, "Rows" -> {{False}}}, 
                 GridBoxItemSize -> {"Columns" -> {{All}}, "Rows" -> {{All}}},
                  GridBoxSpacings -> {"Columns" -> {{0.8, 0.5}}}], "Grid"]}}, 
             GridBoxAlignment -> {"Columns" -> {{Left}}, "Rows" -> {{Top}}}, 
             AutoDelete -> False, 
             GridBoxDividers -> {"Columns" -> {{None}}, "Rows" -> {{None}}}, 
             GridBoxItemSize -> {"Columns" -> {{All}}, "Rows" -> {{All}}}, 
             GridBoxSpacings -> {"Columns" -> {{0}}, "Rows" -> {{1}}}], 
            "Grid"], Alignment -> Left, AppearanceElements -> None, 
           ImageMargins -> {{5, 5}, {5, 5}}, ImageSizeAction -> 
           "ResizeToFit"], LineIndent -> 0, StripOnInput -> False], {
         FontFamily -> "Arial"}, Background -> Automatic, StripOnInput -> 
         False], TraditionalForm]& ), 
      InterpretationFunction :> (RowBox[{"LineLegend", "[", 
         RowBox[{
           RowBox[{"{", 
             RowBox[{
               RowBox[{"Directive", "[", 
                 RowBox[{
                   RowBox[{"Opacity", "[", "1.`", "]"}], ",", 
                   RowBox[{"AbsoluteThickness", "[", "1.6`", "]"}], ",", 
                   RowBox[{"Thickness", "[", "Large", "]"}], ",", 
                   InterpretationBox[
                    ButtonBox[
                    TooltipBox[
                    RowBox[{
                    GraphicsBox[{{
                    GrayLevel[0], 
                    RectangleBox[{0, 0}]}, {
                    GrayLevel[0], 
                    RectangleBox[{1, -1}]}, {
                    RGBColor[0, 0, 1], 
                    RectangleBox[{0, -1}, {2, 1}]}}, AspectRatio -> 1, Frame -> 
                    True, FrameStyle -> RGBColor[0., 0., 0.6666666666666666], 
                    FrameTicks -> None, PlotRangePadding -> None, ImageSize -> 
                    Dynamic[{
                    Automatic, 1.35 CurrentValue["FontCapHeight"]/
                    AbsoluteCurrentValue[Magnification]}]], 
                    "\[InvisibleSpace]"}], "RGBColor[0, 0, 1]"], Appearance -> 
                    None, BaseStyle -> {}, BaselinePosition -> Baseline, 
                    DefaultBaseStyle -> {}, ButtonFunction :> 
                    With[{Typeset`box$ = EvaluationBox[]}, 
                    If[
                    Not[
                    AbsoluteCurrentValue["Deployed"]], 
                    SelectionMove[Typeset`box$, All, Expression]; 
                    FrontEnd`Private`$ColorSelectorInitialAlpha = 1; 
                    FrontEnd`Private`$ColorSelectorInitialColor = 
                    RGBColor[0, 0, 1]; 
                    FrontEnd`Private`$ColorSelectorUseMakeBoxes = True; 
                    MathLink`CallFrontEnd[
                    FrontEnd`AttachCell[Typeset`box$, 
                    FrontEndResource["RGBColorValueSelector"], {
                    0, {Left, Bottom}}, {Left, Top}, 
                    "ClosingActions" -> {
                    "SelectionDeparture", "ParentChanged", 
                    "EvaluatorQuit"}]]]], BaseStyle -> Inherited, Evaluator -> 
                    Automatic, Method -> "Preemptive"], 
                    RGBColor[0, 0, 1], Editable -> False, Selectable -> 
                    False]}], "]"}], ",", 
               RowBox[{"Directive", "[", 
                 RowBox[{
                   RowBox[{"Opacity", "[", "1.`", "]"}], ",", 
                   RowBox[{"AbsoluteThickness", "[", "1.6`", "]"}], ",", 
                   RowBox[{"Thickness", "[", "Large", "]"}], ",", 
                   InterpretationBox[
                    ButtonBox[
                    TooltipBox[
                    RowBox[{
                    GraphicsBox[{{
                    GrayLevel[0], 
                    RectangleBox[{0, 0}]}, {
                    GrayLevel[0], 
                    RectangleBox[{1, -1}]}, {
                    RGBColor[1, 0, 0], 
                    RectangleBox[{0, -1}, {2, 1}]}}, AspectRatio -> 1, Frame -> 
                    True, FrameStyle -> RGBColor[0.6666666666666666, 0., 0.], 
                    FrameTicks -> None, PlotRangePadding -> None, ImageSize -> 
                    Dynamic[{
                    Automatic, 1.35 CurrentValue["FontCapHeight"]/
                    AbsoluteCurrentValue[Magnification]}]], 
                    "\[InvisibleSpace]"}], "RGBColor[1, 0, 0]"], Appearance -> 
                    None, BaseStyle -> {}, BaselinePosition -> Baseline, 
                    DefaultBaseStyle -> {}, ButtonFunction :> 
                    With[{Typeset`box$ = EvaluationBox[]}, 
                    If[
                    Not[
                    AbsoluteCurrentValue["Deployed"]], 
                    SelectionMove[Typeset`box$, All, Expression]; 
                    FrontEnd`Private`$ColorSelectorInitialAlpha = 1; 
                    FrontEnd`Private`$ColorSelectorInitialColor = 
                    RGBColor[1, 0, 0]; 
                    FrontEnd`Private`$ColorSelectorUseMakeBoxes = True; 
                    MathLink`CallFrontEnd[
                    FrontEnd`AttachCell[Typeset`box$, 
                    FrontEndResource["RGBColorValueSelector"], {
                    0, {Left, Bottom}}, {Left, Top}, 
                    "ClosingActions" -> {
                    "SelectionDeparture", "ParentChanged", 
                    "EvaluatorQuit"}]]]], BaseStyle -> Inherited, Evaluator -> 
                    Automatic, Method -> "Preemptive"], 
                    RGBColor[1, 0, 0], Editable -> False, Selectable -> 
                    False]}], "]"}], ",", 
               RowBox[{"Directive", "[", 
                 RowBox[{
                   RowBox[{"Opacity", "[", "1.`", "]"}], ",", 
                   RowBox[{"AbsoluteThickness", "[", "1.6`", "]"}], ",", 
                   RowBox[{"Thickness", "[", "Large", "]"}], ",", 
                   InterpretationBox[
                    ButtonBox[
                    TooltipBox[
                    RowBox[{
                    GraphicsBox[{{
                    GrayLevel[0], 
                    RectangleBox[{0, 0}]}, {
                    GrayLevel[0], 
                    RectangleBox[{1, -1}]}, {
                    GrayLevel[0.5], 
                    RectangleBox[{0, -1}, {2, 1}]}}, AspectRatio -> 1, Frame -> 
                    True, FrameStyle -> GrayLevel[0.33333333333333337`], 
                    FrameTicks -> None, PlotRangePadding -> None, ImageSize -> 
                    Dynamic[{
                    Automatic, 1.35 CurrentValue["FontCapHeight"]/
                    AbsoluteCurrentValue[Magnification]}]], 
                    "\[InvisibleSpace]"}], "GrayLevel[0.5]"], Appearance -> 
                    None, BaseStyle -> {}, BaselinePosition -> Baseline, 
                    DefaultBaseStyle -> {}, ButtonFunction :> 
                    With[{Typeset`box$ = EvaluationBox[]}, 
                    If[
                    Not[
                    AbsoluteCurrentValue["Deployed"]], 
                    SelectionMove[Typeset`box$, All, Expression]; 
                    FrontEnd`Private`$ColorSelectorInitialAlpha = 1; 
                    FrontEnd`Private`$ColorSelectorInitialColor = 
                    GrayLevel[0.5]; 
                    FrontEnd`Private`$ColorSelectorUseMakeBoxes = True; 
                    MathLink`CallFrontEnd[
                    FrontEnd`AttachCell[Typeset`box$, 
                    FrontEndResource["GrayLevelColorValueSelector"], {
                    0, {Left, Bottom}}, {Left, Top}, 
                    "ClosingActions" -> {
                    "SelectionDeparture", "ParentChanged", 
                    "EvaluatorQuit"}]]]], BaseStyle -> Inherited, Evaluator -> 
                    Automatic, Method -> "Preemptive"], 
                    GrayLevel[0.5], Editable -> False, Selectable -> False]}],
                  "]"}]}], "}"}], ",", 
           RowBox[{"{", 
             RowBox[{#, ",", #2, ",", #3}], "}"}], ",", 
           RowBox[{"LegendMarkers", "\[Rule]", "None"}], ",", 
           RowBox[{"LabelStyle", "\[Rule]", 
             RowBox[{"{", "}"}]}], ",", 
           RowBox[{"LegendLayout", "\[Rule]", "\"Row\""}]}], "]"}]& ), 
      Editable -> True], TraditionalForm], TraditionalForm]},
  "Legended",
  DisplayFunction->(GridBox[{{
      ItemBox[#2, DefaultBaseStyle -> "LabeledLabel"]}, {
      TagBox[
       ItemBox[
        PaneBox[
         TagBox[#, "SkipImageSizeLevel"], Alignment -> {Center, Baseline}, 
         BaselinePosition -> Baseline], DefaultBaseStyle -> "Labeled"], 
       "SkipImageSizeLevel"]}}, 
    GridBoxAlignment -> {"Columns" -> {{Center}}, "Rows" -> {{Center}}}, 
    AutoDelete -> False, GridBoxItemSize -> Automatic, 
    BaselinePosition -> {2, 1}]& ),
  Editable->True,
  InterpretationFunction->(RowBox[{"Legended", "[", 
     RowBox[{#, ",", 
       RowBox[{"Placed", "[", 
         RowBox[{#2, ",", "Above"}], "]"}]}], "]"}]& )]], "Output",
 CellChangeTimes->{{3.631447122890318*^9, 3.631447168484761*^9}}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Pcom", "[", "q_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"m1", " ", 
       RowBox[{"GibbotQnts`Private`P1", "[", "q", "]"}]}], " ", "+", " ", 
      RowBox[{"m2", " ", 
       RowBox[{"GibbotQnts`Private`P2", "[", "q", "]"}]}]}], ")"}], "/", 
    RowBox[{"(", 
     RowBox[{"m1", "+", "m2"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Vcom", "[", 
    RowBox[{"q_", ",", " ", "qd_"}], "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"GibbotQnts`Private`dPcom", "[", 
     RowBox[{"mag", ",", " ", "q"}], "]"}], ".", "qd"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.629759403686988*^9, 3.629759421017277*^9}, {
  3.6297594568632455`*^9, 3.6297595772399006`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dx", " ", "=", " ", 
   RowBox[{"2", "L1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dy", " ", "=", " ", "L1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"mag", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"x", " ", "=", " ", 
  RowBox[{"MinimizeFreeFlight", "[", 
   RowBox[{"mag", ",", " ", "dx", ",", " ", "dy"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"u", " ", "=", " ", 
   RowBox[{"0", "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"m2", " ", "g", " ", "r2"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "q", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mag", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t", " ", "=", " ", 
   RowBox[{"2", 
    RowBox[{
     RowBox[{"Sqrt", "[", 
      RowBox[{"2", "g", " ", "dy"}], "]"}], "/", "g"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"q", " ", "=", " ", 
    RowBox[{"q", "/.", 
     RowBox[{"First", "@", 
      RowBox[{"NDSolve", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"q", "''"}], "[", "s", "]"}], " ", "\[Equal]", " ", 
           RowBox[{"f", "[", 
            RowBox[{"s", ",", " ", 
             RowBox[{"q", "[", "s", "]"}], ",", " ", 
             RowBox[{
              RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"q", "[", "0", "]"}], " ", "\[Equal]", " ", 
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", "4"}], "\[RightDoubleBracket]"}]}], ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"q", "'"}], "[", "0", "]"}], " ", "\[Equal]", " ", 
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}]}], 
         "\[IndentingNewLine]", "}"}], ",", " ", "\[IndentingNewLine]", "q", 
        ",", " ", 
        RowBox[{"{", 
         RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}]}], 
       "\[IndentingNewLine]", "]"}]}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"t", " ", "=", " ", 
    RowBox[{
     RowBox[{"q", "[", "\"\<Domain\>\"", "]"}], "\[LeftDoubleBracket]", 
     RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Animate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"DrawGibbot", "[", 
      RowBox[{"mag", ",", " ", 
       RowBox[{"q", "[", "s", "]"}], ",", " ", 
       RowBox[{"PlotRange", "\[Rule]", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", 
              RowBox[{"(", 
               RowBox[{"L1", "+", "L2"}], ")"}]}], "/", "2"}], ",", " ", 
            RowBox[{"3", "dx"}]}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"(", 
              RowBox[{"L1", "+", "L2"}], ")"}]}], ",", " ", 
            RowBox[{"2", "dy"}]}], "}"}]}], "}"}]}], ",", " ", 
       RowBox[{"Epilog", "\[Rule]", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"PointSize", "[", "Large", "]"}], ",", " ", 
          RowBox[{"Point", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"dx", ",", " ", "dy"}], "}"}], "+", 
            RowBox[{"Pcom", "[", 
             RowBox[{"q", "[", "0", "]"}], "]"}]}], "]"}], ",", " ", "Blue", 
          ",", " ", 
          RowBox[{"Point", "[", 
           RowBox[{"Pcom", "[", 
            RowBox[{"q", "[", "s", "]"}], "]"}], "]"}]}], "}"}]}]}], "]"}], 
     ",", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"s", " ", ">", " ", "0"}], ",", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "ParametricPlot", " ", "is", " ", "a", " ", "whiny", " ", "little", 
         " ", "function"}], " ", "*)"}], 
       RowBox[{"Quiet", "@", 
        RowBox[{"ParametricPlot", "[", 
         RowBox[{
          RowBox[{"Pcom", "[", 
           RowBox[{"q", "[", "a", "]"}], "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"a", ",", " ", "0", ",", " ", "s"}], "}"}]}], "]"}]}], ",",
        " ", 
       RowBox[{"Graphics", "[", 
        RowBox[{"{", "}"}], "]"}]}], "]"}]}], "]"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}], ",", " ", 
   RowBox[{"AnimationRepetitions", "\[Rule]", "1"}]}], "]"}]}], "Input",
 CellChangeTimes->{
  3.6297547080228567`*^9, {3.6297548087273216`*^9, 3.6297548569779625`*^9}, {
   3.6297550733112416`*^9, 3.6297550741788635`*^9}, {3.6297551513407*^9, 
   3.629755270116463*^9}, {3.6297553314453526`*^9, 3.629755341883042*^9}, {
   3.629755377711646*^9, 3.6297554055869646`*^9}, {3.6297554539938574`*^9, 
   3.629755456493913*^9}, {3.629756535910117*^9, 3.6297565477540283`*^9}, 
   3.629756579660703*^9, {3.6297566140049133`*^9, 3.62975662509886*^9}, {
   3.6297566775682564`*^9, 3.6297566789276705`*^9}, {3.629756758788105*^9, 
   3.6297567638350496`*^9}, {3.6297568463673735`*^9, 
   3.6297569684158964`*^9}, {3.6297581472892766`*^9, 3.6297581484767923`*^9}, 
   3.62975821204011*^9, {3.6297582629627185`*^9, 3.629758304369521*^9}, {
   3.629758340807506*^9, 3.6297583433700104`*^9}, {3.629758440121299*^9, 
   3.629758446090128*^9}, {3.6297595869118986`*^9, 3.629759597927641*^9}, {
   3.6297597010071173`*^9, 3.629759738210757*^9}, {3.6297598346026955`*^9, 
   3.6297598530091605`*^9}, {3.6297598893846436`*^9, 3.62975990654115*^9}, {
   3.629759984198405*^9, 3.6297600194644794`*^9}, {3.629760110215736*^9, 
   3.6297601822224298`*^9}, {3.6297603037709*^9, 3.6297603050053444`*^9}, {
   3.629760359131014*^9, 3.6297603610685916`*^9}, {3.6297606044611297`*^9, 
   3.629760616955988*^9}, {3.629760817445223*^9, 3.6297608618357506`*^9}, {
   3.6297608996018476`*^9, 3.6297609374305058`*^9}, {3.6297609847279882`*^9, 
   3.629761110792143*^9}, {3.6297612101841364`*^9, 3.6297614026397905`*^9}, 
   3.629761461515573*^9, {3.6297615035161324`*^9, 3.629761536141597*^9}, {
   3.629761572407709*^9, 3.629761645986807*^9}, {3.6297620785550327`*^9, 
   3.6297620787581906`*^9}, {3.6297621579623384`*^9, 3.629762173962552*^9}, 
   3.6297660185077815`*^9, 3.6312907599247556`*^9, 3.6312908062691383`*^9}],

Cell[BoxData[
 RowBox[{"Max", "@", 
  RowBox[{"Flatten", "@", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Max", "@", 
      RowBox[{"Abs", "@", 
       RowBox[{"DynamicQnts", "[", 
        RowBox[{"1", ",", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "th1", ",", " ", "th2"}], "}"}], ",", 
           " ", 
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}], "]"}], ",",
          " ", 
         RowBox[{"0", " ", 
          RowBox[{"u", "[", 
           RowBox[{"0", ",", " ", "x"}], "]"}]}]}], "]"}]}]}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"th1", ",", " ", 
       RowBox[{"-", "\[Pi]"}], ",", " ", "\[Pi]", ",", " ", 
       RowBox[{"1", "/", "100"}]}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"th2", ",", " ", 
       RowBox[{"-", "\[Pi]"}], ",", " ", "\[Pi]", ",", " ", 
       RowBox[{"1", "/", "100"}]}], "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.6312908168474097`*^9, 3.631290875910774*^9}, {
  3.6312960450401435`*^9, 3.6312961772919545`*^9}, {3.631297704437852*^9, 
  3.631297718453648*^9}, {3.6312978768247223`*^9, 3.6312978876998134`*^9}}],

Cell[BoxData[
 RowBox[{"374", " ", "N2lbf"}]], "Input",
 CellChangeTimes->{{3.6312978380428925`*^9, 3.6312978601682267`*^9}, {
  3.631302176392915*^9, 3.6313021768772907`*^9}}],

Cell[BoxData[{
 RowBox[{"q", "[", "0", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"q", "'"}], "[", "0", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Pcom", "[", 
  RowBox[{"q", "[", "0", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Vcom", "[", 
  RowBox[{
   RowBox[{"q", "[", "0", "]"}], ",", " ", 
   RowBox[{
    RowBox[{"q", "'"}], "[", "0", "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.6297660830555153`*^9, 3.629766118571644*^9}, {
  3.6297661751660995`*^9, 3.6297661901819706`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ImpactQnts", "[", 
   RowBox[{"1", ",", " ", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"q", "[", "t", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"q", "'"}], "[", "t", "]"}]}], "]"}]}], "]"}], " ", "//", " ", 
  "Chop"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ImpactQnts", "[", 
    RowBox[{"2", ",", " ", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"q", "[", "t", "]"}], ",", " ", 
       RowBox[{
        RowBox[{"q", "'"}], "[", "t", "]"}]}], "]"}]}], "]"}], " ", "//", " ",
    "Chop"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ImpactQnts", "[", 
   RowBox[{"1", ",", " ", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"q", "[", 
       RowBox[{"t", "/", "2"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{"q", "'"}], "[", 
       RowBox[{"t", "/", "2"}], "]"}]}], "]"}]}], "]"}], " ", "//", " ", 
  "Chop"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ImpactQnts", "[", 
   RowBox[{"2", ",", " ", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"q", "[", 
       RowBox[{"t", "/", "2"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{"q", "'"}], "[", 
       RowBox[{"t", "/", "2"}], "]"}]}], "]"}]}], "]"}], " ", "//", " ", 
  "Chop"}]}], "Input",
 CellChangeTimes->{{3.629761784269868*^9, 3.629761786926182*^9}, {
  3.6297618473644867`*^9, 3.6297618868806367`*^9}, {3.6297621101804843`*^9, 
  3.629762125274433*^9}}],

Cell[BoxData[
 RowBox[{"TE", "@", "x"}]], "Input",
 CellChangeTimes->{{3.629764462898757*^9, 3.629764466617585*^9}}],

Cell[BoxData[
 RowBox[{"m2", " ", "r2", " ", "g"}]], "Input",
 CellChangeTimes->{{3.629851442247698*^9, 3.6298514433925123`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Specs-old", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.6289934659285192`*^9, 3.6289934886106005`*^9}, {3.629138508061183*^9, 
  3.629138516540187*^9}, {3.6296722233016214`*^9, 3.6296722236766243`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mag", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dx", " ", "=", " ", 
   RowBox[{"2", "L1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dy", " ", "=", " ", "L1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x", " ", "=", " ", 
   RowBox[{
    RowBox[{"MinimizeFreeFlight", "[", 
     RowBox[{"mag", ",", " ", "dx", ",", " ", "dy"}], "]"}], " ", "//", " ", 
    "Chop"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"m2", " ", "g", " ", "r2"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"K", " ", "=", " ", 
    RowBox[{"Flatten", "@", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\[Theta]", ",", " ", "x", ",", " ", "x1", ",", "x2", ",", "x3", ",", 
         "x4", ",", "x5", ",", "x6", ",", "x7", ",", "x8", ",", " ", "u", ",",
          " ", "rep", ",", " ", "A", ",", " ", "B"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"x", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{
          "0", ",", "0", ",", "x3", ",", "x4", ",", "0", ",", "0", ",", "x7", 
           ",", "x8"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"x", "\[LeftDoubleBracket]", 
          RowBox[{"5", ";;", "6"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
         RowBox[{"-", 
          RowBox[{
           RowBox[{
            RowBox[{"GibbotQnts`Private`J1", "[", "x", "]"}], 
            "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ".", 
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"x", "\[LeftDoubleBracket]", 
          RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
         RowBox[{"-", 
          RowBox[{"GibbotQnts`Private`P3", "[", "x", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rep", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x3", "\[Rule]", " ", "\[Pi]"}], ",", " ", 
           RowBox[{"x4", "\[Rule]", " ", "\[Pi]"}], ",", " ", 
           RowBox[{"x7", "\[Rule]", " ", "0"}], ",", " ", 
           RowBox[{"x8", "\[Rule]", " ", "0"}], ",", " ", 
           RowBox[{"u", "\[Rule]", " ", "0"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Theta]", " ", "=", " ", 
         RowBox[{"x", "\[LeftDoubleBracket]", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4", ",", "7", ",", "8"}], "}"}], 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"x", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"First", "@", 
            RowBox[{"DynamicQnts", "[", 
             RowBox[{"mag", ",", " ", "x", ",", " ", "u"}], "]"}]}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"A", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"x", ",", " ", 
              RowBox[{"{", "\[Theta]", "}"}]}], "]"}], "/.", " ", "rep"}], 
           " ", "//", " ", "Simplify"}], " ", "//", " ", "Chop"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"B", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"x", ",", " ", 
              RowBox[{"{", "u", "}"}]}], "]"}], "/.", " ", "rep"}], " ", "//",
            " ", "Simplify"}], " ", "//", " ", "Chop"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"x", " ", "=", " ", 
         RowBox[{"StateSpaceModel", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"A", "\[LeftDoubleBracket]", 
             RowBox[{"{", 
              RowBox[{"3", ",", "4", ",", "7", ",", "8"}], "}"}], 
             "\[RightDoubleBracket]"}], ",", " ", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"B", "\[LeftDoubleBracket]", 
               RowBox[{"{", 
                RowBox[{"3", ",", "4", ",", "7", ",", "8"}], "}"}], 
               "\[RightDoubleBracket]"}], "}"}], "\[Transpose]"}], ",", " ", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{"0", ",", " ", 
              RowBox[{"{", 
               RowBox[{"1", ",", "4"}], "}"}]}], "]"}]}], "}"}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"LQRegulatorGains", "[", 
         RowBox[{"x", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"IdentityMatrix", "[", "4", "]"}], ",", " ", 
            RowBox[{"IdentityMatrix", "[", "1", "]"}]}], "}"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pump", " ", "=", " ", "True"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"x_", ",", " ", "kp_", ",", " ", "kd_"}], "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"kp", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"72", "Degree", "  ", 
         RowBox[{"ArcTan", "[", 
          RowBox[{"x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}],
           "]"}]}], " ", "-", " ", 
        RowBox[{"x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}],
        ")"}]}], " ", "-", " ", 
     RowBox[{"kd", " ", 
      RowBox[{
      "x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}]}]}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"x_", ",", " ", "kp_", ",", " ", "kd_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"kp", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"\[Pi]", "/", "2"}], "-", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
         ")"}]}], ")"}], " ", "+", " ", 
      RowBox[{"kd", " ", 
       RowBox[{"(", 
        RowBox[{"0", "-", 
         RowBox[{
         "x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], 
        ")"}]}]}]}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"u", "[", 
     RowBox[{"t_", ",", " ", "x_", ",", " ", 
      RowBox[{"kp_:", "0"}], ",", " ", 
      RowBox[{"kd_:", "0"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"pump", " ", "\[Equal]", " ", "True"}], ",", " ", 
      RowBox[{"MotorInput", "[", 
       RowBox[{"mag", ",", " ", "x", ",", " ", "b", ",", " ", 
        RowBox[{"v", "[", 
         RowBox[{"x", ",", " ", "kp", ",", " ", "kd"}], "]"}]}], "]"}], ",", 
      " ", 
      RowBox[{"-", 
       RowBox[{"K", ".", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"x", "\[LeftDoubleBracket]", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4", ",", "7", ",", "8"}], "}"}], 
           "\[RightDoubleBracket]"}], " ", "-", " ", 
          RowBox[{"{", 
           RowBox[{"\[Pi]", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
         ")"}]}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "verify", " ", "that", " ", "the", " ", "sign", " ", "is", " ", "correct",
      " ", "for", " ", "v"}], ",", " ", 
    RowBox[{"it", " ", "should", " ", "be", " ", "positive"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Chop", "@", 
    RowBox[{"Simplify", "@", 
     RowBox[{"First", "@", 
      RowBox[{"DynamicQnts", "[", 
       RowBox[{"mag", ",", " ", "x", ",", " ", 
        RowBox[{"MotorInput", "[", 
         RowBox[{"mag", ",", " ", "x", ",", " ", "b", ",", " ", "v"}], 
         "]"}]}], "]"}]}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"x", " ", "=", " ", 
    RowBox[{"ConstantArray", "[", 
     RowBox[{"0", ",", " ", "8"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pump", " ", "=", " ", "False"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"x", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}], " ", 
   "=", " ", 
   RowBox[{
    RowBox[{"-", "1"}], "/", "10"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], " ", 
   "=", " ", 
   RowBox[{"0", "\[Pi]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], " ", 
    "=", " ", 
    RowBox[{"0", "\[Pi]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"x", "\[LeftDoubleBracket]", 
     RowBox[{"5", ";;", "6"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{
       RowBox[{"GibbotQnts`Private`J1", "[", "x", "]"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"1", ",", " ", "All", ",", " ", "3"}], 
       "\[RightDoubleBracket]"}]}], " ", 
     RowBox[{"x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "ensure", " ", "that", " ", "constraints", " ", "are", " ", "satisfied"}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Norm", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"GibbotQnts`Private`J1", "[", "x", "]"}], 
      "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ".", 
     RowBox[{"x", "\[LeftDoubleBracket]", 
      RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}], "]"}], " ", 
   "\[Equal]", "  ", "0"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t", " ", "=", " ", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kp", " ", "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kd", " ", "=", " ", "0"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{
     RowBox[{"s_", "?", "NumericQ"}], ",", " ", "q_", ",", " ", "qd_"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "x", "}"}], ",", " ", 
     RowBox[{
      RowBox[{"x", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"q", ",", "qd"}], "]"}]}], ";", " ", 
      RowBox[{"First", "@", 
       RowBox[{"DynamicQnts", "[", 
        RowBox[{"mag", ",", " ", "x", ",", " ", 
         RowBox[{"u", "[", 
          RowBox[{"s", ",", " ", "x", ",", " ", "kp", ",", " ", "kd"}], 
          "]"}]}], "]"}]}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "q", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tsw", " ", "=", " ", "\[Infinity]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"catch", " ", "=", " ", "\[Pi]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"q", " ", "=", " ", 
    RowBox[{"q", "/.", 
     RowBox[{"First", "@", 
      RowBox[{"NDSolve", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"q", "''"}], "[", "s", "]"}], " ", "\[Equal]", " ", 
           RowBox[{"f", "[", 
            RowBox[{"s", ",", " ", 
             RowBox[{"q", "[", "s", "]"}], ",", " ", 
             RowBox[{
              RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], ",", " ", 
          RowBox[{
           RowBox[{"q", "[", "0", "]"}], " ", "\[Equal]", " ", 
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", "4"}], "\[RightDoubleBracket]"}]}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"q", "'"}], "[", "0", "]"}], " ", "\[Equal]", " ", 
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}], ",", " ", 
          RowBox[{"WhenEvent", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}], ".", 
               RowBox[{"q", "[", "s", "]"}]}], "-", "\[Pi]"}], " ", 
             "\[Equal]", " ", "0"}], ",", " ", "\"\<StopIntegration\>\""}], 
           "]"}], ",", " ", 
          RowBox[{"WhenEvent", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}], ".", 
               RowBox[{"q", "[", "s", "]"}]}], "+", "\[Pi]"}], " ", 
             "\[Equal]", " ", "0"}], ",", " ", "\"\<StopIntegration\>\""}], 
           "]"}], ",", " ", "\[IndentingNewLine]", 
          RowBox[{"WhenEvent", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ".", 
               RowBox[{"q", "[", "s", "]"}]}], "-", "catch"}], " ", 
             "\[Equal]", "   ", "0"}], ",", " ", 
            RowBox[{
             RowBox[{"tsw", " ", "=", " ", "s"}], ";", 
             RowBox[{"pump", " ", "=", " ", "False"}], ";", " ", 
             "\"\<RemoveEvent\>\""}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"WhenEvent", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ".", 
               RowBox[{"q", "[", "s", "]"}]}], "+", "catch"}], " ", 
             "\[Equal]", "   ", "0"}], ",", " ", 
            RowBox[{
             RowBox[{"tsw", " ", "=", " ", "s"}], ";", 
             RowBox[{"pump", " ", "=", " ", "False"}], ";", " ", 
             "\"\<RemoveEvent\>\""}]}], "]"}]}], "\[IndentingNewLine]", "}"}],
         ",", " ", "\[IndentingNewLine]", "q", ",", " ", 
        RowBox[{"{", 
         RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}]}], "]"}]}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", "tsw", "\
\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t", " ", "=", " ", 
   RowBox[{
    RowBox[{"q", "[", "\"\<Domain\>\"", "]"}], "\[LeftDoubleBracket]", 
    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Animate", "[", 
  RowBox[{
   RowBox[{"DrawGibbot", "[", 
    RowBox[{"mag", ",", " ", 
     RowBox[{"q", "[", "s", "]"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", " ", 
      RowBox[{"2.5", "L1"}]}]}], "]"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}], ",", " ", 
   RowBox[{"AnimationRepetitions", "\[Rule]", "1"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.629102572344222*^9, 3.629102616246416*^9}, {
   3.629102673889389*^9, 3.6291026757847357`*^9}, {3.629102707932582*^9, 
   3.629102724570407*^9}, {3.629102824212227*^9, 3.6291028515106297`*^9}, {
   3.629103458936345*^9, 3.6291034976568656`*^9}, 3.6291062660494623`*^9, {
   3.6291063315740194`*^9, 3.6291063522276955`*^9}, {3.6291366102133226`*^9, 
   3.6291366107096777`*^9}, 3.629136643988329*^9, {3.6291372660454154`*^9, 
   3.6291372709028816`*^9}, {3.6291383415458364`*^9, 
   3.6291383720585203`*^9}, {3.6291390979924393`*^9, 3.629139147196424*^9}, {
   3.6291391992364035`*^9, 3.629139229192713*^9}, {3.6291765125582294`*^9, 
   3.6291765172865906`*^9}, {3.629177725725466*^9, 3.6291777259075937`*^9}, {
   3.6293282671501536`*^9, 3.6293283058850317`*^9}, 3.6293295170504637`*^9, {
   3.629333934891714*^9, 3.6293339941893797`*^9}, {3.6293340285492115`*^9, 
   3.629334056815211*^9}, {3.6293340977845035`*^9, 3.6293341113471556`*^9}, {
   3.6293341942388697`*^9, 3.6293342335363126`*^9}, {3.6293347332929306`*^9, 
   3.6293347615745897`*^9}, {3.6293348669978657`*^9, 
   3.6293349089514947`*^9}, {3.6293349757805614`*^9, 3.629335033671955*^9}, {
   3.6293351113448687`*^9, 3.629335126798152*^9}, {3.6293359701187935`*^9, 
   3.6293361519805584`*^9}, {3.629337056883222*^9, 3.629337060602053*^9}, {
   3.629337190919478*^9, 3.6293372241542435`*^9}, {3.6293373715468507`*^9, 
   3.62933744793849*^9}, {3.629337537502183*^9, 3.629337579862133*^9}, {
   3.6293377090513124`*^9, 3.629337754317539*^9}, {3.6293378020369825`*^9, 
   3.6293378081464415`*^9}, {3.6293381656043015`*^9, 
   3.6293381689168615`*^9}, {3.6293383144812975`*^9, 
   3.6293383358409615`*^9}, {3.629482338782209*^9, 3.629482339269555*^9}, {
   3.629482444358246*^9, 3.6294824461835413`*^9}, 3.6294824873808217`*^9, {
   3.629482518515935*^9, 3.629482544523435*^9}, {3.629482589869665*^9, 
   3.6294827702617035`*^9}, {3.6294828729826837`*^9, 
   3.6294830743588376`*^9}, {3.629483136168738*^9, 3.6294831596624627`*^9}, {
   3.629484619658128*^9, 3.629484657839264*^9}, {3.6294905539597464`*^9, 
   3.629490557058961*^9}, 3.62949058708829*^9, {3.629490619586402*^9, 
   3.6294906876387568`*^9}, {3.6294907534325457`*^9, 
   3.6294907643873262`*^9}, {3.6294908273130283`*^9, 
   3.6294909984576793`*^9}, {3.629491030280282*^9, 3.6294910308747163`*^9}, {
   3.62949107109732*^9, 3.6294913174063816`*^9}, {3.6294913501066213`*^9, 
   3.62949138210036*^9}, {3.6294949768249083`*^9, 3.6294949769079523`*^9}, {
   3.6294992474005966`*^9, 3.629499278310549*^9}, {3.6294993197410135`*^9, 
   3.6294995141431646`*^9}, {3.6294995676181765`*^9, 
   3.6294996014982367`*^9}, {3.629499706259715*^9, 3.6294997882529964`*^9}, {
   3.6294998252422705`*^9, 3.6294999056494336`*^9}, 3.6294999543610477`*^9, {
   3.6294999939341526`*^9, 3.6294999941363087`*^9}, {3.62950002989371*^9, 
   3.629500035893975*^9}, {3.629500093936256*^9, 3.6295000998454423`*^9}, {
   3.6295003509299088`*^9, 3.6295003542052383`*^9}, {3.6295004409739056`*^9, 
   3.629500602462672*^9}, {3.629500637084278*^9, 3.629500638585352*^9}, 
   3.629500707095046*^9, {3.629500762646514*^9, 3.6295008022266536`*^9}, {
   3.6295008451201468`*^9, 3.629500915922449*^9}, {3.629500964685119*^9, 
   3.629500971789173*^9}, {3.629501006008494*^9, 3.6295010061165705`*^9}, {
   3.6295010904495077`*^9, 3.6295010931694136`*^9}, {3.6295011358807907`*^9, 
   3.6295011367093782`*^9}, {3.6295011864137135`*^9, 3.62950118917267*^9}, 
   3.629501230127781*^9, {3.629501378631328*^9, 3.6295013865279408`*^9}, {
   3.629501466785965*^9, 3.6295014704445553`*^9}, {3.6295016185278296`*^9, 
   3.629501638998379*^9}, 3.629501804837249*^9, {3.629501847519582*^9, 
   3.6295018481520314`*^9}, 3.629502142272071*^9, {3.62950220673889*^9, 
   3.6295022119956264`*^9}, {3.629502253739267*^9, 3.6295022636112833`*^9}, {
   3.629502306982129*^9, 3.6295023685759125`*^9}, {3.62950252145957*^9, 
   3.6295025495044966`*^9}, {3.6295028469919205`*^9, 
   3.6295029064051476`*^9}, {3.6295029408546467`*^9, 3.629502940903672*^9}, {
   3.6295029898114443`*^9, 3.6295030873517656`*^9}, {3.629503123961785*^9, 
   3.629503124027822*^9}, {3.6295031590717387`*^9, 3.629503159793256*^9}, {
   3.629503350772975*^9, 3.6295033636141176`*^9}, {3.6295035176716037`*^9, 
   3.629503525067839*^9}, {3.6295035906644897`*^9, 3.629503592926093*^9}, {
   3.6295036344005737`*^9, 3.629503637666895*^9}, {3.629503669960843*^9, 
   3.6295036736284513`*^9}, {3.629503714210288*^9, 3.6295037147216635`*^9}, 
   3.6295037471807303`*^9, {3.6295038196862593`*^9, 3.62950382032471*^9}, {
   3.629503896529877*^9, 3.6295039204408436`*^9}, {3.6295039549113665`*^9, 
   3.6295039944234457`*^9}, {3.6295040565916367`*^9, 3.629504326487461*^9}, {
   3.629504477708912*^9, 3.629504521959385*^9}, {3.629504626065366*^9, 
   3.629504809708902*^9}, {3.6295048955638933`*^9, 3.629504996104351*^9}, {
   3.6295051237631016`*^9, 3.6295052831273756`*^9}, 3.629505353708537*^9, {
   3.6295054742892237`*^9, 3.629505504706843*^9}, {3.629505542047398*^9, 
   3.6295055869783173`*^9}, {3.629505627147882*^9, 3.6295056331471453`*^9}, {
   3.6295056754702263`*^9, 3.629505682133956*^9}, {3.629505712695676*^9, 
   3.6295059725993996`*^9}, {3.6295061337809553`*^9, 3.629506408491209*^9}, {
   3.6295064409752865`*^9, 3.629506441268502*^9}, {3.629506479055352*^9, 
   3.6295066392591915`*^9}, {3.629506674209052*^9, 3.6295068401189785`*^9}, {
   3.6295069162460833`*^9, 3.629507054118059*^9}, {3.6295070941455235`*^9, 
   3.6295071105391626`*^9}, {3.6295071428661423`*^9, 
   3.6295072191573725`*^9}, {3.629507265107024*^9, 3.6295073623381376`*^9}, {
   3.62950752406207*^9, 3.6295080843752985`*^9}, 3.629508267606538*^9, {
   3.6295083036351376`*^9, 3.6295083423896766`*^9}, {3.629508377506647*^9, 
   3.629508421509922*^9}, {3.629508579062872*^9, 3.6295086209206495`*^9}, {
   3.6295086902809305`*^9, 3.629508837180337*^9}, {3.6295089356713533`*^9, 
   3.6295091214063597`*^9}, {3.6295091823576574`*^9, 3.629509227302618*^9}, {
   3.6295092577452526`*^9, 3.6295092738306885`*^9}, {3.6295093099843817`*^9, 
   3.62950931161654*^9}, {3.6295093534793015`*^9, 3.6295094498808165`*^9}, {
   3.6295094806556883`*^9, 3.6295094915834475`*^9}, {3.629509523024798*^9, 
   3.629509524574897*^9}, {3.6295095637637577`*^9, 3.629509657855632*^9}, {
   3.6295097393805676`*^9, 3.6295097394626245`*^9}, {3.6295097926554313`*^9, 
   3.6295098250824785`*^9}, {3.629509856424752*^9, 3.6295098789767833`*^9}, {
   3.6295099092392974`*^9, 3.6295099093013263`*^9}, {3.629509944009009*^9, 
   3.629509944070038*^9}, {3.6295099756965303`*^9, 3.6295100414052234`*^9}, {
   3.6295100824764147`*^9, 3.6295100825594654`*^9}, {3.6295101147803664`*^9, 
   3.6295101298940945`*^9}, {3.6295101942958965`*^9, 
   3.6295101988231077`*^9}, {3.6295102308008327`*^9, 3.629510243317732*^9}, {
   3.629510285299576*^9, 3.6295104585827255`*^9}, {3.6295104900751114`*^9, 
   3.629510556188098*^9}, {3.62951058988103*^9, 3.629510639001956*^9}, {
   3.6296718857346325`*^9, 3.6296718875627794`*^9}, 3.6296719269695234`*^9, {
   3.629671962985627*^9, 3.629671991111003*^9}, {3.6296720373616176`*^9, 
   3.62967206464323*^9}, 3.6296721109250965`*^9, {3.629672149425639*^9, 
   3.6296721710665207`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"K", " ", "=", " ", 
    RowBox[{"Flatten", "@", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\[Theta]", ",", " ", "x", ",", " ", "x1", ",", "x2", ",", "x3", ",", 
         "x4", ",", "x5", ",", "x6", ",", "x7", ",", "x8", ",", " ", "u", ",",
          " ", "rep"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"x", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{
          "0", ",", "0", ",", "x3", ",", "x4", ",", "0", ",", "0", ",", "x7", 
           ",", "x8"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"x", "\[LeftDoubleBracket]", 
          RowBox[{"5", ";;", "6"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
         RowBox[{"-", 
          RowBox[{
           RowBox[{
            RowBox[{"GibbotQnts`Private`J1", "[", "x", "]"}], 
            "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ".", 
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"x", "\[LeftDoubleBracket]", 
          RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
         RowBox[{"-", 
          RowBox[{"GibbotQnts`Private`P3", "[", "x", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rep", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x3", "\[Rule]", " ", "\[Pi]"}], ",", " ", 
           RowBox[{"x4", "\[Rule]", " ", "\[Pi]"}], ",", " ", 
           RowBox[{"x7", "\[Rule]", " ", "0"}], ",", " ", 
           RowBox[{"x8", "\[Rule]", " ", "0"}], ",", " ", 
           RowBox[{"u", "\[Rule]", " ", "0"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Theta]", " ", "=", " ", 
         RowBox[{"x", "\[LeftDoubleBracket]", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4", ",", "7", ",", "8"}], "}"}], 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"x", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"First", "@", 
            RowBox[{"DynamicQnts", "[", 
             RowBox[{"mag", ",", " ", "x", ",", " ", "u"}], "]"}]}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"A", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"x", ",", " ", 
              RowBox[{"{", "\[Theta]", "}"}]}], "]"}], "/.", " ", "rep"}], 
           " ", "//", " ", "Simplify"}], " ", "//", " ", "Chop"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"B", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"x", ",", " ", 
              RowBox[{"{", "u", "}"}]}], "]"}], "/.", " ", "rep"}], " ", "//",
            " ", "Simplify"}], " ", "//", " ", "Chop"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"x", " ", "=", " ", 
         RowBox[{"StateSpaceModel", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"A", "\[LeftDoubleBracket]", 
             RowBox[{"{", 
              RowBox[{"3", ",", "4", ",", "7", ",", "8"}], "}"}], 
             "\[RightDoubleBracket]"}], ",", " ", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"B", "\[LeftDoubleBracket]", 
               RowBox[{"{", 
                RowBox[{"3", ",", "4", ",", "7", ",", "8"}], "}"}], 
               "\[RightDoubleBracket]"}], "}"}], "\[Transpose]"}], ",", " ", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{"0", ",", " ", 
              RowBox[{"{", 
               RowBox[{"1", ",", "4"}], "}"}]}], "]"}]}], "}"}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"LQRegulatorGains", "[", 
         RowBox[{"x", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"IdentityMatrix", "[", "4", "]"}], ",", " ", 
            RowBox[{"IdentityMatrix", "[", "1", "]"}]}], "}"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"u", "[", 
     RowBox[{"t_", ",", " ", "x_", ",", " ", 
      RowBox[{"kp_:", "0"}], ",", " ", 
      RowBox[{"kd_:", "0"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"-", 
     RowBox[{"K", ".", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"x", "\[LeftDoubleBracket]", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4", ",", "7", ",", "8"}], "}"}], 
         "\[RightDoubleBracket]"}], " ", "-", " ", 
        RowBox[{"{", 
         RowBox[{"\[Pi]", ",", "\[Pi]", ",", "0", ",", "0"}], "}"}]}], 
       ")"}]}]}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", " ", "8"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], " ", 
   "=", " ", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], " ", 
   "=", " ", 
   RowBox[{"\[Pi]", " ", "-", " ", 
    RowBox[{"\[Pi]", "/", "10"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], " ", 
   "=", " ", "\[Pi]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"x", "\[LeftDoubleBracket]", 
     RowBox[{"5", ";;", "6"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{
       RowBox[{"GibbotQnts`Private`J1", "[", "x", "]"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"1", ",", " ", "All", ",", " ", "3"}], 
       "\[RightDoubleBracket]"}]}], " ", 
     RowBox[{"x", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"t", " ", "=", " ", "5"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Check", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", "q", "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"q", " ", "=", " ", 
     RowBox[{"q", "/.", 
      RowBox[{"First", "@", 
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"q", "''"}], "[", "s", "]"}], " ", "\[Equal]", " ", 
            RowBox[{"f", "[", 
             RowBox[{"s", ",", " ", 
              RowBox[{"q", "[", "s", "]"}], ",", " ", 
              RowBox[{
               RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], ",", " ", 
           RowBox[{
            RowBox[{"q", "[", "0", "]"}], " ", "\[Equal]", " ", 
            RowBox[{"x", "\[LeftDoubleBracket]", 
             RowBox[{"1", ";;", "4"}], "\[RightDoubleBracket]"}]}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"q", "'"}], "[", "0", "]"}], " ", "\[Equal]", " ", 
            RowBox[{"x", "\[LeftDoubleBracket]", 
             RowBox[{"5", ";;", "8"}], "\[RightDoubleBracket]"}]}]}], "}"}], 
         ",", " ", "q", ",", " ", 
         RowBox[{"{", 
          RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}]}], "]"}]}]}]}], 
    ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Animate", "[", 
     RowBox[{
      RowBox[{"DrawGibbot", "[", 
       RowBox[{"mag", ",", " ", 
        RowBox[{"q", "[", "s", "]"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", " ", 
         RowBox[{"2.5", "L1"}]}]}], "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}], ",", " ", 
      RowBox[{"AnimationRepetitions", "\[Rule]", "1"}]}], "]"}]}], ",", 
   "\[IndentingNewLine]", "\"\<NDSolve or Animate Failed.\>\""}], 
  "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.629494374457761*^9, 3.6294944482462163`*^9}, {
   3.6294945064025493`*^9, 3.629494571884076*^9}, {3.6294946117254057`*^9, 
   3.629494612323839*^9}, {3.6294949485207815`*^9, 3.6294949535253487`*^9}, {
   3.629495016836317*^9, 3.629495074058013*^9}, {3.629495112521323*^9, 
   3.629495127961317*^9}, {3.6294951808919373`*^9, 3.6294952354236956`*^9}, {
   3.629495286185773*^9, 3.6294953167825136`*^9}, {3.6294953698272195`*^9, 
   3.629495380542836*^9}, {3.629495445283842*^9, 3.6294955032850747`*^9}, {
   3.6294955547486424`*^9, 3.6294956306766214`*^9}, {3.629495699591573*^9, 
   3.629495810453379*^9}, {3.6294958453601947`*^9, 3.629495879097166*^9}, {
   3.6294959340091934`*^9, 3.6294959498584757`*^9}, {3.6294960742538595`*^9, 
   3.629496107449472*^9}, {3.629496191860468*^9, 3.6294962264370394`*^9}, 
   3.62949652433075*^9, {3.6294966601703153`*^9, 3.629496698315421*^9}, 
   3.6294967676326747`*^9, {3.6294968843996677`*^9, 3.6294970789419394`*^9}, {
   3.629497112431743*^9, 3.6294971936724625`*^9}, 3.6294972273053665`*^9, {
   3.629497270286945*^9, 3.629497319080595*^9}, {3.62949743546131*^9, 
   3.6294974623904696`*^9}, {3.6294975127642727`*^9, 3.629497513097517*^9}, {
   3.629497812472268*^9, 3.6294978954702716`*^9}, {3.629497931042548*^9, 
   3.6294979957093353`*^9}, {3.6294980571319823`*^9, 
   3.6294980621265335`*^9}, {3.6294981257093678`*^9, 
   3.6294981435340347`*^9}, {3.629498225474272*^9, 3.629498229297993*^9}, {
   3.6294983057243185`*^9, 3.6294983065519056`*^9}, {3.6294983993988843`*^9, 
   3.6294985540698156`*^9}, {3.629498588176049*^9, 3.6294986184155474`*^9}, {
   3.629498686556981*^9, 3.6294987702274466`*^9}, {3.6294988013195443`*^9, 
   3.6294990090862193`*^9}, {3.62949907608383*^9, 3.629499096215144*^9}, {
   3.6294991365648174`*^9, 3.629499136650854*^9}, {3.629499180430971*^9, 
   3.6294992112499027`*^9}, {3.6295084503744373`*^9, 3.629508500371955*^9}}]
}, Closed]]
},
AutoGeneratedPackage->None,
WindowSize->{783, 607},
WindowMargins->{{Automatic, 244}, {Automatic, 49}},
FrontEndVersion->"10.0 for Microsoft Windows (64-bit) (December 4, 2014)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 181, 2, 70, "Section"],
Cell[CellGroupData[{
Cell[786, 28, 100174, 2425, 7354, "Input",
 InitializationCell->True],
Cell[100963, 2455, 648, 12, 70, "Message"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[101660, 2473, 148, 2, 56, "Section"],
Cell[101811, 2477, 6919, 178, 772, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[108767, 2660, 194, 3, 56, "Section"],
Cell[108964, 2665, 661, 20, 52, "Input"],
Cell[109628, 2687, 23551, 465, 1072, "Input"],
Cell[CellGroupData[{
Cell[133204, 3156, 13432, 187, 92, "Input"],
Cell[146639, 3345, 154, 4, 31, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[146830, 3354, 16828, 292, 592, "Input"],
Cell[163661, 3648, 114, 1, 31, "Output"],
Cell[163778, 3651, 282, 6, 33, "Output"]
}, Open  ]],
Cell[164075, 3660, 5870, 154, 192, "Input"],
Cell[169948, 3816, 2066, 55, 172, "Input"],
Cell[172017, 3873, 994, 25, 52, "Input"],
Cell[CellGroupData[{
Cell[173036, 3902, 1213, 31, 72, "Input"],
Cell[174252, 3935, 35029, 641, 500, "Output"]
}, Open  ]],
Cell[209296, 4579, 787, 21, 52, "Input"],
Cell[210086, 4602, 6557, 153, 572, "Input"],
Cell[216646, 4757, 1232, 30, 92, "Input"],
Cell[217881, 4789, 176, 3, 31, "Input"],
Cell[218060, 4794, 500, 12, 92, "Input"],
Cell[218563, 4808, 1463, 44, 112, "Input"],
Cell[220029, 4854, 116, 2, 31, "Input"],
Cell[220148, 4858, 129, 2, 31, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[220314, 4865, 248, 3, 70, "Section"],
Cell[220565, 4870, 22295, 490, 1392, "Input"],
Cell[242863, 5362, 10081, 227, 752, "Input"]
}, Closed]]
}
]
*)

(* End of internal cache information *)
